<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sanctification">
    <meta name="theme-color" content="#4F46E5">
    <title>Path to Sanctification - Catholic Spiritual Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAIuUlEQVR4nO3dwW8UVRwH8N9sNiaeevdIkAtqKFYhAUsRE4sGqJJ492LaYrdle/FP8NKlO0236EHuYqKSEiBRKxCjoEDSxIsHj957MvGyHobZfTs7Mzsz7828N7/f95NMslvK7Htvvvvrb6e7U+/cycdkUd/mg0NpPFsP3KR+ZZlCeOWIO9aVhLxZ8v4RYgipWSgt3M2SMocgQ5owH8aDbbpCI8iQh/Fgmwo0ggw6jAXbRMuBMIMpfdIMdVMzjggzmKYV6qItB4IMZSrcgjS9/NlEmKEquat1o8ADAFQpV+byvChEmMGWzJU6a4VGmMG2TBnMcpYDYQZXTKzUZf3qG8CKSS0H0g6uSc1kWqARZnBVYjaTWg6EGVwX2083rX20AKAEcRUa1RnqYqxK6745CcAp0ReFiDfUzUhmcR4aWFErNJINdTXIbt532wE4DS0HsNL0gjwj1VB3fSLyUKGBFfTQwAoCDayg5QBWGoREAx99tBzASpXXhwYoHSo0sFLkykkAzkKFBlYQaGAF56GBFXwEC1hBywGsoOUAVsr+O4XirC/+mPv/bFw/V8JIZPLmp++hRGtYX/zJ+D43rr9tfJ9SINAFlBHiJAh3Pgh0DlmD/M4nnx9k3ecPX342leX7EOxsvPljdxHoCdaX9hL/bWPn7Mj9O8/ezRzm0PnpeyOhzvN4MAqBTpEUrKRQFQlzKBrqomOQDoGOUSREOmEOJYW66Jgk8uaP3UGgFXHBmRSaO8/mtcMcOj99N7WnLjI+SfCbQkU0LBs7Z50LS9yY0npuaRBoCgIRF2aXxYUawSZqeP0+Sd7WF/eC3/4rW6c3l2sfJuV53E5vbmzs64t71tfU5ia6QreXfh6539mZo87OnJWxFBU35ui8JGmMPcWFbONhPqOxP5OKjSEY/1AwP/vrXPUmskK3l+6P3I+Goa7GQ30/4Tv5EhloFZcwh7jNJy9xLYf6o7izM2tovybpj0edl7TWo+HAGCrbxn4Em9q3SSWMqb103/raV7WJaTnay5G+uXfG0kiqEZ1fdP5cibnQjPrXGTu9WXJ13ibHda03S+3lB6Xs21UiKrR6UDu9WYsjqZ46X3UduBL4IVnX51v2+Fyfvx72Fbq9/HBwu9N7y+JI7FHnra4HR+wDDbI0qN8nrlvQMwbnczrbp8t7LJNKGmNn+/RgLdrLD6wfm7I2VGhgxXvv1e8Nlxg3tK8ovfP2sIe8vX/R2KdL6uL9125NhbeT1oULxr/6VgVfkxhmovBJnLwunLaGR8EvHbhtKo+Ibu9fEhnm0O39Swdx68JtY1mhr155OLh9bfsU7QoPc2h3/9LBte1TFLdOXDb2b07a3V9AmBW7+wsHto9JmRvOcgArAn/1DaN4HX92FfrqlV9sD6FWuK0Xu0CrghdAEMV5XZi3HJznpiO6LnzWiXWFBnmapq/8Y99wPvzmZkawLjzXCRUaWEGggRW8KBQJLwpr68Ir30zZHoNLuK8H+0AT8T+IWUlYB34fwVIpX79w9Cb7g5nmwtGbU1nWqe6biAodkhpqSfNmd+UkdT5XV36lza2TI/9+8ejXxg/urT8/MvYW1TLGF31j/9rKb5F/55MBdhU6GmBIx2292AUaZGN+HpqofvOrerx1W590qNDACsvPFG76Jwa31z59VP5jmlTyWNX1UNeJy8a45egn3HZd2WOt67pkg5YDWGEb6M2tE4PbayuPLI7EHeo6qOvDCbtfrCSpyzyrGmdd1iMvthWaiKi79ebg9urKY4sjsU+dv7ou3DTH3qjCWR3mWsUY67AOBbGu0EREXf+Nwe3V1u8WR2KPOm91PThiH2iQheXVR6Nb158Z3F5tPS7hMUwyOzZ1vuo6cN1EVmgprYeUearEBDraO3I/2NH5ce+dQwwvNJPM785Qq/XH4L6Lczc2JmU3vj/D9rxzlJgKHfL9mcFtNdycqPNS5yuBiBeF49tQcPDN7U+f3ljGn6S217raTVyFJiLy/ddH7rdaTyyNxKzoPKLzlEBkoIn4hRphDjB+P/Rkvn98JAjhj2u7Ych3POKeiMH4ZR5XsRU6FBfeulTr5DDL1RT6RB7hd4MQtFbVav1k8PVKZTwe6liJyM5YHSS65Yjyu8eptfp0cD8Mjd89XuEo0o+HOr5QMD4cRyKiZvSqOtJtRUJNRLT6/H4VwU46HnFBJgrGhGM4hAodw+9OE9F4iKqp2JHz5ClBjvt+6Zq2B+CyMDTjwX469j0mJYW4rMfjxFs4cgNP8YySgnZ24dB/I194ae3fzDv9Z/NF9e7ed3+/EPdtCHI2sj6CpcnffN6KrD1L/8ZISE08JlqLbNByFDAMWYZwa+4f8vEWXv4KT31N3/718fD60EWqs9KifHDkxpSZUcmEsxym5emfY+F46MB5aMfgeOhBhXYOjocO8W9OAl7w5iTX4HhoQcvhHBwPHWg5gBUEGlhBy+EcHA8dqNDAiqgrJ9UBjoceVGhgBYEGVoReCszsdvnwF0beIRfsx/586ryhQhuiG2pTTwrpEGiDioYSYTYHLYfh7fLh67nCGXy//XFz2bwPD+308xwAAJeh5QBWxPxpZJABFRpYwZuTgBVUaGAFH8ECVtByACtoOYAVBBpYwXloYAUVGljB9aGBlQbh+oDAh4eWA1jBeWhgBRUaWEGggZWw5fAIvQfUm0dE1PQQY2AELwqBFbWHxvloqKtBdvGiEFiJthx4cQh1M9JZoEIDK3EfwUKVhroYe92HsxzAStKfRkaVBtfFRjetQiPU4KrEU8yTXhTi3DS4JjWTOMsBrGR5UYjWA1wxsWPIeuUkhBpsy9T+5mk50E+DLZmzl/c8NCo1VC1XIS3yohCVGqqSO2tFr5wUPhCqNZShcNHUPW2Hag2maWXKxPWh0VeDKdoF0tSbk9CCgA5jP+mbpnb0HIINeRhvWU0HOoRgQ5rSXnuV/X5odeAIt2yVnEAoq0LHiZsQQs6TtbNf/wPelLmuEgo12wAAAABJRU5ErkJggg==">
    <link rel="icon" type="image/png" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAIuUlEQVR4nO3dwW8UVRwH8N9sNiaeevdIkAtqKFYhAUsRE4sGqJJ492LaYrdle/FP8NKlO0236EHuYqKSEiBRKxCjoEDSxIsHj957MvGyHobZfTs7Mzsz7828N7/f95NMslvK7Htvvvvrb6e7U+/cycdkUd/mg0NpPFsP3KR+ZZlCeOWIO9aVhLxZ8v4RYgipWSgt3M2SMocgQ5owH8aDbbpCI8iQh/Fgmwo0ggw6jAXbRMuBMIMpfdIMdVMzjggzmKYV6qItB4IMZSrcgjS9/NlEmKEquat1o8ADAFQpV+byvChEmMGWzJU6a4VGmMG2TBnMcpYDYQZXTKzUZf3qG8CKSS0H0g6uSc1kWqARZnBVYjaTWg6EGVwX2083rX20AKAEcRUa1RnqYqxK6745CcAp0ReFiDfUzUhmcR4aWFErNJINdTXIbt532wE4DS0HsNL0gjwj1VB3fSLyUKGBFfTQwAoCDayg5QBWGoREAx99tBzASpXXhwYoHSo0sFLkykkAzkKFBlYQaGAF56GBFXwEC1hBywGsoOUAVsr+O4XirC/+mPv/bFw/V8JIZPLmp++hRGtYX/zJ+D43rr9tfJ9SINAFlBHiJAh3Pgh0DlmD/M4nnx9k3ecPX342leX7EOxsvPljdxHoCdaX9hL/bWPn7Mj9O8/ezRzm0PnpeyOhzvN4MAqBTpEUrKRQFQlzKBrqomOQDoGOUSREOmEOJYW66Jgk8uaP3UGgFXHBmRSaO8/mtcMcOj99N7WnLjI+SfCbQkU0LBs7Z50LS9yY0npuaRBoCgIRF2aXxYUawSZqeP0+Sd7WF/eC3/4rW6c3l2sfJuV53E5vbmzs64t71tfU5ia6QreXfh6539mZo87OnJWxFBU35ui8JGmMPcWFbONhPqOxP5OKjSEY/1AwP/vrXPUmskK3l+6P3I+Goa7GQ30/4Tv5EhloFZcwh7jNJy9xLYf6o7izM2tovybpj0edl7TWo+HAGCrbxn4Em9q3SSWMqb103/raV7WJaTnay5G+uXfG0kiqEZ1fdP5cibnQjPrXGTu9WXJ13ibHda03S+3lB6Xs21UiKrR6UDu9WYsjqZ46X3UduBL4IVnX51v2+Fyfvx72Fbq9/HBwu9N7y+JI7FHnra4HR+wDDbI0qN8nrlvQMwbnczrbp8t7LJNKGmNn+/RgLdrLD6wfm7I2VGhgxXvv1e8Nlxg3tK8ovfP2sIe8vX/R2KdL6uL9125NhbeT1oULxr/6VgVfkxhmovBJnLwunLaGR8EvHbhtKo+Ibu9fEhnm0O39Swdx68JtY1mhr155OLh9bfsU7QoPc2h3/9LBte1TFLdOXDb2b07a3V9AmBW7+wsHto9JmRvOcgArAn/1DaN4HX92FfrqlV9sD6FWuK0Xu0CrghdAEMV5XZi3HJznpiO6LnzWiXWFBnmapq/8Y99wPvzmZkawLjzXCRUaWEGggRW8KBQJLwpr68Ir30zZHoNLuK8H+0AT8T+IWUlYB34fwVIpX79w9Cb7g5nmwtGbU1nWqe6biAodkhpqSfNmd+UkdT5XV36lza2TI/9+8ejXxg/urT8/MvYW1TLGF31j/9rKb5F/55MBdhU6GmBIx2292AUaZGN+HpqofvOrerx1W590qNDACsvPFG76Jwa31z59VP5jmlTyWNX1UNeJy8a45egn3HZd2WOt67pkg5YDWGEb6M2tE4PbayuPLI7EHeo6qOvDCbtfrCSpyzyrGmdd1iMvthWaiKi79ebg9urKY4sjsU+dv7ou3DTH3qjCWR3mWsUY67AOBbGu0EREXf+Nwe3V1u8WR2KPOm91PThiH2iQheXVR6Nb158Z3F5tPS7hMUwyOzZ1vuo6cN1EVmgprYeUearEBDraO3I/2NH5ce+dQwwvNJPM785Qq/XH4L6Lczc2JmU3vj/D9rxzlJgKHfL9mcFtNdycqPNS5yuBiBeF49tQcPDN7U+f3ljGn6S217raTVyFJiLy/ddH7rdaTyyNxKzoPKLzlEBkoIn4hRphDjB+P/Rkvn98JAjhj2u7Ych3POKeiMH4ZR5XsRU6FBfeulTr5DDL1RT6RB7hd4MQtFbVav1k8PVKZTwe6liJyM5YHSS65Yjyu8eptfp0cD8Mjd89XuEo0o+HOr5QMD4cRyKiZvSqOtJtRUJNRLT6/H4VwU46HnFBJgrGhGM4hAodw+9OE9F4iKqp2JHz5ClBjvt+6Zq2B+CyMDTjwX469j0mJYW4rMfjxFs4cgNP8YySgnZ24dB/I194ae3fzDv9Z/NF9e7ed3+/EPdtCHI2sj6CpcnffN6KrD1L/8ZISE08JlqLbNByFDAMWYZwa+4f8vEWXv4KT31N3/718fD60EWqs9KifHDkxpSZUcmEsxym5emfY+F46MB5aMfgeOhBhXYOjocO8W9OAl7w5iTX4HhoQcvhHBwPHWg5gBUEGlhBy+EcHA8dqNDAiqgrJ9UBjoceVGhgBYEGVoReCszsdvnwF0beIRfsx/586ryhQhuiG2pTTwrpEGiDioYSYTYHLYfh7fLh67nCGXy//XFz2bwPD+308xwAAJeh5QBWxPxpZJABFRpYwZuTgBVUaGAFH8ECVtByACtoOYAVBBpYwXloYAUVGljB9aGBlQbh+oDAh4eWA1jBeWhgBRUaWEGggZWw5fAIvQfUm0dE1PQQY2AELwqBFbWHxvloqKtBdvGiEFiJthx4cQh1M9JZoEIDK3EfwUKVhroYe92HsxzAStKfRkaVBtfFRjetQiPU4KrEU8yTXhTi3DS4JjWTOMsBrGR5UYjWA1wxsWPIeuUkhBpsy9T+5mk50E+DLZmzl/c8NCo1VC1XIS3yohCVGqqSO2tFr5wUPhCqNZShcNHUPW2Hag2maWXKxPWh0VeDKdoF0tSbk9CCgA5jP+mbpnb0HIINeRhvWU0HOoRgQ5rSXnuV/X5odeAIt2yVnEAoq0LHiZsQQs6TtbNf/wPelLmuEgo12wAAAABJRU5ErkJggg==">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .confession-item { 
            transition: all 0.2s;
        }
        .confession-item:hover {
            background-color: #f3f4f6;
        }
        
        /* Mobile optimizations */
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        input[type="checkbox"] {
            min-width: 20px;
            min-height: 20px;
        }
        
        @media (max-width: 768px) {
            .tab-btn {
                font-size: 0.875rem;
                padding: 1rem 0.75rem;
            }
        }
        
        /* Better touch targets */
        label {
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Theme styles */
        body.theme-dark {
            background: linear-gradient(to bottom right, #1a1a2e, #16213e) !important;
            color: #e0e0e0;
        }
        
        body.theme-dark .bg-white,
        body.theme-dark .bg-gray-50,
        body.theme-dark .bg-gray-100,
        body.theme-dark .bg-blue-50,
        body.theme-dark .bg-green-50,
        body.theme-dark .bg-purple-50,
        body.theme-dark .bg-red-50,
        body.theme-dark .bg-amber-50,
        body.theme-dark .bg-orange-50,
        body.theme-dark .bg-teal-50,
        body.theme-dark .bg-indigo-50 {
            background-color: #2a2a3e !important;
            color: #e0e0e0 !important;
        }
        
        body.theme-dark .bg-indigo-100 {
            background-color: #3a3a5e !important;
        }
        
        body.theme-dark .bg-green-100 {
            background-color: #2a4a3e !important;
        }
        
        body.theme-dark .bg-purple-100 {
            background-color: #3a2a4e !important;
        }
        
        body.theme-dark .bg-red-100 {
            background-color: #4a2a2e !important;
        }
        
        body.theme-dark .bg-blue-100 {
            background-color: #2a3a5e !important;
        }
        
        body.theme-dark .bg-yellow-50 {
            background-color: #3a3a2e !important;
        }
        
        body.theme-dark .bg-pink-50 {
            background-color: #3a2a3e !important;
        }
        
        /* Dark mode for accordion/details elements */
        body.theme-dark details {
            background-color: #2a2a3e !important;
            border-color: #4a4a5e !important;
        }
        
        body.theme-dark details summary {
            background-color: #2a2a3e !important;
            color: #d0d0ff !important;
        }
        
        body.theme-dark details summary:hover {
            background-color: #3a3a4e !important;
        }
        
        body.theme-dark details[open] {
            background-color: #2a2a3e !important;
        }
        
        /* Specific color adjustments for dark mode */
        body.theme-dark .border-indigo-200,
        body.theme-dark .border-indigo-300 {
            border-color: #5a5a7e !important;
        }
        
        body.theme-dark .border-blue-200,
        body.theme-dark .border-blue-300 {
            border-color: #4a4a6e !important;
        }
        
        body.theme-dark .border-yellow-200 {
            border-color: #5a5a4e !important;
        }
        
        body.theme-dark .border-purple-200 {
            border-color: #5a4a6e !important;
        }
        
        body.theme-dark .border-green-200 {
            border-color: #4a5a4e !important;
        }
        
        body.theme-dark .border-red-200,
        body.theme-dark .border-red-300 {
            border-color: #6a4a4e !important;
        }
        
        body.theme-dark .border-pink-200 {
            border-color: #5a4a5e !important;
        }
        
        body.theme-dark .border-amber-200 {
            border-color: #5a5a3e !important;
        }
        
        body.theme-dark .border-gray-400 {
            border-color: #5a5a6e !important;
        }
        
        body.theme-dark .text-gray-500,
        body.theme-dark .text-gray-600,
        body.theme-dark .text-gray-700,
        body.theme-dark .text-gray-800,
        body.theme-dark .text-gray-900 {
            color: #d0d0d0 !important;
        }
        
        body.theme-dark .text-indigo-900,
        body.theme-dark .text-purple-900,
        body.theme-dark .text-green-900,
        body.theme-dark .text-red-900,
        body.theme-dark .text-orange-900,
        body.theme-dark .text-teal-900,
        body.theme-dark .text-amber-900 {
            color: #b0b0ff !important;
        }
        
        body.theme-dark .text-blue-900,
        body.theme-dark .text-blue-800 {
            color: #a0c0ff !important;
        }
        
        body.theme-dark .border-gray-200,
        body.theme-dark .border-gray-300 {
            border-color: #4a4a5e !important;
        }
        
        body.theme-dark input[type="text"],
        body.theme-dark input[type="time"],
        body.theme-dark input[type="checkbox"],
        body.theme-dark textarea,
        body.theme-dark select {
            background-color: #3a3a4e !important;
            color: #e0e0e0 !important;
            border-color: #5a5a6e !important;
        }
        
        body.theme-dark button {
            border-color: transparent !important;
        }
        
        /* Fix light text on light backgrounds in dark mode */
        /* Daily Activities gradient cards */
        body.theme-dark .bg-gradient-to-r {
            background: linear-gradient(to right, #2a2a3e, #3a3a4e) !important;
        }
        
        body.theme-dark .bg-gradient-to-r .text-gray-700,
        body.theme-dark .bg-gradient-to-r .font-semibold {
            color: #e0e0e0 !important;
        }
        
        body.theme-dark .bg-gradient-to-r input[type="number"] {
            background-color: #2a2a3e !important;
            color: #e0e0e0 !important;
        }
        
        /* Progress stat cards */
        body.theme-dark .bg-gradient-to-br {
            background: linear-gradient(to bottom right, #2a2a3e, #3a3a4e) !important;
        }
        
        body.theme-dark .bg-gradient-to-br .text-purple-900,
        body.theme-dark .bg-gradient-to-br .text-purple-700,
        body.theme-dark .bg-gradient-to-br .text-blue-900,
        body.theme-dark .bg-gradient-to-br .text-blue-700,
        body.theme-dark .bg-gradient-to-br .text-blue-800,
        body.theme-dark .bg-gradient-to-br .text-green-900,
        body.theme-dark .bg-gradient-to-br .text-green-700,
        body.theme-dark .bg-gradient-to-br .text-green-800,
        body.theme-dark .bg-gradient-to-br .font-semibold,
        body.theme-dark .bg-gradient-to-br .font-bold {
            color: #e0e0e0 !important;
        }
        
        /* Mass Readings and Liturgy sections in Resources */
        body.theme-dark .from-amber-50.to-yellow-50,
        body.theme-dark .from-blue-50.to-indigo-50 {
            background: linear-gradient(to right, #2a2a3e, #3a3a4e) !important;
        }
        
        body.theme-dark .from-amber-50 .text-amber-900,
        body.theme-dark .from-amber-50 .text-gray-700,
        body.theme-dark .from-amber-50 .text-gray-600,
        body.theme-dark .from-blue-50 .text-blue-900,
        body.theme-dark .from-blue-50 .text-gray-700,
        body.theme-dark .from-blue-50 .text-gray-600 {
            color: #e0e0e0 !important;
        }
        
        /* Sin Tracker boxes - make red buttons and cards more visible */
        body.theme-dark .border-red-200 {
            border-color: #ef4444 !important;
            border-width: 2px !important;
        }
        
        body.theme-dark .text-red-800 {
            color: #fca5a5 !important;
        }
        
        body.theme-dark .text-red-600 {
            color: #f87171 !important;
        }
        
        body.theme-dark .bg-red-500 {
            background-color: #dc2626 !important;
        }
        
        body.theme-dark .bg-red-500:hover {
            background-color: #b91c1c !important;
        }
        
        body.theme-dark .bg-red-100 {
            background-color: #7f1d1d !important;
        }
        
        body.theme-dark .bg-red-100:hover {
            background-color: #991b1b !important;
        }
        
        body.theme-dark .text-red-700 {
            color: #fca5a5 !important;
        }
        
        /* History tab filter buttons - only target buttons with bg-gray-200 */
        body.theme-dark button.bg-gray-200 {
            background-color: #3a3a4e !important;
            color: #e0e0e0 !important;
        }
        
        body.theme-dark button.bg-gray-200:hover {
            background-color: #4a4a5e !important;
        }
        
        /* Works of Mercy section headers */
        body.theme-dark .text-orange-800 {
            color: #fdba74 !important;
        }
        
        body.theme-dark .border-orange-300 {
            border-color: #fb923c !important;
        }
        
        /* Works of Mercy accordion buttons */
        body.theme-dark .bg-orange-100 {
            background-color: #7c2d12 !important;
        }
        
        body.theme-dark .bg-orange-100:hover {
            background-color: #9a3412 !important;
        }
        
        body.theme-dark .text-orange-900 {
            color: #fdba74 !important;
        }
        
        body.theme-dark .bg-blue-100:not(.bg-gradient-to-br) {
            background-color: #1e3a8a !important;
        }
        
        body.theme-dark .bg-blue-100:hover:not(.bg-gradient-to-br) {
            background-color: #1e40af !important;
        }
        
        body.theme-dark .text-blue-900 {
            color: #93c5fd !important;
        }
        
        body.theme-sepia {
            background: linear-gradient(to bottom right, #f4e8d8, #e8d4b8) !important;
        }
        
        body.theme-sepia .bg-white {
            background-color: #faf6ed !important;
        }
        
        /* Font size options */
        body.font-large {
            font-size: 18px;
        }
        
        body.font-extra-large {
            font-size: 22px;
        }
        
        body.font-large .text-sm,
        body.font-extra-large .text-sm {
            font-size: 1em;
        }
        
        /* Safe area for iPhone notch */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Bible-specific styles */
        .bible-verse {
            line-height: 1.8;
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .bible-verse:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .bible-verse.highlighted-yellow {
            background-color: #fef08a !important;
        }
        
        .bible-verse.highlighted-green {
            background-color: #86efac !important;
        }
        
        .bible-verse.highlighted-blue {
            background-color: #93c5fd !important;
        }
        
        .bible-verse.highlighted-pink {
            background-color: #f9a8d4 !important;
        }
        
        .bible-verse.highlighted-orange {
            background-color: #fdba74 !important;
        }
        
        .bible-verse .verse-number {
            font-weight: bold;
            color: #4f46e5;
            font-size: 0.85rem;
            vertical-align: super;
            margin-right: 6px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
            display: inline-block;
        }
        
        .bible-verse .verse-number:hover {
            background-color: #eef2ff;
            color: #3730a3;
            transform: scale(1.15);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .bible-verse .verse-text {
            cursor: pointer;
            display: inline;
        }
        
        .bible-note {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 10px 14px;
            margin: 8px 0 8px 24px;
            border-radius: 4px;
            font-size: 0.875rem;
            position: relative;
        }
        
        .bible-note .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .bible-note .note-label {
            font-weight: 600;
            color: #92400e;
            font-size: 0.75rem;
        }
        
        .bible-note .note-actions {
            display: flex;
            gap: 6px;
        }
        
        .bible-note button {
            padding: 2px 6px;
            font-size: 0.7rem;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bible-note .edit-btn {
            background-color: #fbbf24;
            color: white;
        }
        
        .bible-note .edit-btn:hover {
            background-color: #f59e0b;
        }
        
        .bible-note .delete-btn {
            background-color: #ef4444;
            color: white;
        }
        
        .bible-note .delete-btn:hover {
            background-color: #dc2626;
        }
        
        .bible-chapter-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 24px 0 12px 0;
            color: #4f46e5;
            border-bottom: 2px solid #4f46e5;
            padding-bottom: 8px;
        }
        
        .bible-book-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .bible-book-btn {
            padding: 12px 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .bible-book-btn:hover {
            background-color: #eef2ff;
            border-color: #6366f1;
        }
        
        .highlight-toolbar {
            position: sticky;
            top: 0;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            padding: 12px;
            z-index: 100;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .highlight-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: 2px solid #d1d5db;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .highlight-btn:hover {
            transform: scale(1.1);
            border-color: #4f46e5;
        }
        
        .highlight-btn.active {
            border-color: #4f46e5;
            border-width: 3px;
            transform: scale(1.05);
        }
        
        /* Dark mode for Bible elements */
        body.theme-dark .bible-verse:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        body.theme-dark .bible-chapter-title {
            color: #a5b4fc;
            border-bottom-color: #6366f1;
        }
        
        body.theme-dark .bible-book-btn {
            background-color: #2a2a3e;
            border-color: #4a4a5e;
            color: #e0e0e0;
        }
        
        body.theme-dark .bible-book-btn:hover {
            background-color: #3a3a5e;
            border-color: #818cf8;
        }
        
        body.theme-dark .highlight-toolbar {
            background-color: #2a2a3e;
            border-bottom-color: #4a4a5e;
        }
        
        body.theme-dark .bible-note {
            background-color: #3a3a2e;
            border-left-color: #f59e0b;
            color: #e0e0e0;
        }
        
        body.theme-dark .bible-verse .verse-number:hover {
            background-color: #3730a3;
            color: #c7d2fe;
        }
        
        /* Sepia mode for Bible */
        body.theme-sepia .bible-verse.highlighted-yellow {
            background-color: #f4e4c1 !important;
        }
        
        body.theme-sepia .bible-verse.highlighted-green {
            background-color: #d4e8d4 !important;
        }
        
        body.theme-sepia .bible-verse.highlighted-blue {
            background-color: #d4e0f0 !important;
        }
        
        body.theme-sepia .bible-verse.highlighted-pink {
            background-color: #f0d4e8 !important;
        }
        
        body.theme-sepia .bible-verse.highlighted-orange {
            background-color: #f0d8c4 !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Security PIN Setup/Login Screen - DISABLED -->
    <div id="security-screen" class="fixed inset-0 bg-indigo-900 z-50 flex items-center justify-center" style="display: none !important;">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">‚úùÔ∏è</div>
                <h2 class="text-2xl font-bold text-gray-800" id="security-title">Secure Your Spiritual Journey</h2>
                <p class="text-gray-600 mt-2" id="security-subtitle">Create a PIN to protect your data</p>
            </div>
            
            <div id="pin-setup" style="display: none;">
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Create 4-6 Digit PIN</label>
                    <input type="password" id="new-pin" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                           class="w-full px-4 py-3 border border-gray-300 rounded-md text-center text-2xl tracking-widest"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <p class="text-xs text-gray-500 mt-2">This PIN will protect your confession records and spiritual data</p>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm PIN</label>
                    <input type="password" id="confirm-pin" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                           class="w-full px-4 py-3 border border-gray-300 rounded-md text-center text-2xl tracking-widest"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button onclick="setupPIN()" class="w-full bg-indigo-600 text-white py-3 rounded-md font-semibold hover:bg-indigo-700 transition">
                    Set PIN & Continue
                </button>
                <p id="pin-setup-error" class="text-red-600 text-sm mt-2 text-center"></p>
            </div>
            
            <div id="pin-login" style="display: none;">
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Enter Your PIN</label>
                    <input type="password" id="login-pin" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                           class="w-full px-4 py-3 border border-gray-300 rounded-md text-center text-2xl tracking-widest"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button onclick="loginWithPIN()" class="w-full bg-indigo-600 text-white py-3 rounded-md font-semibold hover:bg-indigo-700 transition mb-3">
                    Unlock
                </button>
                <button onclick="tryBiometric()" id="biometric-btn" class="w-full bg-gray-200 text-gray-700 py-3 rounded-md font-semibold hover:bg-gray-300 transition" style="display: none;">
                    üîê Use Face ID / Touch ID
                </button>
                <p id="pin-login-error" class="text-red-600 text-sm mt-2 text-center"></p>
            </div>
        </div>
    </div>

    <!-- Session Timeout Overlay - DISABLED -->
    <div id="timeout-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center" style="display: none !important;">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full mx-4">
            <div class="text-center mb-4">
                <div class="text-4xl mb-2">üîí</div>
                <h3 class="text-xl font-bold text-gray-800">Session Locked</h3>
                <p class="text-gray-600 mt-2">For your security, please enter your PIN</p>
            </div>
            <div class="mb-4">
                <input type="password" id="timeout-pin" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                       class="w-full px-4 py-3 border border-gray-300 rounded-md text-center text-2xl tracking-widest"
                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button onclick="unlockFromTimeout()" class="w-full bg-indigo-600 text-white py-3 rounded-md font-semibold hover:bg-indigo-700 transition">
                Unlock
            </button>
            <p id="timeout-error" class="text-red-600 text-sm mt-2 text-center"></p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-indigo-900 text-center mb-2">‚úù Path to Sanctification</h1>
            <p class="text-center text-gray-600">Your Journey from Sinner to Saint</p>
        </div>

        <!-- Backup Reminder Banner -->
        <div id="backup-reminder-banner" class="bg-amber-100 border-2 border-amber-500 rounded-lg p-4 mb-6 shadow-lg" style="display: none;">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <span class="text-3xl">‚ö†Ô∏è</span>
                </div>
                <div class="ml-3 flex-1">
                    <h3 class="text-lg font-bold text-amber-900">Backup Reminder</h3>
                    <p id="backup-reminder-text" class="text-sm text-amber-800 mt-1"></p>
                    <div class="mt-3 flex gap-3">
                        <button onclick="goToBackup()" class="bg-amber-600 text-white px-4 py-2 rounded-md hover:bg-amber-700 font-semibold text-sm">
                            Backup Now
                        </button>
                        <button onclick="dismissBackupReminder()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 text-sm">
                            Remind Later
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex flex-wrap border-b border-gray-200">
                <button onclick="switchTab('daily')" class="tab-btn px-4 py-3 font-semibold text-gray-700 border-b-2 border-indigo-600 text-sm">
                    ‚òÄÔ∏è Daily
                </button>
                <button onclick="switchTab('mass')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    ‚õ™ Mass
                </button>
                <button onclick="switchTab('prayers')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üôè Prayers
                </button>
                <button onclick="switchTab('mercy')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    ü§≤ Mercy
                </button>
                <button onclick="switchTab('confession-tracker')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üìã Sin Tracker
                </button>
                <button onclick="switchTab('confession')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    ‚úùÔ∏è Confession
                </button>
                <button onclick="switchTab('journal')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    ‚úçÔ∏è Journal
                </button>
                <button onclick="switchTab('bible')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üìñ Bible
                </button>
                <button onclick="switchTab('readings')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üìö Resources
                </button>
                <button onclick="switchTab('history')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üìÖ History
                </button>
                <button onclick="switchTab('progress')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üìà Progress
                </button>
                <button onclick="switchTab('data')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üíæ Data
                </button>
                <button onclick="switchTab('lent')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    üåø Lent
                </button>
                <button onclick="switchTab('settings')" class="tab-btn px-4 py-3 font-semibold text-gray-500 hover:text-gray-700 border-b-2 border-transparent text-sm">
                    ‚öôÔ∏è Settings
                </button>
            </div>

            <!-- Daily Activities Tab -->
            <div id="daily-tab" class="tab-content active p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">‚òÄÔ∏è Today's Spiritual Activities</h2>
                
                <!-- Days Since Last Confession -->
                <div id="confession-reminder" class="bg-purple-50 border-2 border-purple-300 rounded-lg p-3 mb-4" style="display: none;">
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-sm font-semibold text-purple-900">‚è∞ Days Since Last Confession:</span>
                            <span id="days-since-confession" class="text-2xl font-bold text-purple-600 ml-2"></span>
                        </div>
                        <button onclick="switchTab('confession')" class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">
                            Go to Confession Tab
                        </button>
                    </div>
                    <p class="text-xs text-purple-700 mt-1">üí° Church recommends confession at least monthly</p>
                </div>
                
                <p class="text-sm text-gray-500 mb-6" id="today-date"></p>
                
                <!-- Dynamic Daily Activities Container -->
                <div id="daily-activities-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Activities will be dynamically generated here -->
                </div>

                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-900 mb-2">Notes for Today</h3>
                    <textarea id="daily-notes" rows="3" 
                              class="w-full px-3 py-2 border border-blue-300 rounded-md"
                              placeholder="Spiritual insights, graces received, challenges encountered..."
                              onchange="saveDailyNotes()"></textarea>
                </div>

            </div>

            <!-- Journal Tab -->
            <div id="journal-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚úçÔ∏è Spiritual Journal</h2>
                
                <!-- Date Selector and Entry Info -->
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Select Date:</label>
                                <input type="date" id="journal-date" 
                                       class="px-3 py-2 border border-indigo-300 rounded-md text-sm"
                                       onchange="loadJournalEntry()">
                            </div>
                            <button onclick="setJournalToToday()" 
                                    class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm hover:bg-indigo-700 mt-5">
                                Today
                            </button>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600" id="journal-entry-status">No entry for this date</p>
                            <p class="text-xs text-gray-500" id="journal-word-count">0 words</p>
                        </div>
                    </div>
                </div>

                <!-- Journal Entry Area -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-4 shadow-sm">
                    <div class="mb-3">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Daily Reflection:</label>
                        <textarea id="journal-entry" 
                                  rows="20" 
                                  placeholder="Write your spiritual reflections here...

What happened today?
How did I experience God's presence?
What am I grateful for?
What challenges did I face?
How did I grow in virtue?
What prayers were answered?
What did I learn about myself or my faith?

'For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope.' - Jeremiah 29:11"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-md text-base leading-relaxed resize-y min-h-96"
                                  oninput="updateJournalWordCount(); autoSaveJournal()"></textarea>
                    </div>
                    
                    <!-- Optional Prompts -->
                    <details class="mb-3">
                        <summary class="cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900">
                            üí° Click for journal prompts & inspiration
                        </summary>
                        <div class="mt-3 p-4 bg-indigo-50 rounded-lg border border-indigo-200 text-sm">
                            <p class="font-semibold text-gray-800 mb-2">Daily Reflection Questions:</p>
                            <ul class="list-disc list-inside space-y-1 text-gray-700 ml-2">
                                <li>What moments of grace did I experience today?</li>
                                <li>Where did I see God working in my life?</li>
                                <li>How did I respond to challenges with faith?</li>
                                <li>What sins or temptations did I face? How did I respond?</li>
                                <li>Who did I encounter today? How did I serve them?</li>
                                <li>What Scripture passage spoke to me today?</li>
                                <li>How did I pray today? Was I attentive?</li>
                                <li>What am I grateful for right now?</li>
                                <li>What virtue am I being called to grow in?</li>
                                <li>What is God teaching me through today's experiences?</li>
                            </ul>
                            
                            <p class="font-semibold text-gray-800 mt-4 mb-2">Weekly Reflection Questions:</p>
                            <ul class="list-disc list-inside space-y-1 text-gray-700 ml-2">
                                <li>How has my prayer life been this week?</li>
                                <li>What patterns do I notice in my spiritual journey?</li>
                                <li>How have I grown closer to God this week?</li>
                                <li>What areas need more attention or conversion?</li>
                                <li>How have I served others this week?</li>
                            </ul>
                        </div>
                    </details>

                    <!-- Save Button -->
                    <div class="flex items-center justify-between">
                        <button onclick="saveJournalEntry()" 
                                class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 font-semibold">
                            üíæ Save Entry
                        </button>
                        <span id="journal-save-status" class="text-sm text-gray-500 italic"></span>
                    </div>
                </div>

                <!-- Journal Management -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- View Past Entries -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-3">üìñ Past Entries</h3>
                        <div id="journal-entries-list" class="space-y-2 max-h-64 overflow-y-auto">
                            <p class="text-sm text-gray-600 italic">No journal entries yet. Start writing!</p>
                        </div>
                    </div>

                    <!-- Search Journal -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h3 class="font-semibold text-purple-800 mb-3">üîç Search Journal</h3>
                        <input type="text" id="journal-search" 
                               placeholder="Search your entries..." 
                               class="w-full px-3 py-2 border border-purple-300 rounded-md text-sm mb-2"
                               oninput="searchJournal()">
                        <div id="journal-search-results" class="space-y-2 max-h-48 overflow-y-auto">
                            <p class="text-sm text-gray-600 italic">Search results will appear here</p>
                        </div>
                    </div>
                </div>

                <!-- Export Journal -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h3 class="font-semibold text-amber-800 mb-3">üì§ Export Journal</h3>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="exportJournalAsText()" 
                                class="bg-amber-600 text-white px-4 py-2 rounded-md text-sm hover:bg-amber-700">
                            Export as Text File
                        </button>
                        <button onclick="exportJournalAsJSON()" 
                                class="bg-amber-600 text-white px-4 py-2 rounded-md text-sm hover:bg-amber-700">
                            Export as JSON
                        </button>
                        <button onclick="confirmDeleteAllJournalEntries()" 
                                class="bg-red-600 text-white px-4 py-2 rounded-md text-sm hover:bg-red-700 ml-auto">
                            üóëÔ∏è Delete All Entries
                        </button>
                    </div>
                </div>

                <!-- Journal Tips -->
                <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 mt-4">
                    <h3 class="font-semibold text-gray-800 mb-2">üí° Journaling Tips:</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                        <li><strong>Be Honest:</strong> Write authentically about your spiritual journey</li>
                        <li><strong>Be Regular:</strong> Try to journal daily, even if just a few sentences</li>
                        <li><strong>Be Grateful:</strong> Include what you're thankful for each day</li>
                        <li><strong>Be Reflective:</strong> Look for patterns in your spiritual life</li>
                        <li><strong>Be Prayerful:</strong> Begin and end journaling with a brief prayer</li>
                        <li><strong>Review Regularly:</strong> Read past entries to see how God has been working</li>
                    </ul>
                </div>
            </div>

            <!-- Bible Tab -->
            <div id="bible-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìñ Holy Bible</h2>
                
                <!-- Lectio Divina Guide -->
                <details class="mb-6 bg-blue-50 border border-blue-200 rounded-lg">
                    <summary class="cursor-pointer p-4 font-semibold text-blue-900 hover:bg-blue-100 text-lg">
                        üôè Lectio Divina Guide
                    </summary>
                    <div class="px-4 pb-4">
                        <p class="text-gray-700 mb-3">Use these steps for prayerful scripture reading:</p>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700">
                            <li><strong>Lectio (Read):</strong> Read the passage slowly and attentively</li>
                            <li><strong>Meditatio (Meditate):</strong> Reflect on what strikes you</li>
                            <li><strong>Oratio (Pray):</strong> Respond to God in prayer</li>
                            <li><strong>Contemplatio (Contemplate):</strong> Rest in God's presence</li>
                        </ol>
                    </div>
                </details>
                
                <!-- Upload Bible Section -->
                <div id="bible-upload-section" class="bg-indigo-50 border border-indigo-200 rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-indigo-900 mb-3">Upload Bible File</h3>
                    <p class="text-sm text-gray-700 mb-4">
                        Upload a Bible in JSON format to read, highlight, and take notes.
                    </p>
                    
                    <input type="file" id="bible-file-input" accept=".json" class="mb-3" onchange="loadBibleFile(event)">
                    
                    <div id="bible-upload-status" class="text-sm mt-2"></div>
                    
                    <details class="mt-4">
                        <summary class="cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900">
                            üìÑ Expected File Format
                        </summary>
                        <pre class="mt-2 bg-white p-3 rounded border text-xs overflow-x-auto"><code>{
  "books": [
    {
      "name": "Genesis",
      "chapters": [
        {
          "number": 1,
          "verses": [
            {"number": 1, "text": "In the beginning..."},
            {"number": 2, "text": "..."}
          ]
        }
      ]
    }
  ]
}</code></pre>
                    </details>
                </div>

                <!-- Bible Reading Interface -->
                <div id="bible-reading-section" style="display: none;">
                    <!-- Highlight Toolbar -->
                    <div class="highlight-toolbar">
                        <span class="text-sm font-semibold text-gray-700 mr-2">Highlight:</span>
                        <button class="highlight-btn" style="background-color: #fef08a;" onclick="selectHighlightColor('yellow')" title="Yellow"></button>
                        <button class="highlight-btn" style="background-color: #86efac;" onclick="selectHighlightColor('green')" title="Green"></button>
                        <button class="highlight-btn" style="background-color: #93c5fd;" onclick="selectHighlightColor('blue')" title="Blue"></button>
                        <button class="highlight-btn" style="background-color: #f9a8d4;" onclick="selectHighlightColor('pink')" title="Pink"></button>
                        <button class="highlight-btn" style="background-color: #fdba74;" onclick="selectHighlightColor('orange')" title="Orange"></button>
                        <button class="highlight-btn bg-white" onclick="selectHighlightColor('none')" title="Remove Highlight">
                            <span class="text-red-600 font-bold">‚úï</span>
                        </button>
                        <span class="text-xs text-gray-500 ml-4">üí° Click verse text to highlight, click verse number to add note</span>
                    </div>

                    <!-- Book & Chapter Selector -->
                    <div class="bg-white border-b border-gray-200 p-4">
                        <div class="flex flex-wrap gap-4 items-center">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Book:</label>
                                <select id="bible-book-select" onchange="loadBibleBook()" 
                                        class="px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Select a book...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Chapter:</label>
                                <select id="bible-chapter-select" onchange="loadBibleChapter()" 
                                        class="px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Select chapter...</option>
                                </select>
                            </div>
                        </div>

                        <!-- Quick Book Navigation -->
                        <details class="mt-4">
                            <summary class="cursor-pointer text-sm font-semibold text-indigo-700 hover:text-indigo-900">
                                üìö Quick Book Navigation
                            </summary>
                            <div id="bible-book-nav" class="bible-book-nav mt-3"></div>
                        </details>
                    </div>

                    <!-- Reading Pane -->
                    <div id="bible-reading-pane" class="bg-white p-6 min-h-96"></div>

                    <!-- Annotations Manager -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">üìù My Annotations</h3>
                        
                        <div class="flex gap-2 mb-4">
                            <button onclick="filterAnnotations('all')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100">
                                All
                            </button>
                            <button onclick="filterAnnotations('highlights')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100">
                                Highlights Only
                            </button>
                            <button onclick="filterAnnotations('notes')" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-100">
                                Notes Only
                            </button>
                        </div>

                        <div id="annotations-list" class="space-y-2 max-h-96 overflow-y-auto mb-4"></div>

                        <div class="flex gap-3">
                            <button onclick="exportBibleAnnotations()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 text-sm">
                                üì• Export Annotations
                            </button>
                            <button onclick="confirmClearBibleAnnotations()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 text-sm">
                                üóëÔ∏è Clear All
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Readings Tab -->
            <div id="readings-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìö Catholic Resources</h2>
                
                <!-- Parish & Resources Finder -->
                <div class="bg-teal-50 border border-teal-200 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-teal-900 mb-3">‚õ™ Find Catholic Resources Near You</h3>
                    <p class="text-gray-700 mb-4">
                        Find parishes, confession times, and Catholic communities in your area.
                    </p>
                    <div class="space-y-3">
                        <a href="https://masstimes.org/" target="_blank" class="block bg-teal-600 text-white px-6 py-3 rounded-md hover:bg-teal-700 transition font-semibold shadow-md text-center">
                            üó∫Ô∏è Find Mass Times Near Me
                        </a>
                        <a href="https://www.catholicdirectory.com/" target="_blank" class="block bg-teal-600 text-white px-6 py-3 rounded-md hover:bg-teal-700 transition font-semibold shadow-md text-center">
                            üèõÔ∏è Catholic Parish Directory
                        </a>
                        <a href="https://www.theeucharist.org/adoration.html" target="_blank" class="block bg-teal-600 text-white px-6 py-3 rounded-md hover:bg-teal-700 transition font-semibold shadow-md text-center">
                            ‚ú® Find Adoration Chapels
                        </a>
                    </div>
                </div>
                
                <div id="readings-loading" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                    <p class="text-gray-600 mt-4">Loading today's readings...</p>
                </div>
                
                <div id="readings-error" style="display: none;" class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <p class="text-red-800 font-semibold">Unable to load readings</p>
                    <p class="text-red-600 text-sm mt-2">Please check your internet connection or visit <a href="https://bible.usccb.org/daily-bible-reading" class="underline" target="_blank">USCCB Daily Readings</a></p>
                </div>
                
                <div id="readings-content" style="display: none;" class="space-y-6">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <!-- Confession Tab -->
            <div id="confession-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üíú Sacrament of Reconciliation</h2>
                
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-purple-900 mb-2">
                        <strong>Last Confession:</strong> <span id="last-confession-date">Never recorded</span>
                    </p>
                    <button onclick="recordNewConfession()" 
                            class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition">
                        Prepare for Confession
                    </button>
                </div>

                <!-- Sin Tracker Summary for Confession -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-3">üìã Sins Tracked Since Last Confession</h3>
                    <div id="confession-sin-summary" class="space-y-2">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <div id="confession-form" style="display: none;" class="mb-6 bg-gray-50 border border-gray-200 rounded-lg p-6">
                    
                    <!-- Confession Process Guide -->
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-purple-900 mb-4">üôè Steps for a Good Confession</h3>
                        <div class="text-gray-700 space-y-3 text-sm">
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">1.</span>
                                <span><strong>Sign of the Cross</strong></span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">2.</span>
                                <span><strong>Greeting:</strong> "Bless me, Father, for I have sinned. My last confession was..." (weeks, months, years)</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">3.</span>
                                <span><strong>Confess your sins</strong> to the priest (use examination below)</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">4.</span>
                                <span><strong>Conclude:</strong> "This is all I can remember. I am sorry for these and all my sins."</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">5.</span>
                                <span><strong>Receive penance</strong> from the priest</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">6.</span>
                                <div>
                                    <span><strong>Pray Act of Contrition:</strong></span>
                                    <div class="mt-2 pl-4 italic text-gray-600 border-l-2 border-purple-300">
                                        <p>My God,<br>
                                        I am sorry for my sins with all my heart.<br>
                                        In choosing to do wrong<br>
                                        and failing to do good,<br>
                                        I have sinned against you<br>
                                        whom I should love above all things.<br>
                                        I firmly intend, with your help,<br>
                                        to do penance,<br>
                                        to sin no more,<br>
                                        and to avoid whatever leads me to sin.<br>
                                        Our Savior Jesus Christ<br>
                                        suffered and died for us.<br>
                                        In his name, my God, have mercy.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">7.</span>
                                <span><strong>Receive Absolution</strong> from the priest</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">8.</span>
                                <span><strong>Sign of the Cross</strong> and respond "Amen"</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">9.</span>
                                <span><strong>Receive blessing</strong> from the priest</span>
                            </div>
                            <div class="flex gap-3">
                                <span class="font-bold text-purple-700 min-w-[24px]">10.</span>
                                <span><strong>Complete your penance</strong></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dynamic Confession Checklist Container -->
                    <div id="confession-checklist-container">
                        <!-- Checklist will be dynamically generated here -->
                    </div>
                    <div class="mt-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Additional Notes (Optional)</label>
                        <textarea id="confession-notes" rows="3" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                  placeholder="Any other sins or spiritual insights..."></textarea>
                    </div>

                    <div class="mt-6 flex space-x-4">
                        <button onclick="saveConfession()" 
                                class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition font-semibold">
                            Save Examination
                        </button>
                        <button onclick="cancelConfession()" 
                                class="bg-gray-400 text-white px-6 py-3 rounded-md hover:bg-gray-500 transition">
                            Cancel
                        </button>
                    </div>
                </div>

                <!-- Confession History -->
                <div id="confession-history" class="mt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Examination History</h3>
                    <div id="confession-list" class="space-y-3">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Sin Tracker Tab -->
            <div id="confession-tracker-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìä Track Sins Between Confessions</h2>
                
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-purple-900 mb-2">
                        <strong>Days Since Last Confession:</strong> <span id="days-since-confession">-</span>
                    </p>
                    <p class="text-sm text-purple-900">
                        <strong>Next Recommended Confession:</strong> <span id="next-confession-date">-</span>
                    </p>
                </div>

                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-amber-900 mb-2">How This Works</h3>
                    <p class="text-sm text-gray-700 mb-2">
                        Track specific sins you struggle with between confessions. Each day you commit a sin, 
                        mark it here. When you go to confession, the counts reset but progress is saved.
                    </p>
                    <p class="text-sm text-gray-700">
                        This helps you see patterns, track improvement, and prepare for confession.
                    </p>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Today's Sin Tracking</h3>
                    <p class="text-sm text-gray-500 mb-4" id="tracker-date"></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="sin-tracker-list">
                        <!-- Will be populated with common sins -->
                    </div>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-3">Current Period Summary</h3>
                    <div id="sin-summary" class="space-y-2">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Works of Mercy Tab -->
            <div id="mercy-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">ü§≤ Works of Mercy</h2>
                
                <!-- Corporal Works -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMercySection('corporal-content')" class="w-full text-left p-4 bg-orange-100 hover:bg-orange-200 transition">
                        <h3 class="text-xl font-bold text-orange-900"><span class="arrow">‚ñ∂</span> Corporal Works of Mercy</h3>
                    </button>
                    <div id="corporal-content" class="p-6" style="display: none;">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('feed-hungry')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Feed the Hungry</span>
                                    <span class="text-sm text-gray-600">Provide food to those in need</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('feed-hungry', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('give-drink')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Give Drink to the Thirsty</span>
                                    <span class="text-sm text-gray-600">Provide water or refreshment</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('give-drink', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('clothe-naked')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Clothe the Naked</span>
                                    <span class="text-sm text-gray-600">Donate clothing or help those without</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('clothe-naked', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('shelter-homeless')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Shelter the Homeless</span>
                                    <span class="text-sm text-gray-600">Provide housing or support shelters</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('shelter-homeless', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('visit-sick')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Visit the Sick</span>
                                    <span class="text-sm text-gray-600">Care for the ill and infirm</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('visit-sick', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('visit-imprisoned')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Visit the Imprisoned</span>
                                    <span class="text-sm text-gray-600">Minister to those in prison</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('visit-imprisoned', this.value)"></textarea>
                        </div>

                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-orange-600 rounded" onchange="saveWorkOfMercy('bury-dead')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Bury the Dead</span>
                                    <span class="text-sm text-gray-600">Honor the deceased, attend funerals</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-orange-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('bury-dead', this.value)"></textarea>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Spiritual Works -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMercySection('spiritual-content')" class="w-full text-left p-4 bg-blue-100 hover:bg-blue-200 transition">
                        <h3 class="text-xl font-bold text-blue-900"><span class="arrow">‚ñ∂</span> Spiritual Works of Mercy</h3>
                    </button>
                    <div id="spiritual-content" class="p-6" style="display: none;">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('instruct-ignorant')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Instruct the Ignorant</span>
                                    <span class="text-sm text-gray-600">Share knowledge of the faith</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('instruct-ignorant', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('counsel-doubtful')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Counsel the Doubtful</span>
                                    <span class="text-sm text-gray-600">Provide spiritual guidance</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('counsel-doubtful', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('admonish-sinners')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Admonish Sinners</span>
                                    <span class="text-sm text-gray-600">Fraternal correction with charity</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('admonish-sinners', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('bear-wrongs')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Bear Wrongs Patiently</span>
                                    <span class="text-sm text-gray-600">Endure injuries without resentment</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('bear-wrongs', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('forgive-offenses')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Forgive Offenses Willingly</span>
                                    <span class="text-sm text-gray-600">Practice mercy and forgiveness</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('forgive-offenses', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('comfort-afflicted')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Comfort the Afflicted</span>
                                    <span class="text-sm text-gray-600">Console those who suffer</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('comfort-afflicted', this.value)"></textarea>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <label class="flex items-start space-x-3">
                                <input type="checkbox" class="mt-1 w-5 h-5 text-blue-600 rounded" onchange="saveWorkOfMercy('pray-living-dead')">
                                <div>
                                    <span class="font-semibold text-gray-800 block">Pray for the Living and Dead</span>
                                    <span class="text-sm text-gray-600">Intercede for others and holy souls</span>
                                </div>
                            </label>
                            <textarea placeholder="Details (optional)" rows="2" 
                                      class="w-full mt-2 px-3 py-2 border border-blue-300 rounded-md text-sm"
                                      onchange="saveWorkOfMercyNotes('pray-living-dead', this.value)"></textarea>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Prayers & Devotions Tab -->
            <div id="prayers-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üôè Prayers & Devotions</h2>
                
                <!-- The Holy Rosary Section -->
                <details class="mb-6 bg-indigo-50 border-2 border-indigo-300 rounded-lg">
                    <summary class="cursor-pointer p-4 font-bold text-indigo-900 hover:bg-indigo-100 text-xl">
                        üìø The Holy Rosary
                    </summary>
                    <div class="px-4 pb-4">
                        <div class="bg-white p-4 rounded-lg border border-indigo-200 mb-4">
                            <p class="text-gray-700 mb-2"><strong>The Rosary</strong> is a powerful meditation on the life of Christ through the eyes of His Mother Mary. Pray it daily according to the mysteries of the day:</p>
                        </div>
                    
                    <details class="bg-gray-100 border border-gray-300 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-200">
                            üìù How to Pray the Rosary (Step-by-Step)
                        </summary>
                        <div class="p-4 pt-0">
                            <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700 ml-2">
                                <li>Make the Sign of the Cross and say the Apostles' Creed</li>
                                <li>Say the Our Father</li>
                                <li>Say three Hail Marys (for faith, hope, and charity)</li>
                                <li>Say the Glory Be</li>
                                <li>Announce the first mystery and say the Our Father</li>
                                <li>Say ten Hail Marys while meditating on the mystery</li>
                                <li>Say the Glory Be and Fatima Prayer</li>
                                <li>Repeat steps 5-7 for each of the five mysteries</li>
                                <li>Say the Hail Holy Queen</li>
                                <li>Say the Concluding Prayer (optional)</li>
                                <li>Make the Sign of the Cross</li>
                            </ol>
                        </div>
                    </details>
                    
                    <!-- Joyful Mysteries -->
                    <details class="bg-blue-50 border border-blue-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-blue-800 hover:bg-blue-100 text-lg">
                            ‚ú® Joyful Mysteries (Monday & Saturday)
                        </summary>
                        <div class="p-5 pt-0">
                            <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-2">
                                <li><strong>The Annunciation</strong> - The Angel Gabriel announces to Mary that she will be the Mother of God (Luke 1:26-38)</li>
                                <li><strong>The Visitation</strong> - Mary visits her cousin Elizabeth, who is pregnant with John the Baptist (Luke 1:39-56)</li>
                                <li><strong>The Nativity</strong> - Jesus is born in Bethlehem (Luke 2:1-20)</li>
                                <li><strong>The Presentation</strong> - Mary and Joseph present Jesus in the Temple (Luke 2:22-38)</li>
                                <li><strong>The Finding in the Temple</strong> - Mary and Joseph find the young Jesus teaching in the Temple (Luke 2:41-52)</li>
                            </ol>
                        </div>
                    </details>
                    
                    <!-- Luminous Mysteries -->
                    <details class="bg-yellow-50 border border-yellow-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-yellow-800 hover:bg-yellow-100 text-lg">
                            üí° Luminous Mysteries (Thursday)
                        </summary>
                        <div class="p-5 pt-0">
                            <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-2">
                                <li><strong>The Baptism in the Jordan</strong> - Jesus is baptized by John and the Holy Spirit descends (Matthew 3:13-17)</li>
                                <li><strong>The Wedding at Cana</strong> - Jesus performs His first miracle at Mary's request (John 2:1-11)</li>
                                <li><strong>The Proclamation of the Kingdom</strong> - Jesus announces the Kingdom of God and calls us to conversion (Mark 1:14-15)</li>
                                <li><strong>The Transfiguration</strong> - Jesus is transfigured before Peter, James, and John (Matthew 17:1-8)</li>
                                <li><strong>The Institution of the Eucharist</strong> - Jesus gives us His Body and Blood at the Last Supper (Matthew 26:26-28)</li>
                            </ol>
                        </div>
                    </details>
                    
                    <!-- Sorrowful Mysteries -->
                    <details class="bg-purple-50 border border-purple-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-purple-800 hover:bg-purple-100 text-lg">
                            ‚ö´ Sorrowful Mysteries (Tuesday & Friday)
                        </summary>
                        <div class="p-5 pt-0">
                            <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-2">
                                <li><strong>The Agony in the Garden</strong> - Jesus prays in the Garden of Gethsemane, sweating blood (Luke 22:39-46)</li>
                                <li><strong>The Scourging at the Pillar</strong> - Jesus is brutally whipped by Roman soldiers (John 19:1)</li>
                                <li><strong>The Crowning with Thorns</strong> - Soldiers mock Jesus, placing a crown of thorns on His head (Matthew 27:27-31)</li>
                                <li><strong>The Carrying of the Cross</strong> - Jesus carries His cross to Calvary (John 19:17)</li>
                                <li><strong>The Crucifixion</strong> - Jesus dies on the cross for our sins (Luke 23:33-46)</li>
                            </ol>
                        </div>
                    </details>
                    
                    <!-- Glorious Mysteries -->
                    <details class="bg-green-50 border border-green-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-green-800 hover:bg-green-100 text-lg">
                            üåü Glorious Mysteries (Wednesday & Sunday)
                        </summary>
                        <div class="p-5 pt-0">
                            <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-2">
                                <li><strong>The Resurrection</strong> - Jesus rises from the dead on the third day (Matthew 28:1-10)</li>
                                <li><strong>The Ascension</strong> - Jesus ascends into heaven forty days after His resurrection (Acts 1:9-11)</li>
                                <li><strong>The Descent of the Holy Spirit</strong> - The Holy Spirit descends upon the Apostles at Pentecost (Acts 2:1-4)</li>
                                <li><strong>The Assumption</strong> - Mary is taken body and soul into heaven (Revelation 12:1)</li>
                                <li><strong>The Coronation of Mary</strong> - Mary is crowned Queen of Heaven and Earth (Revelation 12:1)</li>
                            </ol>
                        </div>
                    </details>
                    </div>
                </details>
                
                <!-- Essential Prayers Section -->
                <details class="mb-6 bg-gray-50 border-2 border-gray-400 rounded-lg">
                    <summary class="cursor-pointer p-4 font-bold text-gray-900 hover:bg-gray-100 text-xl">
                        üìñ Essential Prayers
                    </summary>
                    <div class="px-4 pb-4">
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            ‚úùÔ∏è Sign of the Cross
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic">In the name of the Father, and of the Son, and of the Holy Spirit. Amen.</p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üìú The Apostles' Creed
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                I believe in God, the Father almighty, Creator of heaven and earth, 
                                and in Jesus Christ, his only Son, our Lord, 
                                who was conceived by the Holy Spirit, born of the Virgin Mary, 
                                suffered under Pontius Pilate, was crucified, died and was buried; 
                                he descended into hell; on the third day he rose again from the dead; 
                                he ascended into heaven, and is seated at the right hand of God the Father almighty; 
                                from there he will come to judge the living and the dead.
                                <br><br>
                                I believe in the Holy Spirit, the holy catholic Church, 
                                the communion of saints, the forgiveness of sins, 
                                the resurrection of the body, and life everlasting. Amen.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üë® The Our Father (Lord's Prayer)
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                Our Father, who art in heaven, hallowed be thy name; 
                                thy kingdom come; thy will be done on earth as it is in heaven. 
                                Give us this day our daily bread; 
                                and forgive us our trespasses as we forgive those who trespass against us; 
                                and lead us not into temptation, but deliver us from evil. Amen.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üë∏ The Hail Mary
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                Hail Mary, full of grace, the Lord is with thee; 
                                blessed art thou among women, and blessed is the fruit of thy womb, Jesus. 
                                Holy Mary, Mother of God, pray for us sinners, 
                                now and at the hour of our death. Amen.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            ‚ú® Glory Be (Doxology)
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                Glory be to the Father, and to the Son, and to the Holy Spirit, 
                                as it was in the beginning, is now, and ever shall be, 
                                world without end. Amen.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üåπ Fatima Prayer
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                O my Jesus, forgive us our sins, save us from the fires of hell, 
                                lead all souls to Heaven, especially those in most need of Thy mercy. Amen.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üëë Hail Holy Queen (Salve Regina)
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                Hail, Holy Queen, Mother of Mercy, our life, our sweetness and our hope. 
                                To thee do we cry, poor banished children of Eve. 
                                To thee do we send up our sighs, mourning and weeping in this valley of tears. 
                                Turn then, most gracious advocate, thine eyes of mercy toward us, 
                                and after this our exile show unto us the blessed fruit of thy womb, Jesus. 
                                O clement, O loving, O sweet Virgin Mary.
                            </p>
                        </div>
                    </details>
                    
                    <details class="bg-gray-50 border border-gray-300 rounded-lg mb-3">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-800 hover:bg-gray-100">
                            üôè Final Prayer (Concluding Prayer for the Rosary)
                        </summary>
                        <div class="p-4 pt-0">
                            <p class="text-gray-700 italic leading-relaxed">
                                O God, whose only-begotten Son, by His life, death and resurrection, 
                                has purchased for us the rewards of eternal life; 
                                grant, we beseech Thee, that meditating upon these mysteries 
                                of the Most Holy Rosary of the Blessed Virgin Mary, 
                                we may imitate what they contain and obtain what they promise, 
                                through the same Christ our Lord. Amen.
                            </p>
                        </div>
                    </details>
                    </div>
                </details>
                
                <!-- Popular Chaplets Section -->
                <details class="mb-6 bg-red-50 border-2 border-red-300 rounded-lg">
                    <summary class="cursor-pointer p-4 font-bold text-red-900 hover:bg-red-100 text-xl">
                        üìñ Popular Chaplets
                    </summary>
                    <div class="px-4 pb-4">
                    
                    <!-- Divine Mercy Chaplet -->
                    <details class="bg-red-50 border border-red-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-red-800 hover:bg-red-100 text-lg">
                            ‚ù§Ô∏è Divine Mercy Chaplet
                        </summary>
                        <div class="p-5 pt-0">
                            <p class="text-gray-700 mb-3 italic">"Jesus, I trust in You!" - Pray especially at 3:00 PM, the Hour of Great Mercy</p>
                            
                            <div class="space-y-3 text-gray-700">
                                <div>
                                    <p class="font-semibold">Opening:</p>
                                    <p class="ml-4 text-sm">1. Make the Sign of the Cross</p>
                                    <p class="ml-4 text-sm italic mt-1">In the name of the Father, and of the Son, and of the Holy Spirit. Amen.</p>
                                    <p class="ml-4 text-sm mt-2">2. Optional Opening Prayers:</p>
                                    <p class="ml-4 text-sm">‚Ä¢ One Our Father</p>
                                    <p class="ml-4 text-sm">‚Ä¢ One Hail Mary</p>
                                    <p class="ml-4 text-sm">‚Ä¢ The Apostles' Creed</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On the Our Father bead (once before each decade):</p>
                                    <p class="ml-4 text-sm italic">"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On each of the 10 Hail Mary beads:</p>
                                    <p class="ml-4 text-sm italic">"For the sake of His sorrowful Passion, have mercy on us and on the whole world."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Repeat for 5 decades (5 sets of the above)</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Concluding Doxology (repeat 3 times):</p>
                                    <p class="ml-4 text-sm italic">"Holy God, Holy Mighty One, Holy Immortal One, have mercy on us and on the whole world."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Closing Prayer (optional):</p>
                                    <p class="ml-4 text-sm italic">"Eternal God, in whom mercy is endless and the treasury of compassion inexhaustible, look kindly upon us and increase Your mercy in us, that in difficult moments we might not despair nor become despondent, but with great confidence submit ourselves to Your holy will, which is Love and Mercy itself. Amen."</p>
                                </div>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Chaplet of St. Michael -->
                    <details class="bg-blue-50 border border-blue-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-blue-800 hover:bg-blue-100 text-lg">
                            ‚öîÔ∏è Chaplet of St. Michael the Archangel
                        </summary>
                        <div class="p-5 pt-0">
                            <p class="text-gray-700 mb-3 italic">"St. Michael the Archangel, defend us in battle..."</p>
                            
                            <div class="space-y-3 text-gray-700">
                                <div>
                                    <p class="font-semibold">Opening:</p>
                                    <p class="ml-4 text-sm">Say one Our Father and three Hail Marys on the first three beads.</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">For each of the 9 Choirs of Angels:</p>
                                    <p class="ml-4 text-sm mt-2"><strong>1. Seraphim:</strong> "By the intercession of St. Michael and the celestial Choir of Seraphim, may the Lord make us worthy to burn with the fire of perfect charity. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>2. Cherubim:</strong> "By the intercession of St. Michael and the celestial Choir of Cherubim, may the Lord grant us grace to leave the ways of sin and run in the paths of Christian perfection. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>3. Thrones:</strong> "By the intercession of St. Michael and the celestial Choir of Thrones, may the Lord infuse into our hearts a true and sincere spirit of humility. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>4. Dominions:</strong> "By the intercession of St. Michael and the celestial Choir of Dominions, may the Lord give us grace to govern our senses and overcome any unruly passions. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>5. Powers:</strong> "By the intercession of St. Michael and the celestial Choir of Powers, may the Lord protect our souls against the snares and temptations of the devil. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>6. Virtues:</strong> "By the intercession of St. Michael and the celestial Choir of Virtues, may the Lord preserve us from evil and falling into temptation. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>7. Principalities:</strong> "By the intercession of St. Michael and the celestial Choir of Principalities, may God fill our souls with a true spirit of obedience. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>8. Archangels:</strong> "By the intercession of St. Michael and the celestial Choir of Archangels, may the Lord give us perseverance in faith and in all good works. Amen."</p>
                                    <p class="ml-4 text-sm"><strong>9. Angels:</strong> "By the intercession of St. Michael and the celestial Choir of Angels, may the Lord grant us to be protected by them in this mortal life and conducted to eternal glory. Amen."</p>
                                    <p class="ml-4 text-sm mt-2 font-semibold">After each invocation: Say one Our Father and three Hail Marys</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Closing:</p>
                                    <p class="ml-4 text-sm">Say four Our Fathers in honor of St. Michael, St. Gabriel, St. Raphael, and your Guardian Angel</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">St. Michael Prayer (Final):</p>
                                    <p class="ml-4 text-sm italic">"St. Michael the Archangel, defend us in battle. Be our protection against the wickedness and snares of the devil. May God rebuke him, we humbly pray; and do thou, O Prince of the heavenly host, by the power of God, thrust into hell Satan and all evil spirits who prowl about the world seeking the ruin of souls. Amen."</p>
                                </div>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Chaplet of the Sacred Heart -->
                    <details class="bg-pink-50 border border-pink-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-pink-800 hover:bg-pink-100 text-lg">
                            ‚ù§Ô∏è‚Äçüî• Chaplet of the Sacred Heart of Jesus
                        </summary>
                        <div class="p-5 pt-0">
                            <p class="text-gray-700 mb-3 italic">"Sacred Heart of Jesus, I place my trust in Thee!"</p>
                            
                            <div class="space-y-3 text-gray-700">
                                <div>
                                    <p class="font-semibold">Opening:</p>
                                    <p class="ml-4 text-sm">Make the Sign of the Cross</p>
                                    <p class="ml-4 text-sm italic mt-1">In the name of the Father, and of the Son, and of the Holy Spirit. Amen.</p>
                                    <p class="ml-4 text-sm mt-2">Say one Our Father, one Hail Mary, and one Glory Be</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On each large bead (5 times):</p>
                                    <p class="ml-4 text-sm italic">"Most Sacred Heart of Jesus, have mercy on us."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On each small bead (33 times total - 10, 10, 10, 3):</p>
                                    <p class="ml-4 text-sm italic">"Sacred Heart of Jesus, I place my trust in Thee."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Closing Prayer:</p>
                                    <p class="ml-4 text-sm italic">"Sacred Heart of Jesus, I have asked You for many favors, but I earnestly implore this one. Take it, place it in Your open Heart. When the Eternal Father looks upon it, He will see it covered with Your Precious Blood. It will be no longer my prayer, but Yours, Jesus. Sacred Heart of Jesus, I place my trust in Thee. Amen."</p>
                                </div>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Chaplet of the Immaculate Heart of Mary -->
                    <details class="bg-blue-50 border border-blue-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-blue-800 hover:bg-blue-100 text-lg">
                            üíô Chaplet of the Immaculate Heart of Mary
                        </summary>
                        <div class="p-5 pt-0">
                            <p class="text-gray-700 mb-3 italic">"Immaculate Heart of Mary, pray for us!"</p>
                            
                            <div class="space-y-3 text-gray-700">
                                <div>
                                    <p class="font-semibold">Opening:</p>
                                    <p class="ml-4 text-sm">Make the Sign of the Cross</p>
                                    <p class="ml-4 text-sm">Say the Apostles' Creed, one Our Father, and three Hail Marys</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On each large bead (5 times):</p>
                                    <p class="ml-4 text-sm italic">"O Immaculate Heart of Mary, full of goodness, show your love towards us. Let the flame of your heart, O Mary, descend on all mankind."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">On each small bead (53 times total):</p>
                                    <p class="ml-4 text-sm italic">"Immaculate Heart of Mary, pray for us now and at the hour of our death."</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Closing:</p>
                                    <p class="ml-4 text-sm">Say the Hail Holy Queen</p>
                                    <p class="ml-4 text-sm italic mt-1">"Hail, Holy Queen, Mother of Mercy, our life, our sweetness and our hope. To thee do we cry, poor banished children of Eve. To thee do we send up our sighs, mourning and weeping in this valley of tears. Turn then, most gracious advocate, thine eyes of mercy toward us, and after this our exile show unto us the blessed fruit of thy womb, Jesus. O clement, O loving, O sweet Virgin Mary."</p>
                                    <p class="ml-4 text-sm mt-2">Make the Sign of the Cross</p>
                                </div>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Chaplet of St. Joseph -->
                    <details class="bg-amber-50 border border-amber-200 rounded-lg mb-4">
                        <summary class="cursor-pointer p-4 font-bold text-amber-800 hover:bg-amber-100 text-lg">
                            üî® Chaplet of St. Joseph
                        </summary>
                        <div class="p-5 pt-0">
                            <p class="text-gray-700 mb-3 italic">"St. Joseph, patron of the Universal Church, pray for us!"</p>
                            
                            <div class="space-y-3 text-gray-700">
                                <div>
                                    <p class="font-semibold">Opening:</p>
                                    <p class="ml-4 text-sm">Make the Sign of the Cross</p>
                                    <p class="ml-4 text-sm">Say one Our Father, one Hail Mary, and one Glory Be</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Meditate on the Seven Sorrows and Seven Joys of St. Joseph:</p>
                                </div>
                                
                                <div class="ml-4">
                                    <p class="font-semibold text-sm">For each Sorrow and Joy (7 times total):</p>
                                    <p class="ml-4 text-sm">1. Say one Our Father</p>
                                    <p class="ml-4 text-sm">2. Say seven Hail Marys</p>
                                    <p class="ml-4 text-sm">3. Say one Glory Be</p>
                                </div>
                                
                                <div class="ml-4">
                                    <p class="font-semibold text-sm">The Seven Sorrows and Joys:</p>
                                    <p class="ml-4 text-sm"><strong>1.</strong> <em>Sorrow:</em> Joseph's doubt about Mary | <em>Joy:</em> The angel's message in a dream</p>
                                    <p class="ml-4 text-sm"><strong>2.</strong> <em>Sorrow:</em> Jesus born in poverty | <em>Joy:</em> The birth of the Savior</p>
                                    <p class="ml-4 text-sm"><strong>3.</strong> <em>Sorrow:</em> The circumcision | <em>Joy:</em> The holy name of Jesus</p>
                                    <p class="ml-4 text-sm"><strong>4.</strong> <em>Sorrow:</em> Simeon's prophecy | <em>Joy:</em> Redemption foretold</p>
                                    <p class="ml-4 text-sm"><strong>5.</strong> <em>Sorrow:</em> Flight into Egypt | <em>Joy:</em> Being with Jesus and Mary</p>
                                    <p class="ml-4 text-sm"><strong>6.</strong> <em>Sorrow:</em> Return from Egypt in fear | <em>Joy:</em> Living with Jesus and Mary in Nazareth</p>
                                    <p class="ml-4 text-sm"><strong>7.</strong> <em>Sorrow:</em> Loss of Jesus in the Temple | <em>Joy:</em> Finding Jesus teaching among the doctors</p>
                                </div>
                                
                                <div>
                                    <p class="font-semibold">Closing:</p>
                                    <p class="ml-4 text-sm">Say two Glory Bes:</p>
                                    <p class="ml-4 text-sm">‚Ä¢ One in thanksgiving to the Blessed Trinity for graces given to St. Joseph</p>
                                    <p class="ml-4 text-sm">‚Ä¢ One for the grace of a happy death</p>
                                </div>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Prayer Tips -->
                    <div class="bg-white p-4 rounded-lg border border-gray-300 mt-4">
                        <h4 class="font-semibold text-gray-800 mb-2">üìù Prayer Tips:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>Set aside a specific time each day for prayer</li>
                            <li>Find a quiet place free from distractions</li>
                            <li>Begin with the Sign of the Cross and a moment of silence</li>
                            <li>Meditate on the mysteries or intentions while praying</li>
                            <li>Pray slowly and reverently, not rushing through prayers</li>
                            <li>Offer your prayers for specific intentions</li>
                            <li>Use prayer beads or a rosary to keep count</li>
                            <li>End with gratitude and a blessing</li>
                        </ul>
                    </div>
                    </div>
                </details>
                
            </div>

            <!-- Mass Tab -->
            <div id="mass-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚úùÔ∏è Order of the Mass</h2>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-900">
                        The Holy Mass is the central act of Catholic worship. This guide follows the structure of the Ordinary Form (Novus Ordo) of the Roman Rite.
                    </p>
                </div>

                <!-- Introductory Rites -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMassSection('intro-content')" class="w-full text-left p-4 bg-indigo-100 hover:bg-indigo-200 transition">
                        <h3 class="text-xl font-bold text-indigo-900">‚ñ∂ I. Introductory Rites</h3>
                    </button>
                    <div id="intro-content" class="p-6 space-y-4" style="display: none;">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">1. Entrance Procession & Hymn</h4>
                            <p class="text-sm text-gray-700">The priest and ministers process to the altar while the congregation sings.</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">2. Sign of the Cross & Greeting</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "In the name of the Father, and of the Son, and of the Holy Spirit."</p>
                            <p class="text-sm text-gray-700 italic mb-1">All: "Amen."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "The Lord be with you."</p>
                            <p class="text-sm text-gray-700 italic">All: "And with your spirit."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">3. Penitential Act</h4>
                            <p class="text-sm text-gray-700 font-semibold mb-2">Confiteor (I Confess):</p>
                            <p class="text-sm text-gray-700 italic mb-1">"I confess to almighty God</p>
                            <p class="text-sm text-gray-700 italic mb-1">and to you, my brothers and sisters,</p>
                            <p class="text-sm text-gray-700 italic mb-1">that I have greatly sinned,</p>
                            <p class="text-sm text-gray-700 italic mb-1">in my thoughts and in my words,</p>
                            <p class="text-sm text-gray-700 italic mb-1">in what I have done and in what I have failed to do,</p>
                            <p class="text-sm text-gray-700 italic mb-2"><strong>through my fault, through my fault,</strong></p>
                            <p class="text-sm text-gray-700 italic mb-2"><strong>through my most grievous fault;</strong></p>
                            <p class="text-xs text-gray-600 mb-2">(Strike your breast three times during the bolded lines)</p>
                            <p class="text-sm text-gray-700 italic mb-1">therefore I ask blessed Mary ever-Virgin,</p>
                            <p class="text-sm text-gray-700 italic mb-1">all the Angels and Saints,</p>
                            <p class="text-sm text-gray-700 italic mb-1">and you, my brothers and sisters,</p>
                            <p class="text-sm text-gray-700 italic mb-3">to pray for me to the Lord our God."</p>
                            
                            <p class="text-sm text-gray-700 font-semibold mb-2">OR Kyrie Eleison:</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Lord, have mercy." All: "Lord, have mercy."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Christ, have mercy." All: "Christ, have mercy."</p>
                            <p class="text-sm text-gray-700 italic">Priest: "Lord, have mercy." All: "Lord, have mercy."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">4. Gloria (on Sundays & Solemnities)</h4>
                            <p class="text-sm text-gray-700 italic mb-1">"Glory to God in the highest,</p>
                            <p class="text-sm text-gray-700 italic mb-1">and on earth peace to people of good will.</p>
                            <p class="text-sm text-gray-700 italic mb-1">We praise you,</p>
                            <p class="text-sm text-gray-700 italic mb-1">we bless you,</p>
                            <p class="text-sm text-gray-700 italic mb-1">we adore you,</p>
                            <p class="text-sm text-gray-700 italic mb-1">we glorify you,</p>
                            <p class="text-sm text-gray-700 italic mb-1">we give you thanks for your great glory,</p>
                            <p class="text-sm text-gray-700 italic mb-1">Lord God, heavenly King,</p>
                            <p class="text-sm text-gray-700 italic mb-2">O God, almighty Father.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">Lord Jesus Christ, Only Begotten Son,</p>
                            <p class="text-sm text-gray-700 italic mb-1">Lord God, Lamb of God, Son of the Father,</p>
                            <p class="text-sm text-gray-700 italic mb-1">you take away the sins of the world,</p>
                            <p class="text-sm text-gray-700 italic mb-1">have mercy on us;</p>
                            <p class="text-sm text-gray-700 italic mb-1">you take away the sins of the world,</p>
                            <p class="text-sm text-gray-700 italic mb-1">receive our prayer;</p>
                            <p class="text-sm text-gray-700 italic mb-1">you are seated at the right hand of the Father,</p>
                            <p class="text-sm text-gray-700 italic mb-2">have mercy on us.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">For you alone are the Holy One,</p>
                            <p class="text-sm text-gray-700 italic mb-1">you alone are the Lord,</p>
                            <p class="text-sm text-gray-700 italic mb-1">you alone are the Most High,</p>
                            <p class="text-sm text-gray-700 italic mb-1">Jesus Christ,</p>
                            <p class="text-sm text-gray-700 italic mb-1">with the Holy Spirit,</p>
                            <p class="text-sm text-gray-700 italic">in the glory of God the Father. Amen."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">5. Collect (Opening Prayer)</h4>
                            <p class="text-sm text-gray-700">Priest prays the prayer of the day, all respond: "Amen."</p>
                        </div>
                    </div>
                </div>

                <!-- Liturgy of the Word -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMassSection('word-content')" class="w-full text-left p-4 bg-green-100 hover:bg-green-200 transition">
                        <h3 class="text-xl font-bold text-green-900">‚ñ∂ II. Liturgy of the Word</h3>
                    </button>
                    <div id="word-content" class="p-6" style="display: none;">
                    
                    <div class="bg-green-50 border-2 border-green-500 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-green-900 mb-2">üìñ Today's Mass Readings</h4>
                        <a href="https://bible.usccb.org/daily-bible-reading" target="_blank" 
                           class="inline-block bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 font-semibold">
                            ‚Üí Read Today's Scriptures
                        </a>
                        <p class="text-xs text-gray-600 mt-2">Click to view today's First Reading, Psalm, Second Reading, and Gospel</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">6. First Reading</h4>
                            <p class="text-sm text-gray-700">Usually from the Old Testament (or Acts during Easter)</p>
                            <p class="text-sm text-gray-700 italic">Reader concludes: "The word of the Lord." All: "Thanks be to God."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">7. Responsorial Psalm</h4>
                            <p class="text-sm text-gray-700">Sung or recited response to the first reading</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">8. Second Reading (Sundays & Solemnities)</h4>
                            <p class="text-sm text-gray-700">From the New Testament Epistles or Revelation</p>
                            <p class="text-sm text-gray-700 italic">Reader concludes: "The word of the Lord." All: "Thanks be to God."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">9. Gospel Acclamation</h4>
                            <p class="text-sm text-gray-700">All stand and sing "Alleluia" (or Lenten acclamation)</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">10. Gospel Reading</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest/Deacon: "The Lord be with you." All: "And with your spirit."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest/Deacon: "A reading from the holy Gospel according to..." All: "Glory to you, O Lord."</p>
                            <p class="text-sm text-gray-700 italic">After reading: "The Gospel of the Lord." All: "Praise to you, Lord Jesus Christ."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">11. Homily</h4>
                            <p class="text-sm text-gray-700">Priest or deacon reflects on the readings</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">12. Profession of Faith (Creed) - Sundays & Solemnities</h4>
                            <p class="text-sm text-gray-700 font-semibold mb-2">Nicene Creed:</p>
                            <p class="text-sm text-gray-700 italic mb-1">"I believe in one God,</p>
                            <p class="text-sm text-gray-700 italic mb-1">the Father almighty,</p>
                            <p class="text-sm text-gray-700 italic mb-1">maker of heaven and earth,</p>
                            <p class="text-sm text-gray-700 italic mb-2">of all things visible and invisible.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">I believe in one Lord Jesus Christ,</p>
                            <p class="text-sm text-gray-700 italic mb-1">the Only Begotten Son of God,</p>
                            <p class="text-sm text-gray-700 italic mb-1">born of the Father before all ages.</p>
                            <p class="text-sm text-gray-700 italic mb-1">God from God, Light from Light,</p>
                            <p class="text-sm text-gray-700 italic mb-1">true God from true God,</p>
                            <p class="text-sm text-gray-700 italic mb-1">begotten, not made, consubstantial with the Father;</p>
                            <p class="text-sm text-gray-700 italic mb-1">through him all things were made.</p>
                            <p class="text-sm text-gray-700 italic mb-1">For us men and for our salvation</p>
                            <p class="text-sm text-gray-700 italic mb-1">he came down from heaven,</p>
                            <p class="text-xs text-gray-600 mb-1">(Bow during the following two lines:)</p>
                            <p class="text-sm text-gray-700 italic mb-1"><strong>and by the Holy Spirit was incarnate of the Virgin Mary,</strong></p>
                            <p class="text-sm text-gray-700 italic mb-1"><strong>and became man.</strong></p>
                            <p class="text-sm text-gray-700 italic mb-1">For our sake he was crucified under Pontius Pilate,</p>
                            <p class="text-sm text-gray-700 italic mb-1">he suffered death and was buried,</p>
                            <p class="text-sm text-gray-700 italic mb-2">and rose again on the third day in accordance with the Scriptures.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">He ascended into heaven</p>
                            <p class="text-sm text-gray-700 italic mb-1">and is seated at the right hand of the Father.</p>
                            <p class="text-sm text-gray-700 italic mb-1">He will come again in glory</p>
                            <p class="text-sm text-gray-700 italic mb-1">to judge the living and the dead</p>
                            <p class="text-sm text-gray-700 italic mb-2">and his kingdom will have no end.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">I believe in the Holy Spirit, the Lord, the giver of life,</p>
                            <p class="text-sm text-gray-700 italic mb-1">who proceeds from the Father and the Son,</p>
                            <p class="text-sm text-gray-700 italic mb-1">who with the Father and the Son is adored and glorified,</p>
                            <p class="text-sm text-gray-700 italic mb-2">who has spoken through the prophets.</p>
                            
                            <p class="text-sm text-gray-700 italic mb-1">I believe in one, holy, catholic and apostolic Church.</p>
                            <p class="text-sm text-gray-700 italic mb-1">I confess one Baptism for the forgiveness of sins</p>
                            <p class="text-sm text-gray-700 italic mb-1">and I look forward to the resurrection of the dead</p>
                            <p class="text-sm text-gray-700 italic">and the life of the world to come. Amen."</p>
                            
                            <p class="text-sm text-gray-700 mt-3 font-semibold">OR Apostles' Creed (sometimes used)</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">13. Universal Prayer (Prayer of the Faithful)</h4>
                            <p class="text-sm text-gray-700">Intercessions for Church, world, suffering, and local community</p>
                            <p class="text-sm text-gray-700 italic">Response: "Lord, hear our prayer." or similar</p>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Liturgy of the Eucharist -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMassSection('eucharist-content')" class="w-full text-left p-4 bg-purple-100 hover:bg-purple-200 transition">
                        <h3 class="text-xl font-bold text-purple-900">‚ñ∂ III. Liturgy of the Eucharist</h3>
                    </button>
                    <div id="eucharist-content" class="p-6 space-y-4" style="display: none;">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">14. Preparation of the Gifts</h4>
                            <p class="text-sm text-gray-700">Bread and wine are brought to the altar, collection taken</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Blessed are you, Lord God of all creation..."</p>
                            <p class="text-sm text-gray-700 italic mb-1">All: "Blessed be God forever."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Pray, brothers and sisters, that my sacrifice and yours..."</p>
                            <p class="text-sm text-gray-700 italic">All: "May the Lord accept the sacrifice at your hands..."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">15. Prayer over the Offerings</h4>
                            <p class="text-sm text-gray-700">Priest prays, all respond: "Amen."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">16. Eucharistic Prayer</h4>
                            <p class="text-sm text-gray-700 font-semibold mb-2">Preface Dialogue:</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "The Lord be with you." All: "And with your spirit."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Lift up your hearts." All: "We lift them up to the Lord."</p>
                            <p class="text-sm text-gray-700 italic mb-3">Priest: "Let us give thanks to the Lord our God." All: "It is right and just."</p>
                            
                            <p class="text-sm text-gray-700 font-semibold mb-2">Holy, Holy, Holy:</p>
                            <p class="text-sm text-gray-700 italic mb-3">"Holy, Holy, Holy Lord God of hosts. Heaven and earth are full of your glory. Hosanna in the highest. Blessed is he who comes in the name of the Lord. Hosanna in the highest."</p>
                            
                            <p class="text-sm text-gray-700 font-semibold mb-2">Consecration:</p>
                            <p class="text-sm text-gray-700 mb-1">The priest recites the words of Jesus at the Last Supper</p>
                            <p class="text-sm text-gray-700 italic mb-1">Bread becomes the Body of Christ</p>
                            <p class="text-sm text-gray-700 italic mb-3">Wine becomes the Blood of Christ</p>
                            
                            <p class="text-sm text-gray-700 font-semibold mb-2">Mystery of Faith:</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "The mystery of faith."</p>
                            <p class="text-sm text-gray-700 italic mb-1">All: "We proclaim your Death, O Lord, and profess your Resurrection until you come again."</p>
                            <p class="text-sm text-gray-700 text-xs">(or one of the other acclamations)</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">17. The Lord's Prayer</h4>
                            <p class="text-sm text-gray-700 italic">"Our Father, who art in heaven..."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">18. Sign of Peace</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "The peace of the Lord be with you always."</p>
                            <p class="text-sm text-gray-700 italic mb-1">All: "And with your spirit."</p>
                            <p class="text-sm text-gray-700">Exchange sign of peace with those nearby</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">19. Lamb of God (Agnus Dei)</h4>
                            <p class="text-sm text-gray-700 italic">"Lamb of God, you take away the sins of the world, have mercy on us..." (repeated)</p>
                            <p class="text-sm text-gray-700 italic">"...grant us peace." (final time)</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">20. Holy Communion</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "Behold the Lamb of God, behold him who takes away the sins of the world. Blessed are those called to the supper of the Lamb."</p>
                            <p class="text-sm text-gray-700 italic mb-2">All: "Lord, I am not worthy that you should enter under my roof, but only say the word and my soul shall be healed."</p>
                            <p class="text-sm text-gray-700 mb-1">When receiving:</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest/Minister: "The Body of Christ." You: "Amen."</p>
                            <p class="text-sm text-gray-700 italic">Priest/Minister: "The Blood of Christ." You: "Amen."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">21. Prayer after Communion</h4>
                            <p class="text-sm text-gray-700">Priest prays, all respond: "Amen."</p>
                        </div>
                    </div>
                </div>

                <!-- Concluding Rites -->
                <div class="mb-6 bg-white border border-gray-300 rounded-lg overflow-hidden">
                    <button onclick="toggleMassSection('concluding-content')" class="w-full text-left p-4 bg-red-100 hover:bg-red-200 transition">
                        <h3 class="text-xl font-bold text-red-900">‚ñ∂ IV. Concluding Rites</h3>
                    </button>
                    <div id="concluding-content" class="p-6 space-y-4" style="display: none;">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">22. Announcements</h4>
                            <p class="text-sm text-gray-700">Brief parish announcements (if any)</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">23. Final Blessing</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "The Lord be with you."</p>
                            <p class="text-sm text-gray-700 italic mb-1">All: "And with your spirit."</p>
                            <p class="text-sm text-gray-700 italic mb-1">Priest: "May almighty God bless you, the Father, and the Son, and the Holy Spirit."</p>
                            <p class="text-sm text-gray-700 italic">All: "Amen."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">24. Dismissal</h4>
                            <p class="text-sm text-gray-700 italic mb-1">Priest/Deacon: "Go forth, the Mass is ended." (or similar)</p>
                            <p class="text-sm text-gray-700 italic">All: "Thanks be to God."</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">25. Recessional Hymn</h4>
                            <p class="text-sm text-gray-700">Priest and ministers process out while congregation sings</p>
                        </div>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h3 class="font-semibold text-amber-900 mb-3">üìù Important Notes</h3>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li>‚Ä¢ Stand during the Gospel, Creed, and Eucharistic Prayer</li>
                        <li>‚Ä¢ Kneel after the Holy, Holy, Holy until after the Great Amen (in most places)</li>
                        <li>‚Ä¢ Sit during the readings (except Gospel) and homily</li>
                        <li>‚Ä¢ Bow your head at the name of Jesus</li>
                        <li>‚Ä¢ Make the Sign of the Cross on forehead, lips, and heart before the Gospel</li>
                        <li>‚Ä¢ Only Catholics in a state of grace may receive Holy Communion</li>
                        <li>‚Ä¢ Fast from food and drink (except water/medicine) for 1 hour before Communion</li>
                    </ul>
                </div>
            </div>

            <!-- History/Calendar Tab -->
            <div id="history-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìú Spiritual Journey History</h2>
                
                <div class="mb-6 flex flex-wrap gap-4">
                    <button onclick="changeHistoryView('week')" id="view-week" class="px-4 py-2 bg-indigo-600 text-white rounded-md font-semibold">
                        Last 7 Days
                    </button>
                    <button onclick="changeHistoryView('month')" id="view-month" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md font-semibold hover:bg-gray-300">
                        Last 30 Days
                    </button>
                    <button onclick="changeHistoryView('all')" id="view-all" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md font-semibold hover:bg-gray-300">
                        All Time
                    </button>
                </div>
                
                <div id="history-calendar" class="space-y-4">
                    <!-- Will be populated dynamically -->
                </div>
                
                <div id="no-history" style="display: none;" class="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
                    <p class="text-gray-600">No activity recorded yet. Start tracking your spiritual journey today!</p>
                </div>
            </div>

            <!-- Data Management Tab -->
            <div id="data-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üíæ Data Management</h2>
                
                <div class="space-y-6">
                    <!-- Export Section -->
                    <div id="export-section" class="bg-green-50 border border-green-200 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-green-900 mb-3">üì§ Export Your Data</h3>
                        <p class="text-gray-700 mb-4">
                            Download all your spiritual tracking data as a backup file. This includes:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 mb-4 space-y-1">
                            <li>All daily activities and notes</li>
                            <li>Confession records (examination history)</li>
                            <li>Works of mercy performed</li>
                            <li>All dates and timestamps</li>
                        </ul>
                        <p class="text-sm text-amber-700 mb-4">
                            ‚ö†Ô∏è <strong>Privacy Note:</strong> Your confession records contain sensitive spiritual information. 
                            Keep your backup file secure and private.
                        </p>
                        <button onclick="exportData()" 
                                class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition font-semibold shadow-md">
                            üì• Download Backup File
                        </button>
                        <div id="export-status" class="mt-3 text-sm"></div>
                    </div>

                    <!-- Import Section -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-blue-900 mb-3">üì• Import Data</h3>
                        <p class="text-gray-700 mb-4">
                            Restore data from a previous backup file. This will:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 mb-4 space-y-1">
                            <li><strong>Merge</strong> imported data with existing data</li>
                            <li>Keep the most recent version if dates overlap</li>
                            <li>Not delete any current data</li>
                        </ul>
                        <p class="text-sm text-amber-700 mb-4">
                            ‚ö†Ô∏è <strong>Important:</strong> Only import backup files you created from this app. 
                            Invalid files may cause errors.
                        </p>
                        <div class="space-y-3">
                            <input type="file" id="import-file" accept=".json" 
                                   class="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 
                                          file:rounded-md file:border-0 file:text-sm file:font-semibold 
                                          file:bg-blue-600 file:text-white hover:file:bg-blue-700 
                                          border border-blue-300 rounded-md">
                            <button onclick="importData()" 
                                    class="bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition font-semibold shadow-md">
                                üì§ Import Backup File
                            </button>
                        </div>
                        <div id="import-status" class="mt-3 text-sm"></div>
                    </div>

                    <!-- Clear Data Section -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-red-900 mb-3">üóëÔ∏è Clear All Data</h3>
                        <p class="text-gray-700 mb-4">
                            Permanently delete ALL your spiritual tracking data. This action cannot be undone.
                        </p>
                        <p class="text-sm text-red-700 mb-4">
                            ‚ö†Ô∏è <strong>Warning:</strong> This will delete everything - all activities, confessions, and works of mercy. 
                            Make sure to export a backup first if you want to keep your data!
                        </p>
                        <button onclick="clearAllData()" 
                                class="bg-red-600 text-white px-6 py-3 rounded-md hover:bg-red-700 transition font-semibold shadow-md">
                            üóëÔ∏è Clear All Data
                        </button>
                        <div id="clear-status" class="mt-3 text-sm"></div>
                    </div>

                    <!-- Share with Spiritual Director -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-purple-900 mb-3">üë§ Share Summary with Spiritual Director</h3>
                        <p class="text-gray-700 mb-4">
                            Generate a summary of your spiritual activities to share with your spiritual director or priest.
                        </p>
                        <div class="space-y-3">
                            <label class="text-sm text-gray-700 block">Time Period:</label>
                            <select id="summary-period" class="px-3 py-2 border border-gray-300 rounded w-full mb-3">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                            </select>
                            <button onclick="generateSummary()" class="bg-purple-600 text-white px-6 py-3 rounded-md hover:bg-purple-700 transition font-semibold shadow-md w-full">
                                üìä Generate Summary
                            </button>
                            <div id="summary-output" class="mt-4 p-4 bg-white border border-purple-200 rounded hidden">
                                <h4 class="font-semibold mb-2">Your Spiritual Progress Summary:</h4>
                                <pre id="summary-text" class="text-sm text-gray-700 whitespace-pre-wrap"></pre>
                                <button onclick="copySummary()" class="mt-3 bg-purple-500 text-white px-4 py-2 rounded text-sm hover:bg-purple-600">
                                    üìã Copy to Clipboard
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Info Section -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-3">‚ÑπÔ∏è About Your Data</h3>
                        <div class="text-gray-700 space-y-2 text-sm">
                            <p><strong>Storage Location:</strong> All data is stored locally on this device only.</p>
                            <p><strong>Privacy:</strong> Nothing is uploaded to any server. Your data stays private.</p>
                            <p><strong>Sharing Devices:</strong> To move data to another device, export on one device and import on the other.</p>
                            <p><strong>File Format:</strong> Backup files are in JSON format and contain all your tracked data.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚öôÔ∏è App Settings</h2>
                
                <!-- Daily Reminder Settings -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-indigo-900 mb-4">‚è∞ Daily Reminder Settings</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label class="text-sm text-gray-700">
                                <input type="checkbox" id="enable-reminders" onchange="toggleReminders()" class="mr-2">
                                Enable Daily Prayer Reminder
                            </label>
                        </div>
                        <div id="reminder-time-setting" style="display: none;">
                            <label class="text-sm text-gray-700 block mb-2">Reminder Time:</label>
                            <input type="time" id="reminder-time" value="20:00" class="px-3 py-2 border border-gray-300 rounded w-full md:w-auto">
                            <button onclick="saveReminderSettings()" class="mt-2 md:mt-0 md:ml-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 font-semibold">
                                Save Time
                            </button>
                            <p class="text-xs text-gray-500 mt-2">üí° You'll need to grant notification permissions when prompted</p>
                        </div>
                        <div id="reminder-status" class="text-sm text-gray-600 bg-gray-50 p-3 rounded"></div>
                    </div>
                </div>

                <!-- Theme & Display Settings -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">üé® Theme & Display</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-semibold text-gray-700 block mb-2">Color Theme:</label>
                            <select id="theme-select" onchange="changeTheme()" class="px-4 py-2 border border-gray-300 rounded w-full bg-white">
                                <option value="light">‚òÄÔ∏è Light (Default)</option>
                                <option value="dark">üåô Dark Mode</option>
                                <option value="sepia">üìú Sepia (Easy on Eyes)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">Change the color scheme of the entire app</p>
                        </div>
                        <div>
                            <label class="text-sm font-semibold text-gray-700 block mb-2">Font Size:</label>
                            <select id="font-size-select" onchange="changeFontSize()" class="px-4 py-2 border border-gray-300 rounded w-full bg-white">
                                <option value="normal">Normal (Default)</option>
                                <option value="large">Large (Easier to Read)</option>
                                <option value="extra-large">Extra Large (Maximum Readability)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">Adjust text size for better readability</p>
                        </div>
                    </div>
                </div>

                <!-- Customize Daily Activities -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">‚úèÔ∏è Customize Daily Activities</h3>
                    <p class="text-gray-700 mb-4">
                        Add or remove activities to personalize your daily tracking checklist.
                    </p>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Current Activities:</h4>
                        <div id="custom-activities-list" class="space-y-2 mb-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded p-4">
                        <h4 class="font-semibold text-blue-900 mb-3">Add New Activity:</h4>
                        <div class="flex gap-2">
                            <input type="text" id="new-activity-name" placeholder="e.g., Divine Mercy Chaplet" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded">
                            <button onclick="addCustomActivity()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-semibold">
                                Add
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">üí° Add activities specific to your spiritual practice</p>
                    </div>
                </div>

                <!-- Customize Sin Tracker -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-orange-900 mb-4">‚úèÔ∏è Customize Sin Tracker</h3>
                    <p class="text-gray-700 mb-4">
                        Add or remove sins to track the areas you're working on improving.
                    </p>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Current Sins Being Tracked:</h4>
                        <div id="custom-sins-list" class="space-y-2 mb-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="bg-orange-50 border border-orange-200 rounded p-4">
                        <h4 class="font-semibold text-orange-900 mb-3">Add New Sin to Track:</h4>
                        <div class="flex gap-2">
                            <input type="text" id="new-sin-name" placeholder="e.g., Impatience" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded">
                            <button onclick="addCustomSin()" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 font-semibold">
                                Add
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">üí° Track sins specific to your spiritual struggles</p>
                    </div>
                </div>

                <!-- Customize Confession Checklist -->
                <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">‚úèÔ∏è Customize Examination of Conscience</h3>
                    <p class="text-gray-700 mb-4">
                        Add or remove questions for your examination of conscience before confession.
                    </p>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Current Examination Questions:</h4>
                        <div id="custom-confession-list" class="space-y-2 mb-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded p-4">
                        <h4 class="font-semibold text-purple-900 mb-3">Add New Question:</h4>
                        <div class="flex gap-2">
                            <input type="text" id="new-confession-item" placeholder="e.g., Have I shown compassion to others?" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded">
                            <button onclick="addCustomConfessionItem()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 font-semibold">
                                Add
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">üí° Add questions specific to your spiritual life</p>
                    </div>
                </div>

                <!-- Reset & Data Management -->
                <div class="bg-red-50 border border-red-300 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-red-900 mb-4">üóëÔ∏è Reset Everything</h3>
                    <p class="text-gray-700 mb-4">
                        Permanently delete ALL your spiritual tracking data and reset the app to its initial state.
                    </p>
                    <div class="bg-white border border-red-200 rounded p-4 mb-4">
                        <p class="text-sm text-red-800 font-semibold mb-2">‚ö†Ô∏è This will delete:</p>
                        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                            <li>All daily activities records</li>
                            <li>All confession history</li>
                            <li>All sin tracking data</li>
                            <li>All works of mercy records</li>
                            <li>All settings and preferences</li>
                        </ul>
                    </div>
                    <p class="text-sm text-red-700 font-semibold mb-4">
                        ‚ö†Ô∏è WARNING: This action cannot be undone! Export a backup first if you want to keep your data.
                    </p>
                    <button onclick="resetEverything()" class="w-full bg-red-600 text-white px-6 py-3 rounded-md hover:bg-red-700 transition font-semibold shadow-md">
                        üóëÔ∏è Clear All Data & Reset App
                    </button>
                </div>
            </div>

            <!-- Lent Challenge Tab -->
            <div id="lent-tab" class="tab-content p-6">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-2xl font-bold text-gray-800">üåø Lent Challenge 2026</h2>
                    <span id="lent-season-badge" class="text-xs font-bold px-3 py-1 rounded-full bg-purple-100 text-purple-800"></span>
                </div>
                <p class="text-sm text-gray-500 mb-5">Ash Wednesday ‚Üí Easter Sunday &nbsp;¬∑&nbsp; Feb 18 ‚Äì Apr 5, 2026</p>

                <!-- Progress Bar -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-5 mb-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold text-purple-900">Journey to Easter</span>
                        <span id="lent-day-label" class="text-sm font-bold text-purple-700"></span>
                    </div>
                    <div class="w-full bg-purple-200 rounded-full h-4 mb-2">
                        <div id="lent-progress-bar" class="bg-gradient-to-r from-purple-500 to-indigo-500 h-4 rounded-full transition-all duration-500" style="width:0%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-purple-700">
                        <span>üåø Ash Wednesday</span>
                        <span>‚úùÔ∏è Holy Week</span>
                        <span>üåÖ Easter</span>
                    </div>
                </div>

                <!-- Three Pillars -->
                <h3 class="text-lg font-bold text-gray-800 mb-3">The Three Pillars of Lent</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Prayer -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-bold text-blue-900 mb-3">üôè Prayer</h4>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="prayer-rosary" onchange="saveLentPillar(this)">
                                <span>Daily Rosary</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="prayer-stations" onchange="saveLentPillar(this)">
                                <span>Stations of the Cross weekly</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="prayer-divine-mercy" onchange="saveLentPillar(this)">
                                <span>Divine Mercy Chaplet</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="prayer-lectio" onchange="saveLentPillar(this)">
                                <span>Daily Scripture reading (Lectio Divina)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Fasting -->
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                        <h4 class="font-bold text-amber-900 mb-3">‚öñÔ∏è Fasting</h4>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="fast-meat-fridays" onchange="saveLentPillar(this)">
                                <span>One Meal a Day (OMAD)</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="fast-ash-wed" onchange="saveLentPillar(this)">
                                <span>Fast on Wednesday & Friday</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="fast-sacrifice" onchange="saveLentPillar(this)">
                                <span>Give up a personal pleasure</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="fast-social-media" onchange="saveLentPillar(this)">
                                <span>Reduce social media/screen time</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="fast-silence" onchange="saveLentPillar(this)">
                                <span>Daily period of silence</span>
                            </label>
                        </div>
                    </div>
                    <!-- Almsgiving -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-bold text-green-900 mb-3">ü§≤ Almsgiving</h4>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="alms-donate" onchange="saveLentPillar(this)">
                                <span>Pay Day ‚Äì Support Catholic Outreach</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="alms-volunteer" onchange="saveLentPillar(this)">
                                <span>Volunteer or serve a neighbor</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="alms-church" onchange="saveLentPillar(this)">
                                <span>Local Church Donations</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="alms-forgiveness" onchange="saveLentPillar(this)">
                                <span>Extend forgiveness to someone</span>
                            </label>
                            <label class="flex items-start gap-2 cursor-pointer">
                                <input type="checkbox" class="lent-pillar mt-1" data-pillar="alms-visit" onchange="saveLentPillar(this)">
                                <span>Visit the sick or lonely</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- My Lenten Sacrifice -->
                <div class="bg-rose-50 border border-rose-200 rounded-lg p-5 mb-6">
                    <h3 class="font-bold text-rose-900 mb-3">‚úùÔ∏è My Lenten Sacrifice</h3>
                    <p class="text-sm text-rose-800 mb-3">What are you giving up or taking on this Lent? Write it as a commitment.</p>
                    <textarea id="lent-sacrifice-text" rows="3"
                        class="w-full px-3 py-2 border border-rose-300 rounded-md text-sm mb-3"
                        placeholder="e.g. 'I am giving up sweets and social media scrolling to offer this sacrifice for [intention]...'"
                        oninput="autoSaveLentSacrifice()"></textarea>
                    <div class="mb-3">
                        <label class="block text-sm font-semibold text-rose-800 mb-1">Offered for this intention:</label>
                        <input type="text" id="lent-intention" class="w-full px-3 py-2 border border-rose-300 rounded-md text-sm"
                            placeholder="e.g. My family, a conversion, the Holy Souls..." oninput="autoSaveLentSacrifice()">
                    </div>
                    <p class="text-xs text-rose-600 italic" id="lent-sacrifice-saved"></p>
                </div>

                <!-- 40-Day Daily Tracker -->
                <div class="bg-white border border-gray-200 rounded-lg p-5 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-gray-800">üìÖ 40-Day Daily Tracker</h3>
                        <span class="text-sm text-gray-500" id="lent-days-checked">0 / 40 days marked</span>
                    </div>
                    <p class="text-xs text-gray-500 mb-4">Tap a day to mark it as a faithful Lenten day. Sundays are shown in lighter purple (they are feast days, not counted in the 40).</p>
                    <div id="lent-40-day-grid" class="grid grid-cols-7 gap-1 text-center text-xs">
                        <!-- Generated by JS -->
                    </div>
                    <div class="flex gap-4 mt-3 text-xs text-gray-600">
                        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-purple-500 inline-block"></span> Marked</span>
                        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-purple-100 border border-purple-300 inline-block"></span> Sunday</span>
                        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-gray-100 border border-gray-300 inline-block"></span> Future</span>
                        <span class="flex items-center gap-1"><span class="w-4 h-4 rounded bg-yellow-300 inline-block"></span> Today</span>
                    </div>
                </div>

                <!-- Weekly Lenten Milestones -->
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-5 mb-6">
                    <h3 class="font-bold text-indigo-900 mb-3">üèÅ Holy Week Milestones</h3>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="palm-sunday" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Palm Sunday (Mar 29)</strong> ‚Äî Attend Mass &amp; receive palms</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="holy-thursday" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Holy Thursday (Apr 2)</strong> ‚Äî Mass of the Lord's Supper</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="good-friday" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Good Friday (Apr 3)</strong> ‚Äî Veneration of the Cross &amp; fast</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="holy-saturday" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Holy Saturday (Apr 4)</strong> ‚Äî Easter Vigil Mass</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="confession-lent" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Sacramental Confession</strong> ‚Äî before Easter (obligation)</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" class="lent-milestone" data-milestone="easter-communion" onchange="saveLentMilestone(this)">
                            <span class="text-sm"><strong>Easter Sunday (Apr 5)</strong> ‚Äî Easter Communion üåÖ</span>
                        </label>
                    </div>
                </div>

                <!-- Lenten Prayer -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-5">
                    <h3 class="font-bold text-gray-800 mb-3">üìñ Lenten Prayer</h3>
                    <blockquote class="border-l-4 border-purple-400 pl-4 italic text-gray-700 text-sm leading-relaxed">
                        "Lord, grant that I might not so much seek to be consoled as to console; to be understood, as to understand; to be loved, as to love with all my soul. Create in me a clean heart, O God, and renew a right spirit within me."
                    </blockquote>
                    <p class="text-xs text-gray-500 mt-2">‚Äî Psalm 51:10 &amp; adapted from St. Francis</p>
                    <div class="mt-4 p-3 bg-purple-50 border border-purple-200 rounded text-sm text-purple-900">
                        <strong>"Remember that you are dust, and to dust you shall return."</strong>
                        <span class="block mt-1 text-xs text-purple-700">‚Äî Ash Wednesday Rite</span>
                    </div>
                    <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="lent-karamazov" class="lent-pillar" data-pillar="prayer-karamazov" onchange="saveLentPillar(this)" style="min-width:18px;min-height:18px;">
                            <div>
                                <p class="text-sm font-bold text-amber-900">üìö Read <em>The Brothers Karamazov</em></p>
                                <p class="text-xs text-amber-700 mt-0.5">Dostoevsky's masterwork on faith, doubt, suffering, and redemption ‚Äî a profound Lenten companion.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progress-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìà Your Spiritual Journey</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-purple-900 mb-2">Total Days Tracked</h3>
                        <p class="text-4xl font-bold text-purple-700" id="total-days">0</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-blue-900 mb-2">Sacrament of Reconciliation</h3>
                        <p class="text-4xl font-bold text-blue-700" id="total-confessions">0</p>
                        <p class="text-sm text-blue-800 mt-1">confessions</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-green-900 mb-2">Works of Mercy</h3>
                        <p class="text-4xl font-bold text-green-700" id="total-mercy-works">0</p>
                        <p class="text-sm text-green-800 mt-1">performed</p>
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Last 30 Days Activity</h3>
                    <div id="activity-summary" class="space-y-3">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <div class="bg-amber-50 border border-amber-200 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-amber-900 mb-3">üåü Remember</h3>
                    <p class="text-gray-700 italic">
                        "The saints are not the people who never sin, but the people who keep getting up after they fall."
                    </p>
                    <p class="text-gray-600 mt-3">
                        This tracker is a tool for your spiritual journey. Progress may be slow, but perseverance in prayer, 
                        the sacraments, and works of charity will lead you closer to God. Trust in His mercy and never give up!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Storage Wrapper for Browser Compatibility
        // This wraps localStorage to work like the artifact storage API
        window.storage = {
            async get(key) {
                try {
                    const value = localStorage.getItem(key);
                    if (value === null) {
                        throw new Error('Key not found');
                    }
                    return { key: key, value: value };
                } catch (e) {
                    throw e;
                }
            },
            
            async set(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return { key: key, value: value };
                } catch (e) {
                    console.error('Storage set error:', e);
                    return null;
                }
            },
            
            async delete(key) {
                try {
                    localStorage.removeItem(key);
                    return { key: key, deleted: true };
                } catch (e) {
                    console.error('Storage delete error:', e);
                    return null;
                }
            },
            
            async list(prefix) {
                try {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (!prefix || key.startsWith(prefix)) {
                            keys.push(key);
                        }
                    }
                    return { keys: keys, prefix: prefix };
                } catch (e) {
                    console.error('Storage list error:', e);
                    return { keys: [] };
                }
            }
        };

        // Security & Session Management - DISABLED
        let sessionActive = true; // Always active now
        let lastActivity = Date.now();
        let encryptionKey = null;

        // Simplified - no PIN required
        async function checkSecuritySetup() {
            // Skip all security checks - just start the app
            sessionActive = true;
            console.log('App starting without PIN security');
        }

        function startSessionMonitoring() {
            // No session monitoring needed without PIN
            console.log('Session monitoring disabled');
        }

        function updateActivity() {
            lastActivity = Date.now();
        }

        // Mass section collapse/expand
        function toggleMassSection(sectionId) {
            const content = document.getElementById(sectionId);
            const button = document.querySelector(`[onclick="toggleMassSection('${sectionId}')"]`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                button.textContent = button.textContent.replace('‚ñ∂', '‚ñº');
            } else {
                content.style.display = 'none';
                button.textContent = button.textContent.replace('‚ñº', '‚ñ∂');
            }
        }

        // Works of Mercy section collapse/expand
        function toggleMercySection(sectionId) {
            const content = document.getElementById(sectionId);
            const button = document.querySelector(`[onclick="toggleMercySection('${sectionId}')"]`);
            const arrow = button.querySelector('.arrow');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                if (arrow) arrow.textContent = '‚ñº';
            } else {
                content.style.display = 'none';
                if (arrow) arrow.textContent = '‚ñ∂';
            }
        }

        // Reminder System
        function toggleReminders() {
            const enabled = document.getElementById('enable-reminders').checked;
            const timeSetting = document.getElementById('reminder-time-setting');
            
            if (enabled) {
                timeSetting.style.display = 'block';
                requestNotificationPermission();
            } else {
                timeSetting.style.display = 'none';
                localStorage.removeItem('reminders-enabled');
                document.getElementById('reminder-status').textContent = 'Reminders disabled';
            }
        }

        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    document.getElementById('reminder-status').textContent = '‚úÖ Notifications enabled!';
                } else {
                    document.getElementById('reminder-status').textContent = '‚ùå Notification permission denied. Please enable in browser settings.';
                }
            } else {
                document.getElementById('reminder-status').textContent = '‚ùå Notifications not supported on this device';
            }
        }

        function saveReminderSettings() {
            const time = document.getElementById('reminder-time').value;
            localStorage.setItem('reminders-enabled', 'true');
            localStorage.setItem('reminder-time', time);
            
            document.getElementById('reminder-status').textContent = `‚úÖ Reminder set for ${time} daily`;
            
            // Schedule daily reminder
            scheduleDailyReminder(time);
        }

        function scheduleDailyReminder(time) {
            // Calculate milliseconds until reminder time
            const [hours, minutes] = time.split(':');
            const now = new Date();
            const reminderTime = new Date();
            reminderTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            if (reminderTime < now) {
                reminderTime.setDate(reminderTime.getDate() + 1);
            }
            
            const msUntilReminder = reminderTime - now;
            
            setTimeout(() => {
                showDailyReminder();
                // Reschedule for next day
                scheduleDailyReminder(time);
            }, msUntilReminder);
        }

        function showDailyReminder() {
            if (Notification.permission === 'granted') {
                new Notification('Path to Sanctification', {
                    body: '‚è∞ Time to mark your daily spiritual activities!',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%234F46E5" width="100" height="100"/><text y="70" font-size="70" fill="white" text-anchor="middle" x="50">‚úù</text></svg>'
                });
            }
        }

        // Load customization settings on start
        function loadReminderSettings() {
            const enabled = localStorage.getItem('reminders-enabled') === 'true';
            const time = localStorage.getItem('reminder-time') || '20:00';
            
            if (enabled) {
                document.getElementById('enable-reminders').checked = true;
                document.getElementById('reminder-time').value = time;
                document.getElementById('reminder-time-setting').style.display = 'block';
                document.getElementById('reminder-status').textContent = `‚úÖ Reminder set for ${time} daily`;
                scheduleDailyReminder(time);
            }
            
            // Load custom items
            loadCustomActivities();
            loadCustomSins();
            loadCustomConfessionItems();
        }

        // Custom Activities Management
        function getDefaultActivities() {
            return [
                { id: 'rosary', name: 'üåπ Holy Rosary', emoji: 'üåπ', default: true },
                { id: 'mass', name: '‚õ™ Holy Mass', emoji: '‚õ™', default: true },
                { id: 'bible', name: 'üìñ Scripture Reading', emoji: 'üìñ', default: true },
                { id: 'adoration', name: '‚ú® Eucharistic Adoration', emoji: '‚ú®', default: true },
                { id: 'divineOffice', name: 'üìø Divine Office/Liturgy of Hours', emoji: 'üìø', default: true },
                { id: 'prayer', name: 'üôè Personal Prayer Time', emoji: 'üôè', default: true },
                { id: 'fasting', name: 'üçû Fasting/Penance', emoji: 'üçû', default: true }
            ];
        }

        function loadCustomActivities() {
            const stored = localStorage.getItem('custom-activities');
            const activities = stored ? JSON.parse(stored) : getDefaultActivities();
            
            // Display in settings
            const listDiv = document.getElementById('custom-activities-list');
            if (listDiv) {
                listDiv.innerHTML = activities.map((act, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                        <span class="text-sm">${act.emoji || 'üìå'} ${act.name}</span>
                        ${!act.default ? `<button onclick="removeCustomActivity(${index})" class="text-red-600 hover:text-red-800 text-xs">Remove</button>` : '<span class="text-xs text-gray-400">Default</span>'}
                    </div>
                `).join('');
            }
            
            return activities;
        }

        function renderDailyActivities() {
            const activities = loadCustomActivities();
            const container = document.getElementById('daily-activities-container');
            
            if (!container) return;
            
            const colorClasses = {
                rose: { bg: 'from-rose-50 to-pink-50', border: 'border-rose-200', text: 'text-rose-600' },
                amber: { bg: 'from-amber-50 to-yellow-50', border: 'border-amber-200', text: 'text-amber-600' },
                blue: { bg: 'from-blue-50 to-cyan-50', border: 'border-blue-200', text: 'text-blue-600' },
                purple: { bg: 'from-purple-50 to-violet-50', border: 'border-purple-200', text: 'text-purple-600' },
                green: { bg: 'from-green-50 to-emerald-50', border: 'border-green-200', text: 'text-green-600' },
                indigo: { bg: 'from-indigo-50 to-blue-50', border: 'border-indigo-200', text: 'text-indigo-600' },
                gray: { bg: 'from-gray-50 to-slate-50', border: 'border-gray-200', text: 'text-gray-600' },
                teal: { bg: 'from-teal-50 to-cyan-50', border: 'border-teal-200', text: 'text-teal-600' },
                orange: { bg: 'from-orange-50 to-red-50', border: 'border-orange-200', text: 'text-orange-600' }
            };
            
            container.innerHTML = activities.map(act => {
                const colors = colorClasses[act.color] || colorClasses.gray;
                return `
                    <div class="bg-gradient-to-r ${colors.bg} p-4 rounded-lg border ${colors.border}">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" id="activity-${act.id}" class="w-5 h-5 ${colors.text} rounded" 
                                   onchange="saveDailyActivity('${act.id}')">
                            <span class="font-semibold text-gray-700">${act.emoji} ${act.name}</span>
                        </label>
                        ${act.hasMinutes ? `
                            <input type="number" min="0" placeholder="Minutes" id="minutes-${act.id}"
                                   class="mt-2 w-full px-3 py-2 border ${colors.border} rounded-md text-sm"
                                   onchange="saveDailyActivityMinutes('${act.id}', this.value)">
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // Load saved states for today
            setTimeout(() => loadTodayData(), 100);
        }

        function addCustomActivity() {
            const input = document.getElementById('new-activity-name');
            const name = input.value.trim();
            
            if (!name) {
                alert('Please enter an activity name');
                return;
            }
            
            const activities = loadCustomActivities();
            const newId = 'custom_' + Date.now();
            
            activities.push({
                id: newId,
                name: name,
                emoji: 'üìå',
                default: false,
                color: 'teal'
            });
            
            localStorage.setItem('custom-activities', JSON.stringify(activities));
            input.value = '';
            loadCustomActivities();
            
            showRefreshPrompt('Activity added!');
        }

        function removeCustomActivity(index) {
            if (!confirm('Remove this activity?')) return;
            
            const activities = loadCustomActivities();
            activities.splice(index, 1);
            localStorage.setItem('custom-activities', JSON.stringify(activities));
            loadCustomActivities();
            
            showRefreshPrompt('Activity removed!');
        }

        // Custom Sins Management
        function getDefaultSins() {
            return [
                { id: 'pride', name: 'Pride', default: true },
                { id: 'greed', name: 'Greed/Avarice', default: true },
                { id: 'lust', name: 'Lust', default: true },
                { id: 'anger', name: 'Anger/Wrath', default: true },
                { id: 'gluttony', name: 'Gluttony', default: true },
                { id: 'envy', name: 'Envy/Jealousy', default: true },
                { id: 'sloth', name: 'Sloth/Laziness', default: true },
                { id: 'lying', name: 'Lying/Dishonesty', default: true },
                { id: 'gossip', name: 'Gossip/Detraction', default: true },
                { id: 'judgmental', name: 'Being Judgmental', default: true },
                { id: 'uncharitable', name: 'Uncharitable Thoughts', default: true },
                { id: 'sacrilege', name: 'Sacrilege/Irreverence', default: true }
            ];
        }

        function loadCustomSins() {
            const stored = localStorage.getItem('custom-sins');
            const sins = stored ? JSON.parse(stored) : getDefaultSins();
            
            const listDiv = document.getElementById('custom-sins-list');
            if (listDiv) {
                listDiv.innerHTML = sins.map((sin, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                        <span class="text-sm">${sin.name}</span>
                        ${!sin.default ? `<button onclick="removeCustomSin(${index})" class="text-red-600 hover:text-red-800 text-xs">Remove</button>` : '<span class="text-xs text-gray-400">Default</span>'}
                    </div>
                `).join('');
            }
            
            return sins;
        }

        function renderSinTrackers() {
            const sins = loadCustomSins();
            const container = document.getElementById('sin-tracker-list');
            
            if (!container) return;
            
            container.innerHTML = sins.map(sin => `
                <div class="bg-white border-2 border-red-200 rounded-lg p-4 hover:border-red-300 transition">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-red-800">${sin.name}</h3>
                    </div>
                    <div class="text-center mb-3">
                        <div class="text-5xl font-bold text-red-600" id="count-${sin.id}">0</div>
                        <p class="text-xs text-gray-500 mt-1">Times</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="incrementSin('${sin.id}')" 
                                class="flex-1 bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 font-semibold">
                            +1
                        </button>
                        <button onclick="decrementSin('${sin.id}')" 
                                class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                            -1
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Load current counts
            setTimeout(() => loadSinCounts(), 100);
        }

        async function loadSinCounts() {
            const sins = loadCustomSins();
            for (const sin of sins) {
                let totalCount = 0;
                try {
                    const result = await window.storage.get('sin-tracker:' + sin.id);
                    if (result && result.value) {
                        const data = JSON.parse(result.value);
                        // Sum up all dates since data is stored as {date: count, date2: count2, ...}
                        for (const dateKey in data) {
                            totalCount += data[dateKey];
                        }
                    }
                } catch (error) {
                    // Key not found is normal - means no sins tracked yet for this category
                    // Just leave totalCount as 0
                }
                const countEl = document.getElementById('count-' + sin.id);
                if (countEl) {
                    countEl.textContent = totalCount;
                }
            }
        }

        function addCustomSin() {
            const input = document.getElementById('new-sin-name');
            const name = input.value.trim();
            
            if (!name) {
                alert('Please enter a sin name');
                return;
            }
            
            const sins = loadCustomSins();
            const newId = 'custom_' + Date.now();
            
            sins.push({
                id: newId,
                name: name,
                default: false
            });
            
            localStorage.setItem('custom-sins', JSON.stringify(sins));
            input.value = '';
            loadCustomSins();
            
            showRefreshPrompt('Sin added!');
        }

        function removeCustomSin(index) {
            if (!confirm('Remove this sin from tracking?')) return;
            
            const sins = loadCustomSins();
            sins.splice(index, 1);
            localStorage.setItem('custom-sins', JSON.stringify(sins));
            loadCustomSins();
            
            showRefreshPrompt('Sin removed!');
        }

        // Custom Confession Items Management
        function getDefaultConfessionItems() {
            return [
                { id: 'idolatry', text: 'Have I placed other things before God (money, success, pleasure)?', category: 'God', default: true },
                { id: 'blasphemy', text: 'Have I spoken against God, sacred things, or the Church?', category: 'God', default: true },
                { id: 'lords-name', text: 'Have I misused God\'s name?', category: 'God', default: true },
                { id: 'mass-attendance', text: 'Have I deliberately missed Sunday or Holy Day Mass without serious reason?', category: 'God', default: true },
                { id: 'parents-authority', text: 'Have I dishonored my parents or legitimate authority?', category: 'Neighbor', default: true },
                { id: 'hatred-anger', text: 'Have I harbored hatred, resentment, or uncontrolled anger?', category: 'Neighbor', default: true },
                { id: 'lying-gossip', text: 'Have I lied, gossiped, or damaged another\'s reputation?', category: 'Neighbor', default: true },
                { id: 'stealing-cheating', text: 'Have I stolen, cheated, or damaged others\' property?', category: 'Neighbor', default: true },
                { id: 'purity', text: 'Have I sinned against purity in thought, word, or deed?', category: 'Purity', default: true },
                { id: 'charity', text: 'Have I failed to love my neighbor or show compassion?', category: 'Charity', default: true }
            ];
        }

        function loadCustomConfessionItems() {
            const stored = localStorage.getItem('custom-confession-items');
            const items = stored ? JSON.parse(stored) : getDefaultConfessionItems();
            
            const listDiv = document.getElementById('custom-confession-list');
            if (listDiv) {
                listDiv.innerHTML = items.map((item, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                        <span class="text-sm">${item.text}</span>
                        ${!item.default ? `<button onclick="removeCustomConfessionItem(${index})" class="text-red-600 hover:text-red-800 text-xs">Remove</button>` : '<span class="text-xs text-gray-400">Default</span>'}
                    </div>
                `).join('');
            }
            
            return items;
        }

        function renderConfessionChecklist() {
            const items = loadCustomConfessionItems();
            const container = document.getElementById('confession-checklist-container');
            
            if (!container) return;
            
            // Group by category
            const categories = {};
            items.forEach(item => {
                const cat = item.category || 'Other';
                if (!categories[cat]) categories[cat] = [];
                categories[cat].push(item);
            });
            
            container.innerHTML = `
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Examination of Conscience</h3>
                    ${Object.keys(categories).map(category => `
                        <div class="mb-6">
                            <h4 class="font-bold text-gray-700 mb-3 text-lg border-b pb-2">
                                ${category === 'God' ? 'Sins Against God' : 
                                  category === 'Neighbor' ? 'Sins Against Neighbor' :
                                  category === 'Purity' ? 'Sins Against Purity' :
                                  category === 'Charity' ? 'Love of Neighbor' : category}
                            </h4>
                            <div class="space-y-2">
                                ${categories[category].map(item => `
                                    <label class="flex items-start space-x-3 confession-item p-2 rounded hover:bg-purple-100 cursor-pointer">
                                        <input type="checkbox" id="confession-${item.id}" 
                                               class="mt-1 w-4 h-4 text-purple-600 rounded">
                                        <span class="text-sm text-gray-700">${item.text}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function addCustomConfessionItem() {
            const input = document.getElementById('new-confession-item');
            const text = input.value.trim();
            
            if (!text) {
                alert('Please enter a question');
                return;
            }
            
            const items = loadCustomConfessionItems();
            const newId = 'custom_' + Date.now();
            
            items.push({
                id: newId,
                text: text,
                category: 'Other',
                default: false
            });
            
            localStorage.setItem('custom-confession-items', JSON.stringify(items));
            input.value = '';
            loadCustomConfessionItems();
            renderConfessionChecklist(); // Update the confession tab
            
            showRefreshPrompt('Question added!');
        }

        function removeCustomConfessionItem(index) {
            if (!confirm('Remove this question?')) return;
            
            const items = loadCustomConfessionItems();
            items.splice(index, 1);
            localStorage.setItem('custom-confession-items', JSON.stringify(items));
            loadCustomConfessionItems();
            renderConfessionChecklist(); // Update the confession tab
            
            showRefreshPrompt('Question removed!');
        }

        // Theme and Font Size
        function changeTheme() {
            const theme = document.getElementById('theme-select').value;
            localStorage.setItem('theme', theme);
            applyTheme(theme);
        }

        // Refresh Prompt for Customization Changes
        function showRefreshPrompt(message) {
            // Create or show refresh banner
            let banner = document.getElementById('refresh-prompt-banner');
            
            if (!banner) {
                banner = document.createElement('div');
                banner.id = 'refresh-prompt-banner';
                banner.className = 'fixed top-0 left-0 right-0 bg-green-600 text-white p-4 shadow-lg z-50 flex items-center justify-between';
                banner.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold">‚úÖ ${message}</p>
                        <p class="text-sm">Refresh the page to see your changes</p>
                    </div>
                    <button onclick="location.reload()" class="bg-white text-green-600 px-6 py-2 rounded-md font-bold hover:bg-green-50 ml-4">
                        üîÑ Refresh Now
                    </button>
                `;
                document.body.appendChild(banner);
            } else {
                banner.querySelector('p.font-semibold').textContent = `‚úÖ ${message}`;
                banner.style.display = 'flex';
            }
            
            // Scroll to top so user sees the banner
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function applyTheme(theme) {
            const body = document.body;
            body.classList.remove('theme-dark', 'theme-sepia');
            
            if (theme === 'dark') {
                body.classList.add('theme-dark');
            } else if (theme === 'sepia') {
                body.classList.add('theme-sepia');
            }
        }

        function changeFontSize() {
            const size = document.getElementById('font-size-select').value;
            localStorage.setItem('font-size', size);
            applyFontSize(size);
        }

        function applyFontSize(size) {
            const body = document.body;
            body.classList.remove('font-large', 'font-extra-large');
            
            if (size === 'large') {
                body.classList.add('font-large');
            } else if (size === 'extra-large') {
                body.classList.add('font-extra-large');
            }
        }

        function loadCustomization() {
            const theme = localStorage.getItem('theme') || 'light';
            const fontSize = localStorage.getItem('font-size') || 'normal';
            
            document.getElementById('theme-select').value = theme;
            document.getElementById('font-size-select').value = fontSize;
            
            applyTheme(theme);
            applyFontSize(fontSize);
        }

        // Generate Summary for Spiritual Director
        async function generateSummary() {
            const days = parseInt(document.getElementById('summary-period').value);
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            let summary = `SPIRITUAL PROGRESS SUMMARY\n`;
            summary += `Period: ${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}\n`;
            summary += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            // Count daily activities
            let massCount = 0, rosaryCount = 0, bibleCount = 0, adorationCount = 0;
            let divineOfficeCount = 0, prayerCount = 0, fastingCount = 0;
            
            try {
                const dailyResult = await window.storage.list('daily:');
                if (dailyResult && dailyResult.keys) {
                    for (const key of dailyResult.keys) {
                        const dateStr = key.replace('daily:', '');
                        const itemDate = new Date(dateStr);
                        
                        if (itemDate >= startDate && itemDate <= endDate) {
                            const result = await window.storage.get(key);
                            if (result && result.value) {
                                const data = JSON.parse(result.value);
                                if (data.mass) massCount++;
                                if (data.rosary) rosaryCount++;
                                if (data.bible) bibleCount++;
                                if (data.adoration) adorationCount++;
                                if (data.divineOffice) divineOfficeCount++;
                                if (data.prayer) prayerCount++;
                                if (data.fasting) fastingCount++;
                            }
                        }
                    }
                }
                
                // Count confessions
                let confessionCount = 0;
                const confessionResult = await window.storage.list('confession:');
                if (confessionResult && confessionResult.keys) {
                    for (const key of confessionResult.keys) {
                        const result = await window.storage.get(key);
                        if (result && result.value) {
                            const data = JSON.parse(result.value);
                            const confDate = new Date(data.date);
                            if (confDate >= startDate && confDate <= endDate) {
                                confessionCount++;
                            }
                        }
                    }
                }
                
                summary += `DAILY SPIRITUAL PRACTICES:\n`;
                summary += `- Holy Mass: ${massCount} times\n`;
                summary += `- Holy Rosary: ${rosaryCount} times\n`;
                summary += `- Scripture Reading: ${bibleCount} times\n`;
                summary += `- Eucharistic Adoration: ${adorationCount} times\n`;
                summary += `- Divine Office: ${divineOfficeCount} times\n`;
                summary += `- Personal Prayer: ${prayerCount} times\n`;
                summary += `- Fasting/Penance: ${fastingCount} times\n\n`;
                
                summary += `SACRAMENTS:\n`;
                summary += `- Confession: ${confessionCount} time(s)\n\n`;
                
                summary += `CONSISTENCY:\n`;
                const totalDays = days;
                const avgMass = ((massCount / totalDays) * 100).toFixed(1);
                const avgRosary = ((rosaryCount / totalDays) * 100).toFixed(1);
                summary += `- Mass attendance: ${avgMass}% of days\n`;
                summary += `- Rosary practice: ${avgRosary}% of days\n\n`;
                
                summary += `---\n`;
                summary += `This summary was generated by Path to Sanctification tracker.\n`;
                summary += `For spiritual direction use only - contains personal spiritual data.\n`;
                
                document.getElementById('summary-text').textContent = summary;
                document.getElementById('summary-output').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error generating summary:', error);
                alert('Error generating summary: ' + error.message);
            }
        }

        function copySummary() {
            const text = document.getElementById('summary-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Summary copied to clipboard! You can now paste it in an email or message.');
            }).catch(err => {
                alert('Error copying: ' + err);
            });
        }

        // Simple encryption using Web Crypto API (for optional encrypted exports)
        async function encrypt(text, password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(text);
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password.padEnd(32, '0')),
                { name: 'AES-GCM' },
                false,
                ['encrypt']
            );
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const encrypted = await crypto.subtle.encrypt(
                { name: 'AES-GCM', iv: iv },
                keyMaterial,
                data
            );
            const combined = new Uint8Array(iv.length + encrypted.byteLength);
            combined.set(iv);
            combined.set(new Uint8Array(encrypted), iv.length);
            return btoa(String.fromCharCode(...combined));
        }

        async function decrypt(encryptedText, password) {
            const encoder = new TextEncoder();
            const decoder = new TextDecoder();
            const combined = Uint8Array.from(atob(encryptedText), c => c.charCodeAt(0));
            const iv = combined.slice(0, 12);
            const data = combined.slice(12);
            
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password.padEnd(32, '0')),
                { name: 'AES-GCM' },
                false,
                ['decrypt']
            );
            
            const decrypted = await crypto.subtle.decrypt(
                { name: 'AES-GCM', iv: iv },
                keyMaterial,
                data
            );
            return decoder.decode(decrypted);
        }

        // Initialize

        let currentDate = getCurrentDate();
        
        function getCurrentDate() {
            // Get date in local timezone, format as YYYY-MM-DD
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        document.getElementById('today-date').textContent = new Date().toLocaleDateString('en-US', { 
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });

        // Daily Readings
        async function loadDailyReadings() {
            const readingsLoading = document.getElementById('readings-loading');
            const readingsError = document.getElementById('readings-error');
            const readingsContent = document.getElementById('readings-content');
            
            // Format date for USCCB URL
            const today = new Date();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const year = String(today.getFullYear()).slice(-2);
            const dateStr = `${month}${day}${year}`;
            
            // Direct link approach - more reliable than trying to fetch cross-origin
            const readingsHTML = `
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-300 rounded-lg p-6 mb-4">
                    <h3 class="font-semibold text-amber-900 mb-3 text-xl">üìñ Today's Mass Readings</h3>
                    <p class="text-gray-700 mb-4">
                        Read today's First Reading, Responsorial Psalm, Second Reading, and Gospel from the USCCB:
                    </p>
                    <a href="https://bible.usccb.org/bible/readings/${dateStr}.cfm" 
                       target="_blank"
                       class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-700 transition font-semibold shadow-md">
                        üìñ Open Today's Readings ‚Üí
                    </a>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-300 rounded-lg p-6 mb-4">
                    <h3 class="font-semibold text-blue-900 mb-3 text-xl">üïäÔ∏è Liturgy of the Hours</h3>
                    <p class="text-gray-700 mb-4">
                        Pray the official daily prayer of the Church - Morning Prayer (Lauds), Daytime Prayer, Evening Prayer (Vespers), and Night Prayer (Compline):
                    </p>
                    <div class="flex flex-wrap gap-3">
                        <a href="https://www.universalis.com/today.htm" 
                           target="_blank"
                           class="inline-block bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition font-semibold shadow-md">
                            üïäÔ∏è Universalis - Liturgy of the Hours ‚Üí
                        </a>
                        <a href="https://divineoffice.org/" 
                           target="_blank"
                           class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-700 transition font-semibold shadow-md">
                            üìø iBreviary - Divine Office ‚Üí
                        </a>
                    </div>
                    <p class="text-sm text-gray-600 mt-3 italic">
                        üí° The Liturgy of the Hours sanctifies the entire day through psalms, hymns, and Scripture readings. Clergy and religious pray it daily; laypeople are encouraged to join.
                    </p>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                    <h3 class="font-semibold text-purple-900 mb-3 text-xl">üìö Additional Resources</h3>
                    
                    <h4 class="font-semibold text-purple-800 mb-2 mt-4">AI & Digital Tools</h4>
                    <div class="space-y-2 mb-4">
                        <a href="https://magisterium.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Magisterium AI - Catholic Teaching Assistant
                        </a>
                        <a href="https://read.amazon.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Kindle Cloud Reader
                        </a>
                    </div>
                    
                    <h4 class="font-semibold text-purple-800 mb-2 mt-4">Daily Readings & Catholic Texts</h4>
                    <div class="space-y-2 mb-4">
                        <a href="https://www.vaticannews.va/en/word-of-the-day.html" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Vatican News - Word of the Day
                        </a>
                        <a href="https://bible.usccb.org/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí USCCB Bible Browser
                        </a>
                        <a href="https://www.vatican.va/archive/ENG0015/_INDEX.HTM" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Catechism of the Catholic Church
                        </a>
                        <a href="https://www.newadvent.org/summa/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Summa Theologica - St. Thomas Aquinas
                        </a>
                        <a href="https://www.newadvent.org/fathers/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Church Fathers
                        </a>
                        <a href="https://fultonsheen.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Fulton Sheen Archive - Complete Works
                        </a>
                        <a href="https://www.vatican.va/content/vatican/en.html" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Vatican Official Website
                        </a>
                    </div>
                    
                    <h4 class="font-semibold text-purple-800 mb-2 mt-4">Prayer & Meditation</h4>
                    <div class="space-y-2 mb-4">
                        <a href="https://hallow.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Hallow - Catholic Prayer & Meditation App
                        </a>
                        <a href="https://www.ewtn.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí EWTN - Global Catholic Network
                        </a>
                        <a href="https://www.sacredspace.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Sacred Space - Daily Prayer
                        </a>
                    </div>
                    
                    <h4 class="font-semibold text-purple-800 mb-2 mt-4">Catholic Resources & Communities</h4>
                    <div class="space-y-2">
                        <a href="https://www.catholic.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Catholic Answers
                        </a>
                        <a href="https://www.wordonfire.org/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Word on Fire - Bishop Barron
                        </a>
                        <a href="https://www.osv.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Our Sunday Visitor
                        </a>
                        <a href="https://www.catholic365.com/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí Catholic 365
                        </a>
                        <a href="https://www.newadvent.org/" target="_blank" 
                           class="block text-indigo-600 hover:underline">
                            ‚Üí New Advent - Catholic Encyclopedia
                        </a>
                    </div>
                </div>
            `;
            
            readingsLoading.style.display = 'none';
            readingsContent.innerHTML = readingsHTML;
            readingsContent.style.display = 'block';
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-gray-700', 'border-indigo-600');
                btn.classList.add('text-gray-500', 'border-transparent');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.remove('text-gray-500', 'border-transparent');
            event.target.classList.add('text-gray-700', 'border-indigo-600');
            
            if (tabName === 'lent') {
                initLentTab();
            } else if (tabName === 'progress') {
                updateProgressStats();
            } else if (tabName === 'readings') {
                loadDailyReadings();
            } else if (tabName === 'history') {
                loadHistory('week');
            } else if (tabName === 'confession-tracker') {
                loadSinTrackers();
            } else if (tabName === 'confession') {
                updateSinSummary(); // Update sin summary when viewing confession tab
                renderConfessionChecklist(); // Ensure examination questions are current
            }
        }

        // Daily Activities
        async function saveDailyActivity(activity) {
            try {
                currentDate = getCurrentDate(); // Refresh in case date changed
                const key = `daily:${currentDate}`;
                console.log('Saving activity:', activity, 'for date:', currentDate);
                
                let dailyData = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        dailyData = JSON.parse(result.value);
                    }
                } catch (e) {
                    // Key doesn't exist yet
                }
                
                const checkbox = event.target;
                dailyData[activity] = checkbox.checked;
                
                const saveResult = await window.storage.set(key, JSON.stringify(dailyData));
                console.log('Save result:', saveResult);
            } catch (error) {
                console.error('Error saving daily activity:', error);
                alert('Error saving data. Please check console for details.');
            }
        }

        async function saveDailyActivityMinutes(activity, minutes) {
            try {
                const key = `daily:${currentDate}`;
                let dailyData = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        dailyData = JSON.parse(result.value);
                    }
                } catch (e) {
                    // Key doesn't exist yet
                }
                
                dailyData[activity + '_minutes'] = parseInt(minutes) || 0;
                
                await window.storage.set(key, JSON.stringify(dailyData));
            } catch (error) {
                console.error('Error saving activity minutes:', error);
            }
        }

        async function saveDailyNotes() {
            try {
                const key = `daily:${currentDate}`;
                let dailyData = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        dailyData = JSON.parse(result.value);
                    }
                } catch (e) {
                    // Key doesn't exist yet
                }
                
                dailyData.notes = document.getElementById('daily-notes').value;
                
                await window.storage.set(key, JSON.stringify(dailyData));
            } catch (error) {
                console.error('Error saving daily notes:', error);
            }
        }

        // Confession Functions
        async function loadLastConfession() {
            try {
                const result = await window.storage.list('confession:');
                if (result && result.keys && result.keys.length > 0) {
                    const sortedKeys = result.keys.sort().reverse();
                    const lastKey = sortedKeys[0];
                    const confessionData = await window.storage.get(lastKey);
                    if (confessionData && confessionData.value) {
                        const data = JSON.parse(confessionData.value);
                        const confessionDate = new Date(data.date);
                        
                        document.getElementById('last-confession-date').textContent = 
                            confessionDate.toLocaleDateString('en-US', { 
                                year: 'numeric', month: 'long', day: 'numeric' 
                            });
                        
                        // Update days since last confession counter
                        updateDaysSinceConfession(confessionDate);
                    }
                } else {
                    // No confession yet
                    updateDaysSinceConfession(null);
                }
            } catch (error) {
                console.error('Error loading last confession:', error);
            }
            
            await loadConfessionHistory();
            await updateSinSummary(); // Update sin summary for confession tab
        }

        function updateDaysSinceConfession(lastConfessionDate) {
            const reminder = document.getElementById('confession-reminder');
            const daysSpan = document.getElementById('days-since-confession');
            
            if (!lastConfessionDate) {
                // Never been to confession
                reminder.style.display = 'block';
                daysSpan.textContent = '‚àû';
                daysSpan.parentElement.innerHTML = '<span class="text-sm font-semibold text-purple-900">‚è∞ No confession recorded yet</span>';
                return;
            }
            
            const now = new Date();
            const daysSince = Math.floor((now - lastConfessionDate) / (1000 * 60 * 60 * 24));
            
            daysSpan.textContent = daysSince;
            
            // Show reminder if it's been more than 7 days
            if (daysSince >= 7) {
                reminder.style.display = 'block';
                
                // Change color based on time
                if (daysSince >= 60) {
                    reminder.className = 'bg-red-50 border-2 border-red-400 rounded-lg p-3 mb-4';
                    daysSpan.className = 'text-2xl font-bold text-red-600 ml-2';
                } else if (daysSince >= 30) {
                    reminder.className = 'bg-orange-50 border-2 border-orange-400 rounded-lg p-3 mb-4';
                    daysSpan.className = 'text-2xl font-bold text-orange-600 ml-2';
                } else {
                    reminder.className = 'bg-purple-50 border-2 border-purple-300 rounded-lg p-3 mb-4';
                    daysSpan.className = 'text-2xl font-bold text-purple-600 ml-2';
                }
            } else {
                reminder.style.display = 'none';
            }
        }

        function recordNewConfession() {
            renderConfessionChecklist(); // Render updated examination questions
            document.getElementById('confession-form').style.display = 'block';
            // Clear previous selections
            document.querySelectorAll('#confession-form input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('confession-notes').value = '';
        }

        function cancelConfession() {
            document.getElementById('confession-form').style.display = 'none';
        }

        async function saveConfession() {
            try {
                const sins = [];
                document.querySelectorAll('#confession-form input[type="checkbox"]:checked').forEach(checkbox => {
                    sins.push(checkbox.dataset.sin);
                });
                
                // Also get tracked sin counts
                const customSins = loadCustomSins();
                const trackedSins = [];
                let lastConfessionDate = null;
                
                // Get last confession date
                try {
                    const confessionResult = await window.storage.list('confession:');
                    if (confessionResult && confessionResult.keys && confessionResult.keys.length > 0) {
                        const lastKey = confessionResult.keys.sort().reverse()[0];
                        const confessionData = await window.storage.get(lastKey);
                        if (confessionData && confessionData.value) {
                            const data = JSON.parse(confessionData.value);
                            lastConfessionDate = new Date(data.date);
                        }
                    }
                } catch (e) {
                    // No previous confession
                }
                
                // Get counts for each tracked sin
                for (const sin of customSins) {
                    const count = await getSinCount(sin.id, lastConfessionDate);
                    if (count > 0) {
                        trackedSins.push({
                            name: sin.name,
                            count: count
                        });
                    }
                }
                
                console.log('Saving confession with examination sins:', sins);
                console.log('Saving confession with tracked sins:', trackedSins);
                
                const confessionData = {
                    date: new Date().toISOString(),
                    sins: sins,
                    trackedSins: trackedSins,
                    notes: document.getElementById('confession-notes').value
                };
                
                const key = `confession:${Date.now()}`;
                console.log('Confession key:', key);
                console.log('Confession data:', confessionData);
                
                const saveResult = await window.storage.set(key, JSON.stringify(confessionData));
                console.log('Confession save result:', saveResult);
                
                if (!saveResult) {
                    throw new Error('Storage returned null - save may have failed');
                }
                
                // Reset all sin tracker counts
                await resetAllSinCounts();
                
                alert('‚úÖ Confession examination saved.\n\nRemember to complete the Sacrament with a priest.\n\nüîÑ All sin tracker counts have been reset to 0.');
                cancelConfession();
                await loadLastConfession();
                await updateSinSummary();
                // Reload sin trackers to refresh the display
                await loadSinTrackers();
            } catch (error) {
                console.error('Error saving confession:', error);
                alert('‚ùå Error saving confession record:\n' + error.message + '\n\nPlease check the debug panel for more info.');
            }
        }

        async function resetAllSinCounts() {
            try {
                // Get all custom sins
                const customSins = loadCustomSins();
                
                // Delete all sin tracker data
                for (const sin of customSins) {
                    const key = `sin-tracker:${sin.id}`;
                    await window.storage.delete(key);
                }
                
                console.log('‚úÖ All sin counts reset to 0');
            } catch (error) {
                console.error('Error resetting sin counts:', error);
            }
        }

        async function loadConfessionHistory() {
            try {
                const result = await window.storage.list('confession:');
                const historyDiv = document.getElementById('confession-list');
                
                if (!result || !result.keys || result.keys.length === 0) {
                    historyDiv.innerHTML = '<p class="text-gray-500">No confessions recorded yet.</p>';
                    return;
                }
                
                const sortedKeys = result.keys.sort().reverse();
                let html = '';
                
                for (const key of sortedKeys.slice(0, 10)) {
                    const confessionData = await window.storage.get(key);
                    if (confessionData && confessionData.value) {
                        const data = JSON.parse(confessionData.value);
                        const dateStr = new Date(data.date).toLocaleDateString('en-US', { 
                            year: 'numeric', month: 'long', day: 'numeric' 
                        });
                        
                        // Count total matters examined (examination sins + tracked sins)
                        const examinationCount = data.sins ? data.sins.length : 0;
                        const trackedSinCount = data.trackedSins ? data.trackedSins.length : 0;
                        const totalMatters = examinationCount + trackedSinCount;
                        
                        // Build the tracked sins display
                        let trackedSinsHtml = '';
                        if (data.trackedSins && data.trackedSins.length > 0) {
                            trackedSinsHtml = '<div class="mt-2 text-sm text-gray-600"><strong>Tracked Sins:</strong><ul class="list-disc list-inside ml-2">';
                            for (const sin of data.trackedSins) {
                                trackedSinsHtml += `<li>${sin.name}: ${sin.count} time(s)</li>`;
                            }
                            trackedSinsHtml += '</ul></div>';
                        }
                        
                        html += `
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <p class="font-semibold text-gray-800">${dateStr}</p>
                                <p class="text-sm text-gray-600 mt-1">${totalMatters} matter(s) examined</p>
                                ${trackedSinsHtml}
                                ${data.notes ? `<p class="text-sm text-gray-600 mt-2 italic">${data.notes}</p>` : ''}
                            </div>
                        `;
                    }
                }
                
                historyDiv.innerHTML = html;
            } catch (error) {
                console.error('Error loading confession history:', error);
            }
        }

        // Works of Mercy
        async function saveWorkOfMercy(work) {
            try {
                const key = `mercy:${currentDate}`;
                let mercyData = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        mercyData = JSON.parse(result.value);
                    }
                } catch (e) {
                    // Key doesn't exist yet
                }
                
                const checkbox = event.target;
                mercyData[work] = checkbox.checked;
                
                await window.storage.set(key, JSON.stringify(mercyData));
            } catch (error) {
                console.error('Error saving work of mercy:', error);
            }
        }

        async function saveWorkOfMercyNotes(work, notes) {
            try {
                const key = `mercy:${currentDate}`;
                let mercyData = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        mercyData = JSON.parse(result.value);
                    }
                } catch (e) {
                    // Key doesn't exist yet
                }
                
                mercyData[work + '_notes'] = notes;
                
                await window.storage.set(key, JSON.stringify(mercyData));
            } catch (error) {
                console.error('Error saving work of mercy notes:', error);
            }
        }

        // History/Calendar Functions
        let currentHistoryView = 'week';
        
        function changeHistoryView(view) {
            currentHistoryView = view;
            
            // Update button styles
            document.querySelectorAll('[id^="view-"]').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            document.getElementById('view-' + view).classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('view-' + view).classList.add('bg-indigo-600', 'text-white');
            
            loadHistory(view);
        }
        
        async function loadHistory(view) {
            try {
                const historyCalendar = document.getElementById('history-calendar');
                const noHistory = document.getElementById('no-history');
                
                // Get all daily activity keys
                const dailyResult = await window.storage.list('daily:');
                const mercyResult = await window.storage.list('mercy:');
                
                if ((!dailyResult || !dailyResult.keys || dailyResult.keys.length === 0) && 
                    (!mercyResult || !mercyResult.keys || mercyResult.keys.length === 0)) {
                    historyCalendar.style.display = 'none';
                    noHistory.style.display = 'block';
                    return;
                }
                
                historyCalendar.style.display = 'block';
                noHistory.style.display = 'none';
                
                // Combine all dates
                const allDates = new Set();
                if (dailyResult && dailyResult.keys) {
                    dailyResult.keys.forEach(key => {
                        const date = key.replace('daily:', '');
                        allDates.add(date);
                    });
                }
                if (mercyResult && mercyResult.keys) {
                    mercyResult.keys.forEach(key => {
                        const date = key.replace('mercy:', '');
                        allDates.add(date);
                    });
                }
                
                // Filter dates based on view
                const today = new Date();
                const filteredDates = Array.from(allDates).filter(dateStr => {
                    const date = new Date(dateStr);
                    const diffTime = today - date;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (view === 'week') return diffDays <= 7;
                    if (view === 'month') return diffDays <= 30;
                    return true; // 'all'
                }).sort().reverse();
                
                if (filteredDates.length === 0) {
                    historyCalendar.innerHTML = '<p class="text-gray-500 text-center py-8">No activity in this time period</p>';
                    return;
                }
                
                // Build history HTML
                let html = '';
                
                for (const dateStr of filteredDates) {
                    const date = new Date(dateStr);
                    const formattedDate = date.toLocaleDateString('en-US', { 
                        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                    });
                    
                    // Get daily activities
                    let dailyActivities = [];
                    try {
                        const dailyData = await window.storage.get(`daily:${dateStr}`);
                        if (dailyData && dailyData.value) {
                            const data = JSON.parse(dailyData.value);
                            const activityLabels = {
                                'rosary': 'üåπ Rosary',
                                'mass': '‚õ™ Mass',
                                'bible': 'üìñ Bible Reading',
                                'adoration': 'üïØÔ∏è Adoration',
                                'divine-office': 'üìø Divine Office',
                                'divine-mercy': 'üôè Divine Mercy',
                                'spiritual-reading': 'üìö Spiritual Reading',
                                'meditation': 'üßò Meditation',
                                'fasting': 'üçû Fasting',
                                'examination': 'üîç Examination'
                            };
                            
                            for (const [key, label] of Object.entries(activityLabels)) {
                                if (data[key]) {
                                    let activity = label;
                                    if (data[key + '_minutes']) {
                                        activity += ` (${data[key + '_minutes']} min)`;
                                    }
                                    dailyActivities.push(activity);
                                }
                            }
                        }
                    } catch (e) {
                        // No daily data for this date
                    }
                    
                    // Get works of mercy
                    let mercyWorks = [];
                    try {
                        const mercyData = await window.storage.get(`mercy:${dateStr}`);
                        if (mercyData && mercyData.value) {
                            const data = JSON.parse(mercyData.value);
                            const mercyLabels = {
                                'feed-hungry': 'Feed the Hungry',
                                'give-drink': 'Give Drink',
                                'clothe-naked': 'Clothe the Naked',
                                'shelter-homeless': 'Shelter Homeless',
                                'visit-sick': 'Visit the Sick',
                                'visit-imprisoned': 'Visit Imprisoned',
                                'bury-dead': 'Bury the Dead',
                                'instruct-ignorant': 'Instruct the Ignorant',
                                'counsel-doubtful': 'Counsel the Doubtful',
                                'admonish-sinners': 'Admonish Sinners',
                                'bear-wrongs': 'Bear Wrongs Patiently',
                                'forgive-offenses': 'Forgive Offenses',
                                'comfort-afflicted': 'Comfort the Afflicted',
                                'pray-living-dead': 'Pray for Living & Dead'
                            };
                            
                            for (const [key, label] of Object.entries(mercyLabels)) {
                                if (data[key]) {
                                    mercyWorks.push(label);
                                }
                            }
                        }
                    } catch (e) {
                        // No mercy data for this date
                    }
                    
                    // Build day card
                    html += `
                        <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">${formattedDate}</h3>
                            
                            ${dailyActivities.length > 0 ? `
                                <div class="mb-4">
                                    <h4 class="text-sm font-semibold text-indigo-700 mb-2">Daily Activities:</h4>
                                    <div class="flex flex-wrap gap-2">
                                        ${dailyActivities.map(act => `
                                            <span class="inline-block bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm">
                                                ${act}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${mercyWorks.length > 0 ? `
                                <div>
                                    <h4 class="text-sm font-semibold text-orange-700 mb-2">Works of Mercy:</h4>
                                    <div class="flex flex-wrap gap-2">
                                        ${mercyWorks.map(work => `
                                            <span class="inline-block bg-orange-50 text-orange-700 px-3 py-1 rounded-full text-sm">
                                                ${work}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${dailyActivities.length === 0 && mercyWorks.length === 0 ? `
                                <p class="text-gray-400 text-sm italic">No activities recorded</p>
                            ` : ''}
                        </div>
                    `;
                }
                
                historyCalendar.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('history-calendar').innerHTML = 
                    '<p class="text-red-600">Error loading history. Please try again.</p>';
            }
        }

        // Progress Stats
        async function updateProgressStats() {
            try {
                // Count unique days
                const dailyResult = await window.storage.list('daily:');
                const totalDays = dailyResult && dailyResult.keys ? dailyResult.keys.length : 0;
                document.getElementById('total-days').textContent = totalDays;
                
                // Count confessions
                const confessionResult = await window.storage.list('confession:');
                const totalConfessions = confessionResult && confessionResult.keys ? confessionResult.keys.length : 0;
                document.getElementById('total-confessions').textContent = totalConfessions;
                
                // Count works of mercy
                let totalMercyWorks = 0;
                const mercyResult = await window.storage.list('mercy:');
                if (mercyResult && mercyResult.keys) {
                    for (const key of mercyResult.keys) {
                        const data = await window.storage.get(key);
                        if (data && data.value) {
                            const mercyData = JSON.parse(data.value);
                            totalMercyWorks += Object.keys(mercyData).filter(k => !k.endsWith('_notes') && mercyData[k]).length;
                        }
                    }
                }
                document.getElementById('total-mercy-works').textContent = totalMercyWorks;
                
                // Activity summary
                await loadActivitySummary();
            } catch (error) {
                console.error('Error updating progress stats:', error);
            }
        }

        async function loadActivitySummary() {
            try {
                const summaryDiv = document.getElementById('activity-summary');
                const activities = {
                    'rosary': 'Holy Rosary',
                    'mass': 'Holy Mass',
                    'bible': 'Bible Reading',
                    'adoration': 'Eucharistic Adoration',
                    'divine-office': 'Divine Office'
                };
                
                let html = '';
                for (const [key, label] of Object.entries(activities)) {
                    let count = 0;
                    const dailyResult = await window.storage.list('daily:');
                    
                    if (dailyResult && dailyResult.keys) {
                        for (const dayKey of dailyResult.keys) {
                            const data = await window.storage.get(dayKey);
                            if (data && data.value) {
                                const dailyData = JSON.parse(data.value);
                                if (dailyData[key]) count++;
                            }
                        }
                    }
                    
                    html += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                            <span class="text-gray-700">${label}</span>
                            <span class="font-bold text-indigo-600">${count} days</span>
                        </div>
                    `;
                }
                
                summaryDiv.innerHTML = html;
            } catch (error) {
                console.error('Error loading activity summary:', error);
            }
        }

        // Load data on page load
        async function loadTodayData() {
            try {
                currentDate = getCurrentDate(); // Refresh date in case app was left open overnight
                const key = `daily:${currentDate}`;
                
                console.log('Loading data for date:', currentDate);
                console.log('Using storage key:', key);
                
                let result = null;
                try {
                    result = await window.storage.get(key);
                } catch (e) {
                    // Key not found is normal for a fresh day
                    console.log('No saved data for today (this is normal)');
                    return;
                }
                
                if (result && result.value) {
                    const dailyData = JSON.parse(result.value);
                    console.log('Loaded daily data:', dailyData);
                    
                    // Restore checkboxes
                    document.querySelectorAll('#daily-tab input[type="checkbox"]').forEach(checkbox => {
                        const activity = checkbox.getAttribute('onchange').match(/'([^']+)'/)[1];
                        if (dailyData[activity]) {
                            checkbox.checked = true;
                        }
                    });
                    
                    // Restore minutes
                    const minuteInputs = document.querySelectorAll('#daily-tab input[type="number"]');
                    minuteInputs.forEach(input => {
                        const onchangeAttr = input.getAttribute('onchange');
                        if (onchangeAttr) {
                            const match = onchangeAttr.match(/'([^']+)'/);
                            if (match) {
                                const activity = match[1];
                                if (dailyData[activity + '_minutes']) {
                                    input.value = dailyData[activity + '_minutes'];
                                }
                            }
                        }
                    });
                    
                    // Restore notes
                    if (dailyData.notes) {
                        document.getElementById('daily-notes').value = dailyData.notes;
                    }
                } else {
                    console.log('No saved data for today');
                }
            } catch (error) {
                console.error('Error loading today data:', error);
            }
        }

        async function loadTodayMercy() {
            try {
                const key = `mercy:${currentDate}`;
                
                let result = null;
                try {
                    result = await window.storage.get(key);
                } catch (e) {
                    // Key not found is normal - no works of mercy recorded yet today
                    return;
                }
                
                if (result && result.value) {
                    const mercyData = JSON.parse(result.value);
                    
                    document.querySelectorAll('#mercy-tab input[type="checkbox"]').forEach(checkbox => {
                        const onchangeAttr = checkbox.getAttribute('onchange');
                        if (onchangeAttr) {
                            const match = onchangeAttr.match(/'([^']+)'/);
                            if (match) {
                                const work = match[1];
                                if (mercyData[work]) {
                                    checkbox.checked = true;
                                }
                            }
                        }
                    });
                    
                    document.querySelectorAll('#mercy-tab textarea').forEach(textarea => {
                        const onchangeAttr = textarea.getAttribute('onchange');
                        if (onchangeAttr) {
                            const match = onchangeAttr.match(/'([^']+)'/);
                            if (match) {
                                const work = match[1];
                                if (mercyData[work + '_notes']) {
                                    textarea.value = mercyData[work + '_notes'];
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading today mercy data:', error);
            }
        }

        // Manual PIN Reset Function
        async function resetEverything() {
            const confirm1 = confirm(
                '‚ö†Ô∏è WARNING: This will delete ALL your data and reset the app!\n\n' +
                'This includes:\n' +
                '‚Ä¢ All daily activities\n' +
                '‚Ä¢ All confession records\n' +
                '‚Ä¢ All sin tracking\n' +
                '‚Ä¢ All works of mercy\n' +
                '‚Ä¢ All settings and preferences\n\n' +
                'Are you sure?'
            );
            
            if (!confirm1) return;
            
            const confirm2 = confirm('FINAL CONFIRMATION:\n\nClick OK to DELETE EVERYTHING and reset the app.');
            
            if (!confirm2) return;
            
            try {
                // Clear all localStorage
                localStorage.clear();
                
                alert('‚úÖ All data cleared!\n\nThe page will now reload with a fresh start.');
                
                // Reload the page
                window.location.reload();
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Storage Testing Function
        async function testStorage() {
            const debugDiv = document.getElementById('storage-debug');
            try {
                currentDate = getCurrentDate();
                debugDiv.innerHTML = 'Testing storage...<br>';
                
                // Test write
                const testKey = `test:${Date.now()}`;
                const testData = { test: true, timestamp: new Date().toISOString() };
                debugDiv.innerHTML += `Writing test data...<br>`;
                const writeResult = await window.storage.set(testKey, JSON.stringify(testData));
                debugDiv.innerHTML += `Write result: ${JSON.stringify(writeResult)}<br><br>`;
                
                // Test read
                debugDiv.innerHTML += `Reading test data...<br>`;
                const readResult = await window.storage.get(testKey);
                debugDiv.innerHTML += `Read result: ${JSON.stringify(readResult)}<br><br>`;
                
                // Check today's data
                const todayKey = `daily:${currentDate}`;
                debugDiv.innerHTML += `Current date: ${currentDate}<br>`;
                debugDiv.innerHTML += `Today's key: ${todayKey}<br>`;
                
                try {
                    const todayData = await window.storage.get(todayKey);
                    if (todayData && todayData.value) {
                        debugDiv.innerHTML += `Today's data exists:<br>${JSON.stringify(JSON.parse(todayData.value), null, 2)}<br><br>`;
                    } else {
                        debugDiv.innerHTML += `No data saved for today yet<br><br>`;
                    }
                } catch (e) {
                    debugDiv.innerHTML += `No data saved for today yet<br><br>`;
                }
                
                // List all stored keys
                const allDaily = await window.storage.list('daily:');
                debugDiv.innerHTML += `All daily activity dates:<br>`;
                if (allDaily && allDaily.keys && allDaily.keys.length > 0) {
                    allDaily.keys.forEach(key => {
                        debugDiv.innerHTML += `- ${key}<br>`;
                    });
                } else {
                    debugDiv.innerHTML += `No daily activities stored yet<br>`;
                }
                
                // Check confessions
                const allConfessions = await window.storage.list('confession:');
                debugDiv.innerHTML += `<br>All confession records:<br>`;
                if (allConfessions && allConfessions.keys && allConfessions.keys.length > 0) {
                    debugDiv.innerHTML += `Found ${allConfessions.keys.length} confession(s)<br>`;
                    allConfessions.keys.forEach(key => {
                        debugDiv.innerHTML += `- ${key}<br>`;
                    });
                } else {
                    debugDiv.innerHTML += `No confessions recorded yet<br>`;
                }
                
                // Check works of mercy
                const allMercy = await window.storage.list('mercy:');
                debugDiv.innerHTML += `<br>All works of mercy dates:<br>`;
                if (allMercy && allMercy.keys && allMercy.keys.length > 0) {
                    allMercy.keys.forEach(key => {
                        debugDiv.innerHTML += `- ${key}<br>`;
                    });
                } else {
                    debugDiv.innerHTML += `No works of mercy stored yet<br>`;
                }
                
                debugDiv.innerHTML += `<br>‚úÖ Storage is working!`;
                
            } catch (error) {
                debugDiv.innerHTML += `<br>‚ùå ERROR: ${error.message}<br>${error.stack}`;
                console.error('Storage test error:', error);
            }
        }

        // Sin Tracking Functions
        async function loadSinTrackers() {
            const dateEl = document.getElementById('tracker-date');
            if (dateEl) {
                dateEl.textContent = new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                });
            }
            
            // Get last confession date
            let lastConfessionDate = null;
            try {
                const confessionResult = await window.storage.list('confession:');
                if (confessionResult && confessionResult.keys && confessionResult.keys.length > 0) {
                    const lastKey = confessionResult.keys.sort().reverse()[0];
                    const confessionData = await window.storage.get(lastKey);
                    if (confessionData && confessionData.value) {
                        const data = JSON.parse(confessionData.value);
                        lastConfessionDate = new Date(data.date);
                    }
                }
            } catch (e) {
                console.log('No confession history yet');
            }
            
            // Update days since confession
            const daysEl = document.getElementById('days-since-confession');
            const nextEl = document.getElementById('next-confession-date');
            
            if (lastConfessionDate) {
                const daysSince = Math.floor((new Date() - lastConfessionDate) / (1000 * 60 * 60 * 24));
                if (daysEl) daysEl.textContent = daysSince + ' days';
                
                const nextDate = new Date(lastConfessionDate);
                nextDate.setDate(nextDate.getDate() + 30);
                if (nextEl) nextEl.textContent = nextDate.toLocaleDateString('en-US', { 
                    month: 'long', day: 'numeric', year: 'numeric' 
                });
            } else {
                if (daysEl) daysEl.textContent = 'No confession recorded yet';
                if (nextEl) nextEl.textContent = 'Record your first confession';
            }
            
            // Generate HTML for sin trackers
            const trackerList = document.getElementById('sin-tracker-list');
            if (!trackerList) {
                console.error('sin-tracker-list element not found');
                return;
            }
            
            const customSins = loadCustomSins();
            let html = '';
            
            // Get sin counts for current period
            for (const sin of customSins) {
                const count = await getSinCount(sin.id, lastConfessionDate);
                
                html += `
                    <div class="bg-white p-4 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-gray-800">${sin.name}</span>
                            <span class="text-2xl font-bold text-indigo-600" id="count-${sin.id}">${count}</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="incrementSin('${sin.id}')" 
                                    class="flex-1 bg-red-100 text-red-700 px-3 py-2 rounded hover:bg-red-200 text-sm font-semibold">
                                + Mark Today
                            </button>
                            <button onclick="decrementSin('${sin.id}')" 
                                    class="bg-gray-100 text-gray-700 px-3 py-2 rounded hover:bg-gray-200 text-sm">
                                ‚àí
                            </button>
                        </div>
                    </div>
                `;
            }
            
            trackerList.innerHTML = html;
            await updateSinSummary();
        }

        async function getSinCount(sinId, sinceDate) {
            try {
                const key = `sin-tracker:${sinId}`;
                const result = await window.storage.get(key);
                
                if (!result || !result.value) return 0;
                
                const data = JSON.parse(result.value);
                let count = 0;
                
                // Count occurrences since last confession
                for (const [date, occurrences] of Object.entries(data)) {
                    const entryDate = new Date(date);
                    if (!sinceDate || entryDate > sinceDate) {
                        count += occurrences;
                    }
                }
                
                return count;
            } catch (e) {
                return 0;
            }
        }

        async function incrementSin(sinId) {
            try {
                currentDate = getCurrentDate();
                const key = `sin-tracker:${sinId}`;
                let data = {};
                
                try {
                    const result = await window.storage.get(key);
                    if (result && result.value) {
                        data = JSON.parse(result.value);
                    }
                } catch (e) {
                    // New tracker
                }
                
                // Increment count for today
                if (!data[currentDate]) {
                    data[currentDate] = 0;
                }
                data[currentDate]++;
                
                await window.storage.set(key, JSON.stringify(data));
                
                // Just refresh the counts display
                await loadSinCounts();
                await updateSinSummary();
            } catch (error) {
                console.error('Error tracking sin:', error);
            }
        }

        async function decrementSin(sinId) {
            try {
                currentDate = getCurrentDate();
                const key = `sin-tracker:${sinId}`;
                
                const result = await window.storage.get(key);
                if (!result || !result.value) return;
                
                let data = JSON.parse(result.value);
                
                if (data[currentDate] && data[currentDate] > 0) {
                    data[currentDate]--;
                    if (data[currentDate] === 0) {
                        delete data[currentDate];
                    }
                    await window.storage.set(key, JSON.stringify(data));
                    
                    // Just refresh the counts display
                    await loadSinCounts();
                    await updateSinSummary();
                }
            } catch (error) {
                console.error('Error decrementing sin:', error);
            }
        }

        async function updateSinSummary() {
            const summaryDiv = document.getElementById('sin-summary');
            const confessionSummaryDiv = document.getElementById('confession-sin-summary');
            
            let html = '<p class="text-sm text-gray-600 mb-3">Since last confession:</p>';
            let confessionHtml = '<p class="text-sm text-gray-600 mb-3">Review these tracked sins for your confession:</p>';
            
            // Get last confession date
            let lastConfessionDate = null;
            try {
                const confessionResult = await window.storage.list('confession:');
                if (confessionResult && confessionResult.keys && confessionResult.keys.length > 0) {
                    const lastKey = confessionResult.keys.sort().reverse()[0];
                    const confessionData = await window.storage.get(lastKey);
                    if (confessionData && confessionData.value) {
                        const data = JSON.parse(confessionData.value);
                        lastConfessionDate = new Date(data.date);
                    }
                }
            } catch (e) {}
            
            // Use custom sins from settings
            const customSins = loadCustomSins();
            let hasTrackedSins = false;
            
            for (const sin of customSins) {
                const count = await getSinCount(sin.id, lastConfessionDate);
                if (count > 0) {
                    hasTrackedSins = true;
                    html += `
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-700">${sin.name}</span>
                            <span class="font-semibold text-red-600">${count}√ó</span>
                        </div>
                    `;
                    confessionHtml += `
                        <div class="flex justify-between items-center bg-white p-2 rounded">
                            <span class="text-gray-700">${sin.name}</span>
                            <span class="font-bold text-red-600 text-lg">${count}√ó</span>
                        </div>
                    `;
                }
            }
            
            if (!hasTrackedSins) {
                html += '<p class="text-sm text-green-600 italic">No sins tracked this period üôè</p>';
                confessionHtml += '<p class="text-sm text-gray-500 italic">No sins tracked since last confession. Use the Sin Tracker tab to track specific sins between confessions.</p>';
            }
            
            if (summaryDiv) summaryDiv.innerHTML = html;
            if (confessionSummaryDiv) confessionSummaryDiv.innerHTML = confessionHtml;
        }

        // Data Management Functions
        async function exportData() {
            const statusDiv = document.getElementById('export-status');
            try {
                statusDiv.innerHTML = '<span class="text-blue-600">üì¶ Gathering your data...</span>';
                
                // Ask if user wants encryption
                const shouldEncrypt = confirm(
                    'üîí Would you like to password-protect this backup?\n\n' +
                    'Protected backups require a password to import.\n\n' +
                    'Click OK to set a password\n' +
                    'Click Cancel for unprotected backup'
                );
                
                let password = null;
                if (shouldEncrypt) {
                    password = prompt('Enter a password for this backup:');
                    if (!password) {
                        statusDiv.innerHTML = '<span class="text-red-600">‚ùå Export cancelled</span>';
                        return;
                    }
                    const confirmPassword = prompt('Confirm password:');
                    if (password !== confirmPassword) {
                        statusDiv.innerHTML = '<span class="text-red-600">‚ùå Passwords do not match</span>';
                        return;
                    }
                }
                
                // Collect all data
                const exportData = {
                    exportDate: new Date().toISOString(),
                    appVersion: '7.0',
                    encrypted: shouldEncrypt,
                    data: {
                        daily: {},
                        confessions: {},
                        mercy: {},
                        sinTracking: {}
                    }
                };
                
                // Get all daily activities
                const dailyResult = await window.storage.list('daily:');
                if (dailyResult && dailyResult.keys) {
                    for (const key of dailyResult.keys) {
                        const result = await window.storage.get(key);
                        if (result && result.value) {
                            exportData.data.daily[key] = result.value;
                        }
                    }
                }
                
                // Get all confessions
                const confessionResult = await window.storage.list('confession:');
                if (confessionResult && confessionResult.keys) {
                    for (const key of confessionResult.keys) {
                        const result = await window.storage.get(key);
                        if (result && result.value) {
                            exportData.data.confessions[key] = result.value;
                        }
                    }
                }
                
                // Get all works of mercy
                const mercyResult = await window.storage.list('mercy:');
                if (mercyResult && mercyResult.keys) {
                    for (const key of mercyResult.keys) {
                        const result = await window.storage.get(key);
                        if (result && result.value) {
                            exportData.data.mercy[key] = result.value;
                        }
                    }
                }
                
                // Get all sin tracking data
                const sinResult = await window.storage.list('sin-tracker:');
                if (sinResult && sinResult.keys) {
                    for (const key of sinResult.keys) {
                        const result = await window.storage.get(key);
                        if (result && result.value) {
                            exportData.data.sinTracking[key] = result.value;
                        }
                    }
                }
                
                let dataStr = JSON.stringify(exportData, null, 2);
                
                // Encrypt if requested
                if (shouldEncrypt && password) {
                    statusDiv.innerHTML = '<span class="text-blue-600">üîê Encrypting backup...</span>';
                    dataStr = await encrypt(dataStr, password);
                }
                
                // Create download
                const dataBlob = new Blob([dataStr], { type: shouldEncrypt ? 'application/octet-stream' : 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                const dateStr = new Date().toISOString().split('T')[0];
                link.download = `sanctification-backup-${dateStr}${shouldEncrypt ? '.encrypted' : '.json'}`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Track export date
                localStorage.setItem('last-export-date', new Date().toISOString());
                
                const dailyCount = Object.keys(exportData.data.daily).length;
                const confessionCount = Object.keys(exportData.data.confessions).length;
                const mercyCount = Object.keys(exportData.data.mercy).length;
                const sinCount = Object.keys(exportData.data.sinTracking).length;
                
                statusDiv.innerHTML = `<span class="text-green-600">‚úÖ Backup downloaded successfully!<br>
                    ${shouldEncrypt ? 'üîí Password-protected backup<br>' : ''}
                    Included: ${dailyCount} days of activities, ${confessionCount} confession(s), ${mercyCount} days of mercy, ${sinCount} sin trackers<br>
                    <strong>Last backup: Just now</strong></span>`;
                
            } catch (error) {
                console.error('Export error:', error);
                statusDiv.innerHTML = `<span class="text-red-600">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function importData() {
            const statusDiv = document.getElementById('import-status');
            const fileInput = document.getElementById('import-file');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                statusDiv.innerHTML = '<span class="text-red-600">‚ùå Please select a backup file first</span>';
                return;
            }
            
            try {
                statusDiv.innerHTML = '<span class="text-blue-600">üì• Reading backup file...</span>';
                
                const file = fileInput.files[0];
                let fileText = await file.text();
                let importData;
                
                // Check if file is encrypted
                const isEncrypted = file.name.endsWith('.encrypted') || fileText.length < 1000 && !fileText.startsWith('{');
                
                if (isEncrypted) {
                    const password = prompt('Enter the password for this backup:');
                    if (!password) {
                        statusDiv.innerHTML = '<span class="text-red-600">‚ùå Import cancelled</span>';
                        return;
                    }
                    
                    statusDiv.innerHTML = '<span class="text-blue-600">üîì Decrypting backup...</span>';
                    try {
                        fileText = await decrypt(fileText, password);
                    } catch (e) {
                        statusDiv.innerHTML = '<span class="text-red-600">‚ùå Wrong password or corrupted file</span>';
                        return;
                    }
                }
                
                importData = JSON.parse(fileText);
                
                // Validate file structure
                if (!importData.data) {
                    throw new Error('Invalid backup file format');
                }
                
                statusDiv.innerHTML = '<span class="text-blue-600">üíæ Importing data...</span>';
                
                let imported = { daily: 0, confessions: 0, mercy: 0, sinTracking: 0 };
                
                // Import daily activities
                if (importData.data.daily) {
                    for (const [key, value] of Object.entries(importData.data.daily)) {
                        await window.storage.set(key, value);
                        imported.daily++;
                    }
                }
                
                // Import confessions
                if (importData.data.confessions) {
                    for (const [key, value] of Object.entries(importData.data.confessions)) {
                        await window.storage.set(key, value);
                        imported.confessions++;
                    }
                }
                
                // Import works of mercy
                if (importData.data.mercy) {
                    for (const [key, value] of Object.entries(importData.data.mercy)) {
                        await window.storage.set(key, value);
                        imported.mercy++;
                    }
                }
                
                // Import sin tracking
                if (importData.data.sinTracking) {
                    for (const [key, value] of Object.entries(importData.data.sinTracking)) {
                        await window.storage.set(key, value);
                        imported.sinTracking++;
                    }
                }
                
                statusDiv.innerHTML = `<span class="text-green-600">‚úÖ Import successful!<br>
                    ${isEncrypted ? 'üîì Decrypted backup<br>' : ''}
                    Imported: ${imported.daily} days of activities, ${imported.confessions} confession(s), ${imported.mercy} days of mercy, ${imported.sinTracking} sin trackers<br>
                    <em>Refresh the page to see imported data</em></span>`;
                
                // Reload current tab data
                await loadTodayData();
                await loadTodayMercy();
                
            } catch (error) {
                console.error('Import error:', error);
                statusDiv.innerHTML = `<span class="text-red-600">‚ùå Error: ${error.message}<br>
                    Make sure you selected a valid backup file from this app.</span>`;
            }
        }

        async function clearAllData() {
            const confirmation = confirm(
                '‚ö†Ô∏è WARNING: This will permanently delete ALL your spiritual tracking data!\n\n' +
                'This includes:\n' +
                '‚Ä¢ All daily activities\n' +
                '‚Ä¢ All confession records\n' +
                '‚Ä¢ All works of mercy\n\n' +
                'This action CANNOT be undone!\n\n' +
                'Are you absolutely sure you want to continue?'
            );
            
            if (!confirmation) {
                return;
            }
            
            const doubleCheck = confirm(
                'FINAL CONFIRMATION:\n\n' +
                'Are you REALLY sure you want to delete everything?\n\n' +
                'Click OK to delete all data.\n' +
                'Click Cancel to keep your data safe.'
            );
            
            if (!doubleCheck) {
                return;
            }
            
            const statusDiv = document.getElementById('clear-status');
            
            try {
                statusDiv.innerHTML = '<span class="text-blue-600">üóëÔ∏è Deleting all data...</span>';
                
                let deleted = { daily: 0, confessions: 0, mercy: 0 };
                
                // Delete all daily activities
                const dailyResult = await window.storage.list('daily:');
                if (dailyResult && dailyResult.keys) {
                    for (const key of dailyResult.keys) {
                        await window.storage.delete(key);
                        deleted.daily++;
                    }
                }
                
                // Delete all confessions
                const confessionResult = await window.storage.list('confession:');
                if (confessionResult && confessionResult.keys) {
                    for (const key of confessionResult.keys) {
                        await window.storage.delete(key);
                        deleted.confessions++;
                    }
                }
                
                // Delete all works of mercy
                const mercyResult = await window.storage.list('mercy:');
                if (mercyResult && mercyResult.keys) {
                    for (const key of mercyResult.keys) {
                        await window.storage.delete(key);
                        deleted.mercy++;
                    }
                }
                
                statusDiv.innerHTML = `<span class="text-green-600">‚úÖ All data deleted.<br>
                    Deleted: ${deleted.daily} days of activities, ${deleted.confessions} confession(s), ${deleted.mercy} days of works of mercy<br>
                    <em>Refresh the page to reset the interface</em></span>`;
                
                // Clear the current UI
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
            } catch (error) {
                console.error('Clear data error:', error);
                statusDiv.innerHTML = `<span class="text-red-600">‚ùå Error: ${error.message}</span>`;
            }
        }

        // Initialize on load
        window.addEventListener('load', async () => {
            console.log('App starting - no PIN security');
            
            // CRITICAL: Show security warning on first launch
            if (!localStorage.getItem('security-warning-shown')) {
                const warning = `‚ö†Ô∏è IMPORTANT SECURITY NOTICE ‚ö†Ô∏è

This app stores sensitive spiritual data including:
‚Ä¢ Confession records
‚Ä¢ Sin tracking
‚Ä¢ Personal spiritual activities

NO PASSWORD PROTECTION is enabled.

Anyone with access to this device can read your data.

RECOMMENDATIONS:
‚úÖ Use only on personal devices
‚úÖ Enable strong device passcode/Face ID
‚úÖ Export backups regularly
‚úÖ Clear data if selling/sharing device

Do you understand and accept these security limitations?`;
                
                if (confirm(warning)) {
                    localStorage.setItem('security-warning-shown', 'true');
                } else {
                    alert('Please ensure your device is secure before using this app.');
                    localStorage.setItem('security-warning-shown', 'true');
                }
            }
            
            // Check backup reminder
            checkBackupReminder();
            
            // Load customization settings
            loadCustomization();
            loadReminderSettings();
            
            // ‚ú® RENDER DYNAMIC CONTENT ‚ú®
            renderDailyActivities();
            renderConfessionChecklist();
            
            // Initialize journal
            initializeJournal();
            
            // Initialize Bible
            await loadBibleData();
            
            // Load data immediately
            await loadTodayData();
            await loadTodayMercy();
            await loadLastConfession();
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                try {
                    await navigator.serviceWorker.register('sw.js');
                    console.log('Service worker registered');
                } catch (error) {
                    console.log('Service worker registration failed:', error);
                }
            }
        });

        // Backup reminder system
        function checkBackupReminder() {
            const lastExport = localStorage.getItem('last-export-date');
            const now = new Date();
            
            if (!lastExport) {
                // Never exported - show gentle reminder after 7 days of use
                const firstUse = localStorage.getItem('first-use-date');
                if (!firstUse) {
                    localStorage.setItem('first-use-date', now.toISOString());
                } else {
                    const daysSinceFirst = Math.floor((now - new Date(firstUse)) / (1000 * 60 * 60 * 24));
                    if (daysSinceFirst >= 7) {
                        showBackupReminder('You\'ve been using this app for ' + daysSinceFirst + ' days. Back up your data to prevent loss!');
                    }
                }
            } else {
                const lastExportDate = new Date(lastExport);
                const daysSinceExport = Math.floor((now - lastExportDate) / (1000 * 60 * 60 * 24));
                
                if (daysSinceExport >= 7) {
                    showBackupReminder('It\'s been ' + daysSinceExport + ' days since your last backup!');
                }
            }
        }

        function showBackupReminder(message) {
            const banner = document.getElementById('backup-reminder-banner');
            if (banner) {
                document.getElementById('backup-reminder-text').textContent = message;
                banner.style.display = 'block';
            }
        }

        // ========== JOURNAL FUNCTIONS ==========
        
        let journalAutoSaveTimer = null;
        
        // Initialize journal when page loads
        function initializeJournal() {
            setJournalToToday();
            loadJournalEntriesList();
        }
        
        // Set journal date to today
        function setJournalToToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('journal-date').value = today;
            loadJournalEntry();
        }
        
        // Load journal entry for selected date
        async function loadJournalEntry() {
            const dateInput = document.getElementById('journal-date');
            const entryTextarea = document.getElementById('journal-entry');
            const statusP = document.getElementById('journal-entry-status');
            
            const selectedDate = dateInput.value;
            if (!selectedDate) {
                setJournalToToday();
                return;
            }
            
            try {
                const result = await window.storage.get(`journal:${selectedDate}`);
                
                if (result && result.value) {
                    const entry = JSON.parse(result.value);
                    entryTextarea.value = entry.text || '';
                    statusP.textContent = `Entry from ${formatJournalDate(selectedDate)} (Last saved: ${new Date(entry.lastModified).toLocaleString()})`;
                    statusP.className = 'text-sm text-green-600 font-semibold';
                } else {
                    entryTextarea.value = '';
                    statusP.textContent = 'No entry for this date';
                    statusP.className = 'text-sm text-gray-600';
                }
                
                updateJournalWordCount();
            } catch (error) {
                entryTextarea.value = '';
                statusP.textContent = 'No entry for this date';
                statusP.className = 'text-sm text-gray-600';
                updateJournalWordCount();
            }
        }
        
        // Save journal entry
        async function saveJournalEntry() {
            const dateInput = document.getElementById('journal-date');
            const entryTextarea = document.getElementById('journal-entry');
            const statusSpan = document.getElementById('journal-save-status');
            const entryStatus = document.getElementById('journal-entry-status');
            
            const selectedDate = dateInput.value;
            const entryText = entryTextarea.value.trim();
            
            if (!selectedDate) {
                alert('Please select a date');
                return;
            }
            
            statusSpan.textContent = 'Saving...';
            statusSpan.className = 'text-sm text-blue-600 italic';
            
            try {
                const entry = {
                    date: selectedDate,
                    text: entryText,
                    wordCount: countWords(entryText),
                    lastModified: new Date().toISOString()
                };
                
                if (entryText.length > 0) {
                    await window.storage.set(`journal:${selectedDate}`, JSON.stringify(entry));
                    statusSpan.textContent = '‚úÖ Saved successfully!';
                    statusSpan.className = 'text-sm text-green-600 font-semibold italic';
                    entryStatus.textContent = `Entry from ${formatJournalDate(selectedDate)} (Last saved: ${new Date().toLocaleString()})`;
                    entryStatus.className = 'text-sm text-green-600 font-semibold';
                } else {
                    // Delete entry if empty
                    await window.storage.delete(`journal:${selectedDate}`);
                    statusSpan.textContent = '‚úÖ Empty entry deleted';
                    statusSpan.className = 'text-sm text-orange-600 font-semibold italic';
                    entryStatus.textContent = 'No entry for this date';
                    entryStatus.className = 'text-sm text-gray-600';
                }
                
                // Refresh the entries list
                await loadJournalEntriesList();
                
                // Clear status after 3 seconds
                setTimeout(() => {
                    statusSpan.textContent = '';
                }, 3000);
            } catch (error) {
                console.error('Journal save error:', error);
                statusSpan.textContent = '‚ùå Error saving';
                statusSpan.className = 'text-sm text-red-600 font-semibold italic';
            }
        }
        
        // Auto-save journal (debounced)
        function autoSaveJournal() {
            const statusSpan = document.getElementById('journal-save-status');
            statusSpan.textContent = 'Auto-saving...';
            statusSpan.className = 'text-sm text-blue-600 italic';
            
            clearTimeout(journalAutoSaveTimer);
            journalAutoSaveTimer = setTimeout(async () => {
                await saveJournalEntry();
            }, 2000); // Save 2 seconds after user stops typing
        }
        
        // Update word count
        function updateJournalWordCount() {
            const entryTextarea = document.getElementById('journal-entry');
            const wordCountP = document.getElementById('journal-word-count');
            const text = entryTextarea.value.trim();
            const wordCount = countWords(text);
            const charCount = text.length;
            
            wordCountP.textContent = `${wordCount} words, ${charCount} characters`;
        }
        
        // Count words in text
        function countWords(text) {
            if (!text || text.trim().length === 0) return 0;
            return text.trim().split(/\s+/).length;
        }
        
        // Load list of journal entries
        async function loadJournalEntriesList() {
            const listDiv = document.getElementById('journal-entries-list');
            
            try {
                const result = await window.storage.list('journal:');
                
                if (!result || !result.keys || result.keys.length === 0) {
                    listDiv.innerHTML = '<p class="text-sm text-gray-600 italic">No journal entries yet. Start writing!</p>';
                    return;
                }
                
                // Get all entries
                const entries = [];
                for (const key of result.keys) {
                    try {
                        const entryResult = await window.storage.get(key);
                        if (entryResult && entryResult.value) {
                            const entry = JSON.parse(entryResult.value);
                            entries.push(entry);
                        }
                    } catch (e) {
                        console.error('Error loading entry:', e);
                    }
                }
                
                // Sort by date descending
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display entries
                listDiv.innerHTML = entries.map(entry => {
                    const preview = entry.text.substring(0, 100) + (entry.text.length > 100 ? '...' : '');
                    return `
                        <div class="bg-white p-3 rounded border border-blue-300 hover:border-blue-500 cursor-pointer transition"
                             onclick="loadJournalEntryByDate('${entry.date}')">
                            <p class="font-semibold text-sm text-blue-800">${formatJournalDate(entry.date)}</p>
                            <p class="text-xs text-gray-600 mt-1">${entry.wordCount} words</p>
                            <p class="text-xs text-gray-700 mt-1 italic">${preview}</p>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading journal list:', error);
                listDiv.innerHTML = '<p class="text-sm text-red-600">Error loading entries</p>';
            }
        }
        
        // Load specific journal entry by date
        function loadJournalEntryByDate(date) {
            document.getElementById('journal-date').value = date;
            loadJournalEntry();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Format date for display
        function formatJournalDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        // Search journal
        async function searchJournal() {
            const searchInput = document.getElementById('journal-search');
            const resultsDiv = document.getElementById('journal-search-results');
            const query = searchInput.value.trim().toLowerCase();
            
            if (query.length < 2) {
                resultsDiv.innerHTML = '<p class="text-sm text-gray-600 italic">Type at least 2 characters to search</p>';
                return;
            }
            
            try {
                const result = await window.storage.list('journal:');
                
                if (!result || !result.keys || result.keys.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-sm text-gray-600 italic">No entries to search</p>';
                    return;
                }
                
                // Search through all entries
                const matches = [];
                for (const key of result.keys) {
                    try {
                        const entryResult = await window.storage.get(key);
                        if (entryResult && entryResult.value) {
                            const entry = JSON.parse(entryResult.value);
                            if (entry.text.toLowerCase().includes(query)) {
                                matches.push(entry);
                            }
                        }
                    } catch (e) {
                        console.error('Error searching entry:', e);
                    }
                }
                
                if (matches.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-sm text-gray-600 italic">No matches found</p>';
                    return;
                }
                
                // Sort by date descending
                matches.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display matches
                resultsDiv.innerHTML = matches.map(entry => {
                    // Find matching text context
                    const lowerText = entry.text.toLowerCase();
                    const index = lowerText.indexOf(query);
                    const start = Math.max(0, index - 40);
                    const end = Math.min(entry.text.length, index + query.length + 40);
                    let preview = entry.text.substring(start, end);
                    if (start > 0) preview = '...' + preview;
                    if (end < entry.text.length) preview = preview + '...';
                    
                    return `
                        <div class="bg-white p-3 rounded border border-purple-300 hover:border-purple-500 cursor-pointer transition"
                             onclick="loadJournalEntryByDate('${entry.date}')">
                            <p class="font-semibold text-sm text-purple-800">${formatJournalDate(entry.date)}</p>
                            <p class="text-xs text-gray-700 mt-1">${preview}</p>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error searching journal:', error);
                resultsDiv.innerHTML = '<p class="text-sm text-red-600">Error searching entries</p>';
            }
        }
        
        // Export journal as text file
        async function exportJournalAsText() {
            try {
                const result = await window.storage.list('journal:');
                
                if (!result || !result.keys || result.keys.length === 0) {
                    alert('No journal entries to export');
                    return;
                }
                
                // Get all entries
                const entries = [];
                for (const key of result.keys) {
                    try {
                        const entryResult = await window.storage.get(key);
                        if (entryResult && entryResult.value) {
                            const entry = JSON.parse(entryResult.value);
                            entries.push(entry);
                        }
                    } catch (e) {
                        console.error('Error loading entry:', e);
                    }
                }
                
                // Sort by date ascending
                entries.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Create text content
                let textContent = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
                textContent += '     SPIRITUAL JOURNAL EXPORT\n';
                textContent += '     Path to Sanctification\n';
                textContent += `     Exported: ${new Date().toLocaleString()}\n`;
                textContent += `     Total Entries: ${entries.length}\n`;
                textContent += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
                
                entries.forEach((entry, index) => {
                    textContent += `\n${'‚îÄ'.repeat(50)}\n`;
                    textContent += `Entry ${index + 1} - ${formatJournalDate(entry.date)}\n`;
                    textContent += `Word Count: ${entry.wordCount}\n`;
                    textContent += `${'‚îÄ'.repeat(50)}\n\n`;
                    textContent += entry.text;
                    textContent += '\n\n';
                });
                
                // Create and download file
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `spiritual-journal-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`‚úÖ Journal exported successfully!\n${entries.length} entries saved to text file.`);
                
            } catch (error) {
                console.error('Export error:', error);
                alert('‚ùå Error exporting journal');
            }
        }
        
        // Export journal as JSON
        async function exportJournalAsJSON() {
            try {
                const result = await window.storage.list('journal:');
                
                if (!result || !result.keys || result.keys.length === 0) {
                    alert('No journal entries to export');
                    return;
                }
                
                // Get all entries
                const entries = [];
                for (const key of result.keys) {
                    try {
                        const entryResult = await window.storage.get(key);
                        if (entryResult && entryResult.value) {
                            const entry = JSON.parse(entryResult.value);
                            entries.push(entry);
                        }
                    } catch (e) {
                        console.error('Error loading entry:', e);
                    }
                }
                
                // Sort by date ascending
                entries.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Create JSON export
                const exportData = {
                    exportDate: new Date().toISOString(),
                    appName: 'Path to Sanctification',
                    dataType: 'spiritual-journal',
                    version: '12.3',
                    totalEntries: entries.length,
                    entries: entries
                };
                
                // Create and download file
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `spiritual-journal-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`‚úÖ Journal exported successfully!\n${entries.length} entries saved to JSON file.`);
                
            } catch (error) {
                console.error('Export error:', error);
                alert('‚ùå Error exporting journal');
            }
        }
        
        // Delete all journal entries
        async function confirmDeleteAllJournalEntries() {
            const confirmation = confirm(
                '‚ö†Ô∏è WARNING: This will permanently delete ALL your journal entries!\n\n' +
                'This action CANNOT be undone!\n\n' +
                'Are you sure you want to continue?'
            );
            
            if (!confirmation) return;
            
            const doubleCheck = confirm(
                'FINAL CONFIRMATION:\n\n' +
                'Are you REALLY sure you want to delete all journal entries?\n\n' +
                'Click OK to delete.\n' +
                'Click Cancel to keep your entries safe.'
            );
            
            if (!doubleCheck) return;
            
            try {
                const result = await window.storage.list('journal:');
                
                if (result && result.keys) {
                    let count = 0;
                    for (const key of result.keys) {
                        await window.storage.delete(key);
                        count++;
                    }
                    
                    alert(`‚úÖ ${count} journal entries deleted`);
                    
                    // Clear current entry
                    document.getElementById('journal-entry').value = '';
                    updateJournalWordCount();
                    
                    // Reload lists
                    await loadJournalEntriesList();
                    document.getElementById('journal-search-results').innerHTML = '<p class="text-sm text-gray-600 italic">Search results will appear here</p>';
                }
                
            } catch (error) {
                console.error('Delete error:', error);
                alert('‚ùå Error deleting journal entries');
            }
        }
        
        // ========== END JOURNAL FUNCTIONS ==========

        // ========== BIBLE FUNCTIONS ==========
        
        let bibleData = null;
        let currentHighlightColor = null;
        let bibleAnnotations = {}; // { verseId: { highlight: 'yellow', note: 'text', verseId: 'Gen.1.1' } }
        
        async function loadBibleData() {
            try {
                // Load Bible content
                const bibleResult = await window.storage.get('bible:content');
                if (bibleResult && bibleResult.value) {
                    bibleData = JSON.parse(bibleResult.value);
                    document.getElementById('bible-upload-section').style.display = 'none';
                    document.getElementById('bible-reading-section').style.display = 'block';
                    populateBookList();
                }
                
                // Load annotations
                const annotationsResult = await window.storage.get('bible:annotations');
                if (annotationsResult && annotationsResult.value) {
                    bibleAnnotations = JSON.parse(annotationsResult.value);
                }
                updateAnnotationsList();
            } catch (error) {
                console.error('Error loading Bible data:', error);
            }
        }
        
        async function loadBibleFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('bible-upload-status');
            statusDiv.innerHTML = '<span class="text-blue-600">üìñ Loading Bible...</span>';
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                // Validate structure
                if (!data.books || !Array.isArray(data.books)) {
                    throw new Error('Invalid format: missing "books" array');
                }
                
                bibleData = data;
                await window.storage.set('bible:content', JSON.stringify(data));
                
                statusDiv.innerHTML = '<span class="text-green-600">‚úÖ Bible loaded successfully!</span>';
                
                setTimeout(() => {
                    document.getElementById('bible-upload-section').style.display = 'none';
                    document.getElementById('bible-reading-section').style.display = 'block';
                    populateBookList();
                }, 1000);
                
            } catch (error) {
                statusDiv.innerHTML = `<span class="text-red-600">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        function populateBookList() {
            const bookSelect = document.getElementById('bible-book-select');
            const bookNav = document.getElementById('bible-book-nav');
            
            bookSelect.innerHTML = '<option value="">Select a book...</option>';
            bookNav.innerHTML = '';
            
            bibleData.books.forEach((book, index) => {
                // Dropdown
                const option = document.createElement('option');
                option.value = index;
                option.textContent = book.name;
                bookSelect.appendChild(option);
                
                // Quick nav
                const btn = document.createElement('button');
                btn.className = 'bible-book-btn';
                btn.textContent = book.name;
                btn.onclick = () => {
                    bookSelect.value = index;
                    loadBibleBook();
                };
                bookNav.appendChild(btn);
            });
        }
        
        function loadBibleBook() {
            const bookIndex = document.getElementById('bible-book-select').value;
            const chapterSelect = document.getElementById('bible-chapter-select');
            
            if (!bookIndex) {
                chapterSelect.innerHTML = '<option value="">Select chapter...</option>';
                return;
            }
            
            const book = bibleData.books[bookIndex];
            chapterSelect.innerHTML = '<option value="">Select chapter...</option>';
            
            book.chapters.forEach((chapter, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Chapter ${chapter.number}`;
                chapterSelect.appendChild(option);
            });
        }
        
        function loadBibleChapter() {
            const bookIndex = document.getElementById('bible-book-select').value;
            const chapterIndex = document.getElementById('bible-chapter-select').value;
            
            if (!bookIndex || chapterIndex === '') return;
            
            const book = bibleData.books[bookIndex];
            const chapter = book.chapters[chapterIndex];
            const pane = document.getElementById('bible-reading-pane');
            
            let html = `<div class="bible-chapter-title">${book.name} ${chapter.number}</div>`;
            
            chapter.verses.forEach(verse => {
                const verseId = `${book.name}.${chapter.number}.${verse.number}`;
                const annotation = bibleAnnotations[verseId];
                const highlightClass = annotation?.highlight ? `highlighted-${annotation.highlight}` : '';
                
                html += `<div class="bible-verse ${highlightClass}" data-verse-id="${verseId}">
                    <span class="verse-number" onclick="addVerseNote('${verseId}')">${verse.number}</span>
                    <span class="verse-text" onclick="handleVerseClick('${verseId}')">${verse.text}</span>
                </div>`;
                
                if (annotation?.note) {
                    html += `<div class="bible-note">
                        <div class="note-header">
                            <span class="note-label">üìù Note:</span>
                            <div class="note-actions">
                                <button class="edit-btn" onclick="editVerseNote('${verseId}')">Edit</button>
                                <button class="delete-btn" onclick="deleteNote('${verseId}')">Delete</button>
                            </div>
                        </div>
                        <div class="note-text">${annotation.note}</div>
                    </div>`;
                }
            });
            
            pane.innerHTML = html;
        }
        
        function selectHighlightColor(color) {
            currentHighlightColor = color === 'none' ? null : color;
            
            // Update button states
            document.querySelectorAll('.highlight-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (color && color !== 'none') {
                event.target.classList.add('active');
            }
        }
        
        function handleVerseClick(verseId) {
            const annotation = bibleAnnotations[verseId] || {};
            
            if (currentHighlightColor) {
                annotation.highlight = currentHighlightColor;
            } else if (annotation.highlight) {
                delete annotation.highlight;
            }
            
            annotation.verseId = verseId;
            
            if (Object.keys(annotation).length > 1 || annotation.note) {
                bibleAnnotations[verseId] = annotation;
            } else {
                delete bibleAnnotations[verseId];
            }
            
            saveBibleAnnotations();
            loadBibleChapter();
            updateAnnotationsList();
        }
        
        function addVerseNote(verseId) {
            const annotation = bibleAnnotations[verseId] || {};
            const currentNote = annotation.note || '';
            
            const note = prompt('Add a note for this verse:', currentNote);
            
            if (note !== null && note.trim()) {
                annotation.note = note.trim();
                annotation.verseId = verseId;
                bibleAnnotations[verseId] = annotation;
                saveBibleAnnotations();
                loadBibleChapter();
                updateAnnotationsList();
            }
        }
        
        function editVerseNote(verseId) {
            addVerseNote(verseId); // Reuse the same function
        }
        
        function deleteNote(verseId) {
            const annotation = bibleAnnotations[verseId];
            if (!annotation) return;
            
            if (confirm('Delete this note?')) {
                delete annotation.note;
                
                if (!annotation.highlight) {
                    delete bibleAnnotations[verseId];
                }
                
                saveBibleAnnotations();
                loadBibleChapter();
                updateAnnotationsList();
            }
        }
        
        async function saveBibleAnnotations() {
            try {
                await window.storage.set('bible:annotations', JSON.stringify(bibleAnnotations));
            } catch (error) {
                console.error('Error saving annotations:', error);
            }
        }
        
        function updateAnnotationsList() {
            const listDiv = document.getElementById('annotations-list');
            const annotations = Object.values(bibleAnnotations);
            
            if (annotations.length === 0) {
                listDiv.innerHTML = '<p class="text-sm text-gray-500 italic">No annotations yet. Click on verses to highlight or click verse numbers to add notes.</p>';
                return;
            }
            
            let html = '';
            annotations.forEach(ann => {
                const [book, chapter, verse] = ann.verseId.split('.');
                html += `<div class="bg-white p-3 rounded border">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-semibold text-indigo-700">${book} ${chapter}:${verse}</span>
                            ${ann.highlight ? `<span class="ml-2 px-2 py-1 text-xs rounded" style="background-color: ${getHighlightColor(ann.highlight)}">Highlighted</span>` : ''}
                        </div>
                        <button onclick="deleteAnnotation('${ann.verseId}')" class="text-red-600 hover:text-red-800 text-xs">Delete</button>
                    </div>
                    ${ann.note ? `<p class="text-sm text-gray-700 mt-2">üìù ${ann.note}</p>` : ''}
                </div>`;
            });
            
            listDiv.innerHTML = html;
        }
        
        function getHighlightColor(color) {
            const colors = {
                yellow: '#fef08a',
                green: '#86efac',
                blue: '#93c5fd',
                pink: '#f9a8d4',
                orange: '#fdba74'
            };
            return colors[color] || '#e5e7eb';
        }
        
        function filterAnnotations(filter) {
            const annotations = Object.values(bibleAnnotations);
            let filtered = annotations;
            
            if (filter === 'highlights') {
                filtered = annotations.filter(a => a.highlight);
            } else if (filter === 'notes') {
                filtered = annotations.filter(a => a.note);
            }
            
            const listDiv = document.getElementById('annotations-list');
            
            if (filtered.length === 0) {
                listDiv.innerHTML = '<p class="text-sm text-gray-500 italic">No annotations match this filter.</p>';
                return;
            }
            
            let html = '';
            filtered.forEach(ann => {
                const [book, chapter, verse] = ann.verseId.split('.');
                html += `<div class="bg-white p-3 rounded border">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-semibold text-indigo-700">${book} ${chapter}:${verse}</span>
                            ${ann.highlight ? `<span class="ml-2 px-2 py-1 text-xs rounded" style="background-color: ${getHighlightColor(ann.highlight)}">Highlighted</span>` : ''}
                        </div>
                        <button onclick="deleteAnnotation('${ann.verseId}')" class="text-red-600 hover:text-red-800 text-xs">Delete</button>
                    </div>
                    ${ann.note ? `<p class="text-sm text-gray-700 mt-2">üìù ${ann.note}</p>` : ''}
                </div>`;
            });
            
            listDiv.innerHTML = html;
        }
        
        function deleteAnnotation(verseId) {
            if (confirm('Delete this annotation?')) {
                delete bibleAnnotations[verseId];
                saveBibleAnnotations();
                updateAnnotationsList();
                loadBibleChapter();
            }
        }
        
        function exportBibleAnnotations() {
            const data = JSON.stringify(bibleAnnotations, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bible-annotations-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function confirmClearBibleAnnotations() {
            if (confirm('Are you sure you want to delete ALL annotations?\n\nThis cannot be undone.')) {
                if (confirm('Really delete everything? This is your last chance!')) {
                    bibleAnnotations = {};
                    saveBibleAnnotations();
                    updateAnnotationsList();
                    loadBibleChapter();
                    alert('‚úÖ All annotations deleted');
                }
            }
        }
        
        // ========== END BIBLE FUNCTIONS ==========

        function dismissBackupReminder() {
            document.getElementById('backup-reminder-banner').style.display = 'none';
            // Remind again in 7 days
            localStorage.setItem('backup-dismissed', new Date().toISOString());
        }

        function goToBackup() {
            dismissBackupReminder();
            switchTab('data');
            // Scroll to export section
            setTimeout(() => {
                document.getElementById('export-section')?.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // ========== LENT CHALLENGE FUNCTIONS ==========
        const LENT_START = new Date('2026-02-18'); // Ash Wednesday
        const LENT_END   = new Date('2026-04-05');  // Easter Sunday

        function initLentTab() {
            updateLentProgress();
            buildLent40DayGrid();
            loadLentPillars();
            loadLentMilestones();
            loadLentSacrifice();
        }

        function updateLentProgress() {
            const today = new Date();
            today.setHours(0,0,0,0);
            const start = new Date(LENT_START); start.setHours(0,0,0,0);
            const end   = new Date(LENT_END);   end.setHours(0,0,0,0);
            const total = Math.round((end - start) / 86400000);
            const elapsed = Math.max(0, Math.round((today - start) / 86400000));
            const pct = Math.min(100, Math.round((elapsed / total) * 100));

            const badge = document.getElementById('lent-season-badge');
            const label = document.getElementById('lent-day-label');
            const bar   = document.getElementById('lent-progress-bar');

            if (today < start) {
                badge.textContent = 'Lent Not Yet Started';
                label.textContent = '';
                bar.style.width = '0%';
            } else if (today > end) {
                badge.textContent = 'üåÖ Alleluia! Easter!';
                label.textContent = 'Lent complete!';
                bar.style.width = '100%';
            } else {
                // Sundays don't count in the 40; count weekdays+Saturdays
                let fastingDays = 0;
                for (let d = new Date(start); d <= today; d.setDate(d.getDate()+1)) {
                    if (d.getDay() !== 0) fastingDays++;
                }
                badge.textContent = `Day ${elapsed} of 46`;
                label.textContent = `Fasting Day ${fastingDays} of 40`;
                bar.style.width = pct + '%';
            }
        }

        function buildLent40DayGrid() {
            const grid = document.getElementById('lent-40-day-grid');
            if (!grid) return;

            const saved = JSON.parse(localStorage.getItem('lent-40days') || '{}');
            const today = new Date(); today.setHours(0,0,0,0);
            const start = new Date(LENT_START);

            while (grid.firstChild) grid.removeChild(grid.firstChild);

            // Inject checkbox styles once
            if (!document.getElementById('lent-cell-style')) {
                const style = document.createElement('style');
                style.id = 'lent-cell-style';
                style.textContent = `
                    .lent-cb { display:none; }
                    .lent-label {
                        display:flex; flex-direction:column; align-items:center;
                        justify-content:center; min-height:44px; border-radius:6px;
                        font-size:12px; line-height:1.3; width:100%;
                        background:#e5e7eb; color:#4b5563;
                        cursor:pointer; user-select:none; -webkit-user-select:none;
                    }
                    .lent-cb:checked + .lent-label { background:#8b5cf6; color:#fff; font-weight:bold; }
                    .lent-label.is-today { background:#fde047; color:#713f12; font-weight:bold; }
                    .lent-cb:checked + .lent-label.is-today { background:#7c3aed; color:#fff; }
                    .lent-label.is-sunday { background:#ede9fe; color:#7c3aed; cursor:default; }
                    .lent-label.is-future { background:#f3f4f6; color:#9ca3af; cursor:default; }
                `;
                document.head.appendChild(style);
            }

            // Headers
            ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(h => {
                const el = document.createElement('div');
                el.textContent = h;
                el.style.cssText = 'font-weight:600;color:#6b7280;padding:4px 0;text-align:center;font-size:11px;';
                grid.appendChild(el);
            });

            // Blank spacers
            for (let i = 0; i < start.getDay(); i++) {
                grid.appendChild(document.createElement('div'));
            }

            let checkedCount = 0;
            let fastingDay = 0;

            for (let i = 0; i < 46; i++) {
                const d = new Date(start.getFullYear(), start.getMonth(), start.getDate() + i);
                const key = d.toISOString().slice(0, 10);
                const isSunday = d.getDay() === 0;
                const isToday  = d.getTime() === today.getTime();
                const isFuture = d > today;
                const isMarked = !!saved[key];
                const interactive = !isSunday && !isFuture;
                if (!isSunday) fastingDay++;

                if (interactive) {
                    // Hidden checkbox ‚Äî label acts as the visual cell
                    const cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.className = 'lent-cb';
                    cb.id = 'lentday-' + key;
                    cb.checked = isMarked;
                    cb.addEventListener('change', (function(k) {
                        return function() { saveLentDay(k, this.checked); };
                    })(key));
                    grid.appendChild(cb);

                    const label = document.createElement('label');
                    label.htmlFor = 'lentday-' + key;
                    label.className = 'lent-label' + (isToday ? ' is-today' : '');

                    const numSpan = document.createElement('span');
                    numSpan.textContent = d.getDate();
                    const subSpan = document.createElement('span');
                    subSpan.style.cssText = 'font-size:10px;opacity:0.65;';
                    subSpan.textContent = fastingDay;
                    label.appendChild(numSpan);
                    label.appendChild(subSpan);
                    grid.appendChild(label);

                    if (isMarked) checkedCount++;
                } else {
                    // Non-interactive display cell
                    const cell = document.createElement('div');
                    cell.className = 'lent-label ' + (isSunday ? 'is-sunday' : 'is-future');
                    const numSpan = document.createElement('span');
                    numSpan.textContent = d.getDate();
                    const subSpan = document.createElement('span');
                    subSpan.style.cssText = 'font-size:10px;opacity:0.65;';
                    subSpan.textContent = isSunday ? '‚òÄ' : fastingDay;
                    if (isSunday) subSpan.style.color = '#a78bfa';
                    cell.appendChild(numSpan);
                    cell.appendChild(subSpan);
                    grid.appendChild(cell);
                }
            }

            document.getElementById('lent-days-checked').textContent = `${checkedCount} / 40 days marked`;
        }

        function saveLentDay(key, checked) {
            const saved = JSON.parse(localStorage.getItem('lent-40days') || '{}');
            if (checked) saved[key] = true;
            else delete saved[key];
            localStorage.setItem('lent-40days', JSON.stringify(saved));
            // Update count without rebuilding entire grid
            const checkedCount = Object.keys(saved).length;
            document.getElementById('lent-days-checked').textContent = `${checkedCount} / 40 days marked`;
        }

        function toggleLentDay(key) {
            const saved = JSON.parse(localStorage.getItem('lent-40days') || '{}');
            saved[key] = !saved[key];
            if (!saved[key]) delete saved[key];
            localStorage.setItem('lent-40days', JSON.stringify(saved));
            buildLent40DayGrid();
        }

        function saveLentPillar(checkbox) {
            const saved = JSON.parse(localStorage.getItem('lent-pillars') || '{}');
            saved[checkbox.dataset.pillar] = checkbox.checked;
            localStorage.setItem('lent-pillars', JSON.stringify(saved));
        }

        function loadLentPillars() {
            const saved = JSON.parse(localStorage.getItem('lent-pillars') || '{}');
            document.querySelectorAll('.lent-pillar').forEach(cb => {
                cb.checked = !!saved[cb.dataset.pillar];
            });
        }

        function saveLentMilestone(checkbox) {
            const saved = JSON.parse(localStorage.getItem('lent-milestones') || '{}');
            saved[checkbox.dataset.milestone] = checkbox.checked;
            localStorage.setItem('lent-milestones', JSON.stringify(saved));
        }

        function loadLentMilestones() {
            const saved = JSON.parse(localStorage.getItem('lent-milestones') || '{}');
            document.querySelectorAll('.lent-milestone').forEach(cb => {
                cb.checked = !!saved[cb.dataset.milestone];
            });
        }

        let lentSacrificeTimer = null;
        function autoSaveLentSacrifice() {
            clearTimeout(lentSacrificeTimer);
            lentSacrificeTimer = setTimeout(() => {
                const data = {
                    sacrifice: document.getElementById('lent-sacrifice-text').value,
                    intention: document.getElementById('lent-intention').value
                };
                localStorage.setItem('lent-sacrifice', JSON.stringify(data));
                const el = document.getElementById('lent-sacrifice-saved');
                el.textContent = '‚úÖ Saved';
                setTimeout(() => { el.textContent = ''; }, 2000);
            }, 800);
        }

        function loadLentSacrifice() {
            try {
                const data = JSON.parse(localStorage.getItem('lent-sacrifice') || '{}');
                if (data.sacrifice) document.getElementById('lent-sacrifice-text').value = data.sacrifice;
                if (data.intention) document.getElementById('lent-intention').value = data.intention;
            } catch(e) {}
        }
        // ========== END LENT FUNCTIONS ==========

    </script>
</body>
</html>